import{_ as he,u as ye,r as m,c as I,av as O,o as Ve,b as w,d as o,e as t,w as l,k as Ce,l as b,F as ke,j as Ee,G as _,H as n,E as Ue,J as Y,n as Pe,h as A,s as xe,N as G,O as J,X as Ae,a7 as Se,af as Te,D as Re,aj as W,L as d,bd as j,ac as Fe}from"./index-Da7ZqcH5.js";/* empty css                 *//* empty css              *//* empty css               */import"./scrollbar-PN-ehNXN.js";/* empty css                  *//* empty css            *//* empty css             *//* empty css               *//* empty css                 */import{k as Ie,l as je,f as X}from"./positionedConfirm-C6ixQw3s.js";import{E as ze}from"./index-lPpvXrw4.js";import{E as He}from"./index-CZyikzse.js";import{E as $e,a as De}from"./index-BJ8ssZSI.js";import{E as Le,a as Me}from"./index-Chbwi6h6.js";import{E as Be,a as Ne}from"./index-mDFjMy5P.js";import{E as qe}from"./index-DuvIoQvO.js";import"./vnode-DsZHVpXe.js";import"./index-k6BulDX8.js";import"./isEqual-HUGtL056.js";import"./_Uint8Array-CNK7Frb1.js";import"./index-BwTCsBpr.js";import"./castArray-DVWVVBpp.js";import"./index-Ddj3Fd5B.js";import"./index-R92uOlC6.js";import"./index-DSEo_ZHY.js";import"./index-ViZWhRvA.js";import"./index-BLAWzDFp.js";import"./directive-iqmOBkSf.js";const Ze={class:"profile-page"},Oe={class:"profile-container"},Ye={class:"profile-header"},Ge={class:"avatar-section"},Je={class:"user-info"},We={class:"username"},Xe={class:"bio"},Ke={class:"user-stats"},Qe={class:"stat-item"},et={class:"stat-number"},tt={class:"stat-item"},at={class:"stat-number"},st={class:"stat-item"},lt={class:"stat-number"},ot={class:"stat-item"},rt={class:"stat-number"},nt={class:"articles-section"},it={class:"articles-header"},dt={class:"articles-list"},ut=["onClick"],ct={class:"article-info"},mt={class:"article-summary"},pt={class:"article-meta"},ft={class:"article-date"},_t={class:"article-stats"},vt={class:"article-actions"},wt={key:0,class:"empty-state"},bt={class:"comments-section"},gt={class:"comments-list"},ht={class:"comment-content"},yt={class:"comment-meta"},Vt={class:"comment-article"},Ct=["onClick"],kt={class:"comment-date"},Et={class:"comment-actions"},Ut={key:0,class:"empty-state"},Pt={__name:"Profile",setup(xt){const z=Ce(),g=ye(),H=m("info"),S=m(!1),T=m(!1),y=m(""),k=m(""),V=m(!1),$=m(),R=m(),K=m(),Q=m("/api/files/upload/avatar"),ee=I(()=>({Authorization:`Bearer ${g.token}`})),r=I(()=>g.user||{}),i=O({username:"",nickname:"",email:"",phone:"",bio:"",website:"",github:""}),p=O({oldPassword:"",newPassword:"",confirmPassword:""}),E=m([]),C=m([]),te={nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:1,max:50,message:"昵称长度在 1 到 50 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},ae={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(a,e,u)=>{e!==p.newPassword?u(new Error("两次输入的密码不一致")):u()},trigger:"blur"}]},D=I(()=>{let a=E.value;return y.value&&(a=a.filter(e=>e.title.toLowerCase().includes(y.value.toLowerCase())||e.summary.toLowerCase().includes(y.value.toLowerCase()))),k.value&&(a=a.filter(e=>e.status===k.value)),a}),se=a=>({published:"success",draft:"warning"})[a]||"info",le=a=>({published:"已发布",draft:"草稿"})[a]||"未知",L=a=>Fe(a).format("YYYY-MM-DD HH:mm"),oe=a=>{const e=a.type.startsWith("image/"),u=a.size/1024/1024<2;return e?u?(V.value=!0,!0):(d.error("图片大小不能超过 2MB!"),!1):(d.error("只能上传图片文件!"),!1)},re=a=>{V.value=!1,a.code===200?(r.value.avatar=a.data.fileUrl,d.success("头像更新成功!"),ie(a.data.fileUrl)):d.error(a.message||"上传失败")},ne=a=>{V.value=!1,console.error("头像上传失败:",a),d.error("头像上传失败，请重试")},ie=async a=>{try{const e=await j.updateAvatar(r.value.id,a);e.code===200?g.updateUser({avatar:e.data.avatar}):d.error(e.message||"头像更新失败")}catch(e){console.error("更新用户头像失败:",e),d.error("头像保存失败")}},de=async()=>{try{await $.value.validate(),S.value=!0;const a=await j.updateUser(r.value.id,i);a.code===200?(g.updateUser(a.data),d.success("个人信息更新成功")):d.error(a.message||"更新失败")}catch(a){console.error("更新个人信息失败:",a),a!=="validation failed"&&d.error("更新失败")}finally{S.value=!1}},ue=async()=>{try{await R.value.validate(),T.value=!0;const a=await j.updatePassword(r.value.id,{oldPassword:p.oldPassword,newPassword:p.newPassword});a.code===200?(R.value.resetFields(),Object.assign(p,{oldPassword:"",newPassword:"",confirmPassword:""}),d.success("密码修改成功")):d.error(a.message||"修改失败")}catch(a){console.error("修改密码失败:",a),a!=="validation failed"&&d.error("修改失败")}finally{T.value=!1}},M=a=>{z.push(`/article/${a.slug}`)},ce=a=>{z.push(`/admin/articles/edit/${a.id}`)},me=async(a,e)=>{try{await X(`确定要删除文章"${a.title}"吗？`,e),console.log("删除文章:",a.id);const u=E.value.findIndex(v=>v.id===a.id);u>-1&&E.value.splice(u,1),d.success("删除成功")}catch(u){u!=="cancel"&&d.error("删除失败")}},pe=async(a,e)=>{try{await X("确定要删除这条评论吗？",e),console.log("删除评论:",a.id);const u=C.value.findIndex(v=>v.id===a.id);u>-1&&C.value.splice(u,1),d.success("删除成功")}catch(u){u!=="cancel"&&d.error("删除失败")}},fe=async()=>{try{E.value=[{id:1,title:"Vue.js 3.0 新特性详解",summary:"本文详细介绍了Vue.js 3.0的新特性和改进...",status:"published",viewCount:1250,commentCount:15,likeCount:89,createdAt:"2025-01-15T10:00:00Z"},{id:2,title:"JavaScript ES2023 新特性",summary:"探索JavaScript ES2023版本中的新特性...",status:"published",viewCount:890,commentCount:8,likeCount:56,createdAt:"2025-01-10T14:30:00Z"},{id:3,title:"React Hooks 最佳实践",summary:"分享React Hooks的使用技巧和最佳实践...",status:"draft",viewCount:0,commentCount:0,likeCount:0,createdAt:"2025-01-08T09:15:00Z"}]}catch(a){console.error("加载用户文章失败:",a)}},_e=async()=>{try{C.value=[{id:1,content:"这篇文章写得很好，学到了很多新知识！",article:{id:10,title:"TypeScript 进阶指南"},createdAt:"2025-01-14T16:20:00Z"},{id:2,content:"感谢分享，代码示例很实用。",article:{id:11,title:"Node.js 性能优化技巧"},createdAt:"2025-01-12T11:45:00Z"}]}catch(a){console.error("加载用户评论失败:",a)}};return Ve(async()=>{g.user||await g.initUser(),r.value&&Object.assign(i,{username:r.value.username||"",nickname:r.value.nickname||"",email:r.value.email||"",phone:r.value.phone||"",bio:r.value.bio||"",website:r.value.website||"",github:r.value.github||""}),await Promise.all([fe(),_e()])}),(a,e)=>{const u=ke,v=Ee,ve=He,B=ze,f=Ue,c=De,U=Me,N=Le,q=$e,P=je,x=Pe,F=Ne,we=Be,be=Ae,Z=qe,ge=Ie;return b(),w("div",Ze,[o("div",Oe,[t(B,{class:"profile-card"},{default:l(()=>[o("div",Ye,[o("div",Ge,[t(u,{size:120,src:r.value.avatar},null,8,["src"]),t(ve,{ref_key:"avatarUploadRef",ref:K,action:Q.value,headers:ee.value,"show-file-list":!1,"before-upload":oe,"on-success":re,"on-error":ne,accept:"image/*"},{default:l(()=>[t(v,{type:"primary",size:"small",loading:V.value},{default:l(()=>[_(n(V.value?"上传中...":"更换头像"),1)]),_:1},8,["loading"])]),_:1},8,["action","headers"])]),o("div",Je,[o("h2",null,n(r.value.nickname),1),o("p",We,"@"+n(r.value.username),1),o("p",Xe,n(r.value.bio||"这个人很懒，什么都没有留下..."),1),o("div",Ke,[o("div",Qe,[o("span",et,n(r.value.articleCount),1),e[13]||(e[13]=o("span",{class:"stat-label"},"文章",-1))]),o("div",tt,[o("span",at,n(r.value.followersCount),1),e[14]||(e[14]=o("span",{class:"stat-label"},"粉丝",-1))]),o("div",st,[o("span",lt,n(r.value.followingCount),1),e[15]||(e[15]=o("span",{class:"stat-label"},"关注",-1))]),o("div",ot,[o("span",rt,n(r.value.likesCount),1),e[16]||(e[16]=o("span",{class:"stat-label"},"获赞",-1))])])])])]),_:1}),t(B,{class:"content-card"},{default:l(()=>[t(ge,{modelValue:H.value,"onUpdate:modelValue":e[12]||(e[12]=s=>H.value=s),class:"profile-tabs"},{default:l(()=>[t(P,{label:"个人信息",name:"info"},{default:l(()=>[t(q,{ref_key:"infoFormRef",ref:$,model:i,rules:te,"label-width":"100px",class:"profile-form"},{default:l(()=>[t(N,{gutter:20},{default:l(()=>[t(U,{span:12},{default:l(()=>[t(c,{label:"用户名",prop:"username"},{default:l(()=>[t(f,{modelValue:i.username,"onUpdate:modelValue":e[0]||(e[0]=s=>i.username=s),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),t(U,{span:12},{default:l(()=>[t(c,{label:"昵称",prop:"nickname"},{default:l(()=>[t(f,{modelValue:i.nickname,"onUpdate:modelValue":e[1]||(e[1]=s=>i.nickname=s),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(N,{gutter:20},{default:l(()=>[t(U,{span:12},{default:l(()=>[t(c,{label:"邮箱",prop:"email"},{default:l(()=>[t(f,{modelValue:i.email,"onUpdate:modelValue":e[2]||(e[2]=s=>i.email=s),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1}),t(U,{span:12},{default:l(()=>[t(c,{label:"手机号",prop:"phone"},{default:l(()=>[t(f,{modelValue:i.phone,"onUpdate:modelValue":e[3]||(e[3]=s=>i.phone=s),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(c,{label:"个人简介",prop:"bio"},{default:l(()=>[t(f,{modelValue:i.bio,"onUpdate:modelValue":e[4]||(e[4]=s=>i.bio=s),type:"textarea",rows:4,placeholder:"请输入个人简介",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(c,{label:"个人网站",prop:"website"},{default:l(()=>[t(f,{modelValue:i.website,"onUpdate:modelValue":e[5]||(e[5]=s=>i.website=s),placeholder:"请输入个人网站"},null,8,["modelValue"])]),_:1}),t(c,{label:"GitHub",prop:"github"},{default:l(()=>[t(f,{modelValue:i.github,"onUpdate:modelValue":e[6]||(e[6]=s=>i.github=s),placeholder:"请输入GitHub地址"},null,8,["modelValue"])]),_:1}),t(c,null,{default:l(()=>[t(v,{type:"primary",onClick:de,loading:S.value},{default:l(()=>e[17]||(e[17]=[_(" 保存修改 ",-1)])),_:1,__:[17]},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(P,{label:"修改密码",name:"password"},{default:l(()=>[t(q,{ref_key:"passwordFormRef",ref:R,model:p,rules:ae,"label-width":"100px",class:"profile-form",style:{"max-width":"400px"}},{default:l(()=>[t(c,{label:"当前密码",prop:"oldPassword"},{default:l(()=>[t(f,{modelValue:p.oldPassword,"onUpdate:modelValue":e[7]||(e[7]=s=>p.oldPassword=s),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),t(c,{label:"新密码",prop:"newPassword"},{default:l(()=>[t(f,{modelValue:p.newPassword,"onUpdate:modelValue":e[8]||(e[8]=s=>p.newPassword=s),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),t(c,{label:"确认密码",prop:"confirmPassword"},{default:l(()=>[t(f,{modelValue:p.confirmPassword,"onUpdate:modelValue":e[9]||(e[9]=s=>p.confirmPassword=s),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),t(c,null,{default:l(()=>[t(v,{type:"primary",onClick:ue,loading:T.value},{default:l(()=>e[18]||(e[18]=[_(" 修改密码 ",-1)])),_:1,__:[18]},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),t(P,{label:"我的文章",name:"articles"},{default:l(()=>[o("div",nt,[o("div",it,[t(f,{modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=s=>y.value=s),placeholder:"搜索我的文章",style:{width:"300px"},clearable:""},{prefix:l(()=>[t(x,null,{default:l(()=>[t(A(xe))]),_:1})]),_:1},8,["modelValue"]),t(we,{modelValue:k.value,"onUpdate:modelValue":e[11]||(e[11]=s=>k.value=s),placeholder:"文章状态",style:{width:"120px"}},{default:l(()=>[t(F,{label:"全部",value:""}),t(F,{label:"已发布",value:"published"}),t(F,{label:"草稿",value:"draft"})]),_:1},8,["modelValue"])]),o("div",dt,[(b(!0),w(G,null,J(D.value,s=>(b(),w("div",{key:s.id,class:"article-item",onClick:h=>M(s)},[o("div",ct,[o("h3",null,n(s.title),1),o("p",mt,n(s.summary),1),o("div",pt,[t(be,{type:se(s.status),size:"small"},{default:l(()=>[_(n(le(s.status)),1)]),_:2},1032,["type"]),o("span",ft,n(L(s.createdAt)),1),o("span",_t,[t(x,null,{default:l(()=>[t(A(Se))]),_:1}),_(" "+n(s.viewCount)+" ",1),t(x,null,{default:l(()=>[t(A(Te))]),_:1}),_(" "+n(s.commentCount)+" ",1),t(x,null,{default:l(()=>[t(A(Re))]),_:1}),_(" "+n(s.likeCount),1)])])]),o("div",vt,[t(v,{type:"primary",size:"small",onClick:W(h=>ce(s),["stop"])},{default:l(()=>e[19]||(e[19]=[_(" 编辑 ",-1)])),_:2,__:[19]},1032,["onClick"]),t(v,{type:"danger",size:"small",onClick:W(h=>me(s,h),["stop"])},{default:l(()=>e[20]||(e[20]=[_(" 删除 ",-1)])),_:2,__:[20]},1032,["onClick"])])],8,ut))),128))]),D.value.length===0?(b(),w("div",wt,[t(Z,{description:"暂无文章"})])):Y("",!0)])]),_:1}),t(P,{label:"我的评论",name:"comments"},{default:l(()=>[o("div",bt,[o("div",gt,[(b(!0),w(G,null,J(C.value,s=>(b(),w("div",{key:s.id,class:"comment-item"},[o("div",ht,[o("p",null,n(s.content),1),o("div",yt,[o("span",Vt,[e[21]||(e[21]=_(" 评论于：",-1)),o("a",{onClick:h=>M(s.article)},n(s.article.title),9,Ct)]),o("span",kt,n(L(s.createdAt)),1)])]),o("div",Et,[t(v,{type:"danger",size:"small",onClick:h=>pe(s,h)},{default:l(()=>e[22]||(e[22]=[_(" 删除 ",-1)])),_:2,__:[22]},1032,["onClick"])])]))),128))]),C.value.length===0?(b(),w("div",Ut,[t(Z,{description:"暂无评论"})])):Y("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])}}},la=he(Pt,[["__scopeId","data-v-4ead1583"]]);export{la as default};
