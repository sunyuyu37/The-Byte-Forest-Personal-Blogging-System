import{_ as ye,r,a4 as he,o as ke,a as Ce,b as u,d as s,P as G,J as C,e as a,w as o,g as be,h as b,s as H,E as Ee,G as i,H as v,a5 as Se,Z as we,j as Ve,a6 as xe,N as R,O as $,Q,L as X,k as Te,l as n,I as P,a7 as ze,n as Ae,D as Be,X as Re}from"./index-Da7ZqcH5.js";/* empty css                *//* empty css                   *//* empty css               */import"./scrollbar-PN-ehNXN.js";/* empty css              *//* empty css                     *//* empty css             *//* empty css                  *//* empty css            */import{c as $e}from"./category-BuqsFtfq.js";import{g as Z}from"./placeholder-BiywPu__.js";import{E as Ie}from"./index-lPpvXrw4.js";import{E as Ne,a as Le}from"./index-mDFjMy5P.js";import{v as qe}from"./directive-iqmOBkSf.js";import{E as He}from"./index-DuvIoQvO.js";import{E as Pe}from"./index-DSEo_ZHY.js";import{E as Ue,a as De}from"./index-BJ8ssZSI.js";import{E as Ke,a as Me}from"./index-Chbwi6h6.js";import"./vnode-DsZHVpXe.js";import"./castArray-DVWVVBpp.js";import"./isEqual-HUGtL056.js";import"./_Uint8Array-CNK7Frb1.js";const Fe={class:"search-page"},Oe={class:"container"},Je={class:"search-header"},je={class:"search-box"},Ge={key:0,class:"search-stats"},Qe={key:0},Xe={key:1},Ze={class:"advanced-search"},We={class:"search-toolbar"},Ye={class:"toolbar-left"},et={class:"toolbar-right"},tt={class:"search-results"},lt={key:0,class:"results-list"},at=["onClick"],ot={class:"result-content"},st=["innerHTML"],nt=["innerHTML"],rt={class:"result-meta"},ut={class:"category"},it={class:"author"},dt={class:"date"},ct={class:"stats"},vt={key:0,class:"result-image"},pt=["src","alt"],mt={key:1,class:"empty-state"},_t={key:2,class:"search-suggestions"},gt={class:"suggestion-tags"},ft={class:"recent-searches"},yt={key:0,class:"pagination"},ht={__name:"Search",setup(kt){const I=Ce(),W=Te(),T=r(!1),_=r(""),g=r(""),h=r([]),U=r([]),E=r(0),p=r(1),k=r(20),f=r(!1),z=r(!1),S=r("all"),m=r({category:"",sortBy:"relevance",timeRange:""}),D=r([]),y=r([]);r([]),r(!1);const K=t=>{const e=t==null?void 0:t.coverImage,d=typeof e=="string"&&/(^https?:)?\/\/via\.placeholder\.com/i.test(e);return!e||d?Z(120,80):e},Y=t=>{const e=t==null?void 0:t.target;e&&(e.onerror=null,e.src=Z(120,80))},w=async()=>{if(!_.value.trim()){X.warning("请输入搜索关键词");return}T.value=!0,f.value=!0,g.value=_.value.trim();try{const t={keyword:g.value,page:p.value-1,size:k.value,searchType:S.value,...m.value},e=await Q.searchArticles(t);h.value=e.data.content,E.value=e.data.totalElements,ne(g.value)}catch(t){console.error("搜索失败:",t),X.error("搜索失败，请稍后重试")}finally{T.value=!1}},V=()=>{p.value=1,w()},ee=()=>{p.value=1,w()},te=()=>{m.value={category:"",sortBy:"relevance",timeRange:""}},N=t=>{S.value=t,f.value&&(p.value=1,w())},M=t=>{k.value=t,p.value=1,f.value&&w()},le=t=>{p.value=t,w()},ae=t=>{W.push(`/article/${t}`)},F=t=>{if(!g.value||!t)return t;const e=new RegExp(`(${g.value})`,"gi");return t.replace(e,"<mark>$1</mark>")},oe=t=>new Date(t).toLocaleDateString("zh-CN"),O=t=>{_.value=t,V()},se=()=>{_.value="",g.value="",h.value=[],f.value=!1,E.value=0,p.value=1},ne=t=>{const e=y.value.filter(d=>d!==t);e.unshift(t),y.value=e.slice(0,10),localStorage.setItem("recentSearches",JSON.stringify(y.value))},re=t=>{y.value=y.value.filter(e=>e!==t),localStorage.setItem("recentSearches",JSON.stringify(y.value))},ue=async()=>{try{const t=await $e.getAllCategories();U.value=t.data}catch(t){console.error("加载分类失败:",t)}},ie=async()=>{try{const t=await Q.getHotKeywords();D.value=t.data}catch(t){console.error("加载热门搜索关键词失败:",t)}};return he(()=>I.query.q,t=>{t&&(_.value=t,V())},{immediate:!0}),ke(()=>{const t=localStorage.getItem("recentSearches");t&&(y.value=JSON.parse(t)),ue(),ie(),I.query.q&&(_.value=I.query.q,V())}),(t,e)=>{const d=Ve,de=Ee,c=Le,A=Ne,B=De,L=Me,ce=Ke,ve=Ue,pe=Ie,me=xe,q=Ae,_e=He,J=Re,ge=Pe,fe=qe;return n(),u("div",Fe,[s("div",Oe,[s("div",Je,[e[15]||(e[15]=s("h1",null,"全局搜索",-1)),s("div",je,[a(de,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=l=>_.value=l),placeholder:"搜索文章、标签、分类...","prefix-icon":b(H),size:"large",onKeyup:be(V,["enter"]),clearable:""},{append:o(()=>[a(d,{icon:b(H),onClick:V},null,8,["icon"])]),_:1},8,["modelValue","prefix-icon"])]),h.value.length>0||f.value?(n(),u("div",Ge,[h.value.length>0?(n(),u("p",Qe,[e[11]||(e[11]=i(" 找到 ",-1)),s("strong",null,v(E.value),1),e[12]||(e[12]=i(" 个结果，关键词：",-1)),s("strong",null,'"'+v(g.value)+'"',1)])):f.value?(n(),u("p",Xe,[e[13]||(e[13]=i(" 没有找到与 ",-1)),s("strong",null,'"'+v(g.value)+'"',1),e[14]||(e[14]=i(" 相关的结果 ",-1))])):C("",!0)])):C("",!0)]),G(s("div",Ze,[a(pe,null,{header:o(()=>e[16]||(e[16]=[s("span",null,"高级搜索",-1)])),default:o(()=>[a(ve,{model:m.value,"label-width":"80px"},{default:o(()=>[a(ce,{gutter:20},{default:o(()=>[a(L,{span:8},{default:o(()=>[a(B,{label:"分类"},{default:o(()=>[a(A,{modelValue:m.value.category,"onUpdate:modelValue":e[1]||(e[1]=l=>m.value.category=l),placeholder:"选择分类",clearable:""},{default:o(()=>[(n(!0),u(R,null,$(U.value,l=>(n(),P(c,{key:l.id,label:l.name,value:l.slug},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(L,{span:8},{default:o(()=>[a(B,{label:"排序"},{default:o(()=>[a(A,{modelValue:m.value.sortBy,"onUpdate:modelValue":e[2]||(e[2]=l=>m.value.sortBy=l),placeholder:"排序方式"},{default:o(()=>[a(c,{label:"相关度",value:"relevance"}),a(c,{label:"最新发布",value:"latest"}),a(c,{label:"最多阅读",value:"views"}),a(c,{label:"最多点赞",value:"likes"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(L,{span:8},{default:o(()=>[a(B,{label:"时间范围"},{default:o(()=>[a(A,{modelValue:m.value.timeRange,"onUpdate:modelValue":e[3]||(e[3]=l=>m.value.timeRange=l),placeholder:"选择时间范围",clearable:""},{default:o(()=>[a(c,{label:"最近一周",value:"week"}),a(c,{label:"最近一月",value:"month"}),a(c,{label:"最近三月",value:"quarter"}),a(c,{label:"最近一年",value:"year"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(B,null,{default:o(()=>[a(d,{type:"primary",onClick:ee},{default:o(()=>e[17]||(e[17]=[i("搜索",-1)])),_:1,__:[17]}),a(d,{onClick:te},{default:o(()=>e[18]||(e[18]=[i("重置",-1)])),_:1,__:[18]})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[Se,z.value]]),s("div",We,[s("div",Ye,[a(d,{type:z.value?"primary":"",icon:b(we),onClick:e[4]||(e[4]=l=>z.value=!z.value)},{default:o(()=>e[19]||(e[19]=[i(" 高级搜索 ",-1)])),_:1,__:[19]},8,["type","icon"]),a(me,null,{default:o(()=>[a(d,{type:S.value==="all"?"primary":"",onClick:e[5]||(e[5]=l=>N("all"))},{default:o(()=>e[20]||(e[20]=[i(" 全部 ",-1)])),_:1,__:[20]},8,["type"]),a(d,{type:S.value==="title"?"primary":"",onClick:e[6]||(e[6]=l=>N("title"))},{default:o(()=>e[21]||(e[21]=[i(" 标题 ",-1)])),_:1,__:[21]},8,["type"]),a(d,{type:S.value==="content"?"primary":"",onClick:e[7]||(e[7]=l=>N("content"))},{default:o(()=>e[22]||(e[22]=[i(" 内容 ",-1)])),_:1,__:[22]},8,["type"])]),_:1})]),s("div",et,[a(A,{modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=l=>k.value=l),onChange:M,style:{width:"120px"}},{default:o(()=>[a(c,{label:"10条/页",value:10}),a(c,{label:"20条/页",value:20}),a(c,{label:"50条/页",value:50})]),_:1},8,["modelValue"])])]),G((n(),u("div",tt,[h.value.length>0?(n(),u("div",lt,[(n(!0),u(R,null,$(h.value,l=>{var x,j;return n(),u("div",{key:l.id,class:"result-item",onClick:Ct=>ae(l.slug)},[s("div",ot,[s("h3",{class:"result-title",innerHTML:F(l.title)},null,8,st),s("p",{class:"result-summary",innerHTML:F(l.summary)},null,8,nt),s("div",rt,[s("span",ut,v((x=l.category)==null?void 0:x.name),1),s("span",it,v((j=l.author)==null?void 0:j.nickname),1),s("span",dt,v(oe(l.publishedAt)),1),s("span",ct,[a(q,null,{default:o(()=>[a(b(ze))]),_:1}),i(v(l.viewCount)+" ",1),a(q,null,{default:o(()=>[a(b(Be))]),_:1}),i(v(l.likeCount),1)])])]),K(l)?(n(),u("div",vt,[s("img",{src:K(l),alt:l.title,onError:Y},null,40,pt)])):C("",!0)],8,at)}),128))])):f.value&&!T.value?(n(),u("div",mt,[a(_e,{description:"没有找到相关结果"},{image:o(()=>[a(q,{size:"100"},{default:o(()=>[a(b(H))]),_:1})]),default:o(()=>[a(d,{type:"primary",onClick:se},{default:o(()=>e[23]||(e[23]=[i("清空搜索",-1)])),_:1,__:[23]})]),_:1})])):C("",!0),f.value?C("",!0):(n(),u("div",_t,[e[24]||(e[24]=s("h3",null,"热门搜索",-1)),s("div",gt,[(n(!0),u(R,null,$(D.value,l=>(n(),P(J,{key:l,onClick:x=>O(l),style:{cursor:"pointer",margin:"5px"}},{default:o(()=>[i(v(l),1)]),_:2},1032,["onClick"]))),128))]),e[25]||(e[25]=s("h3",null,"最近搜索",-1)),s("div",ft,[(n(!0),u(R,null,$(y.value,l=>(n(),P(J,{key:l,closable:"",onClick:x=>O(l),onClose:x=>re(l),style:{cursor:"pointer",margin:"5px"}},{default:o(()=>[i(v(l),1)]),_:2},1032,["onClick","onClose"]))),128))])]))])),[[fe,T.value]]),E.value>0?(n(),u("div",yt,[a(ge,{"current-page":p.value,"onUpdate:currentPage":e[9]||(e[9]=l=>p.value=l),"page-size":k.value,"onUpdate:pageSize":e[10]||(e[10]=l=>k.value=l),total:E.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:M,onCurrentChange:le},null,8,["current-page","page-size","total"])])):C("",!0)])])}}},Ot=ye(ht,[["__scopeId","data-v-8477bc9f"]]);export{Ot as default};
