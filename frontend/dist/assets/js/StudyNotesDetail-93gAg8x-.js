/* empty css             *//* empty css                  *//* empty css                 *//* empty css                  *//* empty css               *//* empty css                  *//* empty css                           *//* empty css                         */import{r as a,p as e,c as l,a as s,Q as t,K as i,I as n,O as u,M as o,P as c,a6 as r,u as d,al as v,aD as m,o as p,H as k}from"./vue-B9wWIsxR.js";import{u as f}from"./index-di9GIa25.js";import{a6 as y,a7 as g,G as _,aa as h,r as C,F as w,j,a8 as x,C as L,m as b,a9 as A,E as I,ab as D,a5 as H,U as M,e as P}from"./element-plus-CXASJE3V.js";import{a as $}from"./article-Pn5uYJFo.js";import{c as z}from"./comment-DttPZ_iH.js";import{_ as T}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./utils-C28rWPR3.js";const Y={class:"study-notes-detail"},F={class:"container"},U={key:0,class:"loading"},V={key:1,class:"article-content"},O={class:"academic-header"},S={class:"breadcrumb"},B={class:"academic-title"},E={class:"paper-meta"},G={class:"author-section"},K={class:"author-details"},N={class:"name"},Q={class:"date"},R={class:"academic-metrics"},q={class:"metric"},J={class:"metric"},W={class:"metric"},X={key:0,class:"study-tags"},Z={class:"academic-body"},aa=["innerHTML"],ea={class:"academic-footer"},la={class:"actions"},sa={class:"discussion-section"},ta={key:0,class:"discussion-form"},ia={class:"form-actions"},na={key:1,class:"login-prompt"},ua={class:"discussion-list"},oa={class:"discussion-avatar"},ca={class:"discussion-content"},ra={class:"discussion-header"},da={class:"username"},va={class:"time"},ma={class:"discussion-text"},pa={class:"discussion-actions"},ka={key:0},fa={key:0,class:"related-notes"},ya={class:"notes-grid"},ga=["onClick"],_a={class:"note-meta"},ha={key:2,class:"not-found"},Ca=T({__name:"StudyNotesDetail",setup(T){const Ca=m(),wa=f(),ja=a(!0),xa=a(null),La=a([]),ba=a([]),Aa=a(!1),Ia=a(""),Da=a(!1),Ha=a=>h(a).format("YYYY-MM-DD HH:mm"),Ma=async()=>{var a;if(xa.value)try{const e=xa.value.slug||xa.value.id,l=await z.getArticleComments(e),s=(null==(a=l.data)?void 0:a.content)||l.data||[];La.value=s.map(a=>({...a,isLiked:!1,likeCount:a.likeCount||0}))}catch(e){}},Pa=async()=>{var a,e;if(null==(e=null==(a=xa.value)?void 0:a.tags)?void 0:e.length)try{const a=xa.value.tags.map(a=>a.id),e=await $.getRelatedArticles(xa.value.id,{tags:a});ba.value=(e.data||[]).slice(0,3)}catch(l){}},$a=async()=>{if(wa.isLoggedIn)try{Aa.value?(await $.unlikeArticle(xa.value.id),xa.value.likeCount--):(await $.likeArticle(xa.value.id),xa.value.likeCount++),Aa.value=!Aa.value}catch(a){I.error("操作失败")}else I.warning("请先登录")},za=()=>{navigator.share?navigator.share({title:xa.value.title,text:xa.value.excerpt,url:window.location.href}):(navigator.clipboard.writeText(window.location.href),I.success("链接已复制到剪贴板"))},Ta=()=>{I.info("PDF导出功能开发中...")},Ya=async()=>{if(Ia.value.trim()){Da.value=!0;try{await z.createComment({articleId:xa.value.id,content:Ia.value}),Ia.value="",I.success("讨论发表成功"),await Ma()}catch(a){I.error("发表失败")}finally{Da.value=!1}}else I.warning("请输入讨论内容")};return e(async()=>{var a;ja.value=!0;try{const l=Ca.params.slug,s=await $.getArticleBySlug(l);if(xa.value=s.data,wa.isLoggedIn&&(null==(a=xa.value)?void 0:a.id))try{const a=await $.isArticleLiked(xa.value.id);Aa.value=!!a.data}catch(e){Aa.value=!1}await Promise.all([Ma(),Pa()])}catch(l){xa.value=null,I.error("加载文章失败，请稍后重试")}finally{ja.value=!1}}),(a,e)=>{var m,f;const h=y,$=D,T=g,Ca=_,Ma=C,Pa=P,Fa=j,Ua=b,Va=v("router-link"),Oa=A;return p(),l("div",Y,[s("div",F,[ja.value?(p(),l("div",U,[t(h,{rows:10,animated:""})])):xa.value?(p(),l("div",V,[s("header",O,[s("div",S,[t(T,{separator:">"},{default:n(()=>[t($,{to:"/"},{default:n(()=>e[2]||(e[2]=[o("首页",-1)])),_:1,__:[2]}),t($,{to:"/study-notes"},{default:n(()=>e[3]||(e[3]=[o("学习笔记",-1)])),_:1,__:[3]}),t($,null,{default:n(()=>[o(u(xa.value.title),1)]),_:1})]),_:1})]),s("h1",B,u(xa.value.title),1),s("div",E,[s("div",G,[t(Ca,{src:null==(m=xa.value.author)?void 0:m.avatar,size:40},{default:n(()=>{var a,e;return[o(u(null==(e=null==(a=xa.value.author)?void 0:a.nickname)?void 0:e.charAt(0)),1)]}),_:1},8,["src"]),s("div",K,[s("div",N,u(null==(f=xa.value.author)?void 0:f.nickname),1),s("div",Q,"发布于 "+u(Ha(xa.value.publishedAt)),1)])]),s("div",R,[s("span",q,[t(Ma,null,{default:n(()=>[t(d(H))]),_:1}),o(u(xa.value.viewCount)+" 阅读",1)]),s("span",J,[t(Ma,null,{default:n(()=>[t(d(w))]),_:1}),o(u(xa.value.likeCount)+" 收藏",1)]),s("span",W,[t(Ma,null,{default:n(()=>[t(d(M))]),_:1}),o(u(xa.value.commentCount||0)+" 讨论",1)])])]),xa.value.tags&&xa.value.tags.length?(p(),l("div",X,[(p(!0),l(c,null,r(xa.value.tags,e=>(p(),k(Pa,{key:e.id,type:"info",effect:"plain",onClick:l=>a.$router.push(`/tag/${e.slug}`)},{default:n(()=>[o(u(e.name),1)]),_:2},1032,["onClick"]))),128))])):i("",!0)]),s("main",Z,[s("div",{class:"note-content",innerHTML:xa.value.content},null,8,aa)]),s("footer",ea,[s("div",la,[t(Fa,{type:Aa.value?"primary":"default",icon:d(w),onClick:$a},{default:n(()=>[o(u(Aa.value?"已收藏":"收藏")+" ("+u(xa.value.likeCount)+") ",1)]),_:1},8,["type","icon"]),t(Fa,{icon:d(x),onClick:za},{default:n(()=>e[4]||(e[4]=[o("分享笔记",-1)])),_:1,__:[4]},8,["icon"]),t(Fa,{icon:d(L),onClick:Ta},{default:n(()=>e[5]||(e[5]=[o("导出PDF",-1)])),_:1,__:[5]},8,["icon"])])]),s("section",sa,[s("h3",null,"学术讨论 ("+u(xa.value.commentCount||0)+")",1),d(wa).isLoggedIn?(p(),l("div",ta,[t(Ua,{modelValue:Ia.value,"onUpdate:modelValue":e[0]||(e[0]=a=>Ia.value=a),type:"textarea",rows:4,placeholder:"发表学术观点或提出问题...",maxlength:"1000","show-word-limit":""},null,8,["modelValue"]),s("div",ia,[t(Fa,{type:"primary",loading:Da.value,onClick:Ya},{default:n(()=>e[6]||(e[6]=[o(" 发布讨论 ",-1)])),_:1,__:[6]},8,["loading"])])])):(p(),l("div",na,[s("p",null,[t(Va,{to:"/auth/login"},{default:n(()=>e[7]||(e[7]=[o("登录",-1)])),_:1,__:[7]}),e[8]||(e[8]=o(" 后参与学术讨论 ",-1))])])),s("div",ua,[(p(!0),l(c,null,r(La.value,a=>{var c,r;return p(),l("div",{key:a.id,class:"discussion-item"},[s("div",oa,[t(Ca,{src:null==(c=a.user)?void 0:c.avatar,size:36},{default:n(()=>{var e,l;return[o(u(null==(l=null==(e=a.user)?void 0:e.nickname)?void 0:l.charAt(0)),1)]}),_:2},1032,["src"])]),s("div",ca,[s("div",ra,[s("span",da,u(null==(r=a.user)?void 0:r.nickname),1),s("span",va,u(Ha(a.createdAt)),1)]),s("div",ma,u(a.content),1),s("div",pa,[t(Fa,{size:"small",text:"",type:a.isLiked?"primary":"default",icon:d(w),onClick:e=>(async a=>{if(wa.isLoggedIn)try{a.isLiked?(await z.unlikeComment(a.id),a.likeCount--):(await z.likeComment(a.id),a.likeCount++),a.isLiked=!a.isLiked}catch(e){I.error("操作失败")}else I.warning("请先登录")})(a)},{default:n(()=>[o(u(a.isLiked?"已赞":"赞同")+" ",1),a.likeCount>0?(p(),l("span",ka,"("+u(a.likeCount)+")",1)):i("",!0)]),_:2},1032,["type","icon","onClick"]),t(Fa,{size:"small",text:"",icon:d(M)},{default:n(()=>e[9]||(e[9]=[o("回复",-1)])),_:1,__:[9]},8,["icon"])])])])}),128))])]),ba.value&&ba.value.length?(p(),l("section",fa,[e[10]||(e[10]=s("h3",null,"相关笔记",-1)),s("div",ya,[(p(!0),l(c,null,r(ba.value,e=>(p(),l("div",{key:e.id,class:"note-card",onClick:l=>a.$router.push(`/study-notes/${e.slug}`)},[s("h4",null,u(e.title),1),s("p",null,u(e.excerpt),1),s("div",_a,[s("span",null,u(Ha(e.publishedAt)),1),s("span",null,u(e.viewCount)+" 阅读",1)])],8,ga))),128))])])):i("",!0)])):(p(),l("div",ha,[t(Oa,{icon:"warning",title:"笔记不存在","sub-title":"抱歉，您访问的学习笔记不存在或已被删除"},{extra:n(()=>[t(Fa,{type:"primary",onClick:e[1]||(e[1]=e=>a.$router.push("/study-notes"))},{default:n(()=>e[11]||(e[11]=[o("返回学习笔记",-1)])),_:1,__:[11]})]),_:1})]))])])}}},[["__scopeId","data-v-36165c0c"]]);export{Ca as default};
