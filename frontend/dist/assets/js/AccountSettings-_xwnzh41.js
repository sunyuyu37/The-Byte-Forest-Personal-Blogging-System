/* empty css             *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                  *//* empty css                    *//* empty css                  *//* empty css                  */import{u as a,g as e,b as s}from"./index-di9GIa25.js";import{a as l,u as t}from"./security-GM4R7VwQ.js";import{r as o,K as i,a_ as r,j as d,E as n,W as u,T as c,G as m,aZ as p,b8 as v,m as f,b9 as g,aO as w}from"./element-plus-CXASJE3V.js";import{_ as b}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{r as h,X as _,p as y,c as V,a as P,Q as k,M as N,I as j,O as x,u as U,o as C}from"./vue-B9wWIsxR.js";import"./utils-C28rWPR3.js";const A={class:"account-settings"},E={class:"settings-header"},z={class:"header-content"},O={class:"title-section"},q={class:"page-title"},G={class:"settings-content"},D={class:"settings-grid"},H={class:"settings-card"},I={class:"card-content"},M={class:"avatar-upload"},B={class:"upload-actions"},F={class:"settings-card"},R={class:"card-content"},S={class:"preference-item"},T={class:"preference-item"},K={class:"preference-actions"},L={class:"settings-card"},Q={class:"card-content"},W={class:"settings-card"},X={class:"card-content"},Z={class:"status-grid"},$={class:"status-item"},J={class:"status-icon success"},Y={class:"status-info"},aa={class:"status-item"},ea={class:"status-icon success"},sa={class:"status-item"},la={class:"status-icon info"},ta={class:"status-info"},oa={class:"status-item"},ia={class:"status-icon info"},ra={class:"status-info"},da=b({__name:"AccountSettings",setup(b){const da=a(),na=h(),ua=h(),ca=h(!1),ma=h(!1),pa=h(!1),va=h(!1),fa=_({avatar:"",nickname:"",email:"",bio:"",website:"",github:""}),ga={nickname:[{max:50,message:"昵称长度不能超过50个字符",trigger:"blur"}],bio:[{max:200,message:"个人简介长度不能超过200个字符",trigger:"blur"}],website:[{max:200,message:"网站地址长度不能超过200个字符",trigger:"blur"}],github:[{max:200,message:"GitHub地址长度不能超过200个字符",trigger:"blur"}]},wa=_({oldPassword:"",newPassword:"",confirmPassword:""}),ba={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:100,message:"密码长度必须在6-100个字符之间",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(a,e,s)=>{e!==wa.newPassword?s(new Error("两次输入的密码不一致")):s()},trigger:"blur"}]},ha=_({emailNotifications:!0,desktopNotifications:!1}),_a=()=>{da.user&&Object.assign(fa,{avatar:da.user.avatar||"",nickname:da.user.nickname||"",email:da.user.email||"",bio:da.user.bio||"",website:da.user.website||"",github:da.user.github||""})},ya=async()=>{if(na.value)try{await na.value.validate(),ca.value=!0;const a={nickname:fa.nickname,bio:fa.bio,website:fa.website,github:fa.github},e=await s.updateUser(da.user.id,a);200===e.code?(da.updateUser(e.data),n.success("基本信息保存成功")):n.error(e.message||"保存失败")}catch(a){n.error("保存失败")}finally{ca.value=!1}},Va=()=>{_a(),n.info("已重置为原始信息")},Pa=a=>{const e=0===a.type.indexOf("image"),s=a.size/1024/1024<2;return e?s?(ma.value=!0,!0):(n.error("图片大小不能超过 2MB!"),!1):(n.error("只能上传图片文件!"),!1)},ka=async a=>{if(ma.value=!1,200===a.code){const l=a.data.fileUrl;fa.avatar=l;try{200===(await s.updateAvatar(da.user.id,l)).code?(da.updateUser({avatar:l}),n.success("头像上传成功")):n.error("头像更新失败")}catch(e){n.error("头像更新失败")}}else n.error(a.message||"头像上传失败")},Na=()=>{ma.value=!1,n.error("头像上传失败")},ja=async()=>{try{200===(await s.updateAvatar(da.user.id,"")).code?(fa.avatar="",da.updateUser({avatar:""}),n.success("头像已移除")):n.error("移除头像失败")}catch(a){n.error("移除头像失败")}},xa=async a=>{try{const e={loginNotificationEnabled:ha.emailNotifications,anomalyProtectionEnabled:ha.desktopNotifications};200===(await t(e)).code?n.success("设置已更新"):(n.error("设置更新失败"),ha[a]=!ha[a])}catch(e){n.error("设置更新失败"),ha[a]=!ha[a]}},Ua=async()=>{try{pa.value=!0;const a={loginNotificationEnabled:ha.emailNotifications,anomalyProtectionEnabled:ha.desktopNotifications},e=await t(a);200===e.code?n.success("偏好设置保存成功"):n.error(e.message||"保存失败")}catch(a){n.error("保存失败")}finally{pa.value=!1}},Ca=async()=>{if(ua.value)try{await ua.value.validate(),va.value=!0;const a=await s.updatePassword(da.user.id,{oldPassword:wa.oldPassword,newPassword:wa.newPassword});200===a.code?(n.success("密码修改成功"),Aa()):n.error(a.message||"密码修改失败")}catch(a){n.error("密码修改失败")}finally{va.value=!1}},Aa=()=>{Object.assign(wa,{oldPassword:"",newPassword:"",confirmPassword:""}),ua.value&&ua.value.clearValidate()};return y(()=>{_a(),(async()=>{try{const a=await l();200===a.code&&(ha.emailNotifications=a.data.loginNotificationEnabled||!1,ha.desktopNotifications=a.data.anomalyProtectionEnabled||!1)}catch(a){}})()}),(a,s)=>{var l,t,n;const b=o,h=m,_=d,y=p,_a=c,Ea=f,za=i,Oa=r;return C(),V("div",A,[P("div",E,[P("div",z,[P("div",O,[P("h1",q,[k(b,{class:"title-icon"},{default:j(()=>[k(U(u))]),_:1}),s[12]||(s[12]=N(" 账户设置 ",-1))]),s[13]||(s[13]=P("p",{class:"page-subtitle"},"管理您的个人信息和账户偏好设置",-1))])])]),P("div",G,[P("div",D,[P("div",H,[s[17]||(s[17]=P("div",{class:"card-header"},[P("h3",null,"基本信息"),P("p",null,"更新您的个人基本信息")],-1)),P("div",I,[k(za,{model:fa,rules:ga,ref_key:"userFormRef",ref:na,"label-width":"100px",class:"user-form"},{default:j(()=>[k(_a,{label:"头像"},{default:j(()=>[P("div",M,[k(h,{src:fa.avatar,size:80,class:"avatar-preview"},{default:j(()=>{var a;return[N(x((null==(a=fa.nickname)?void 0:a.charAt(0))||"A"),1)]}),_:1},8,["src"]),P("div",B,[k(y,{class:"avatar-uploader",action:"/api/files/upload/avatar",headers:{Authorization:`Bearer ${U(e)()}`},"show-file-list":!1,"on-success":ka,"on-error":Na,"before-upload":Pa,accept:"image/*"},{default:j(()=>[k(_,{type:"primary",size:"small",loading:ma.value},{default:j(()=>[k(b,null,{default:j(()=>[k(U(v))]),_:1}),N(" "+x(ma.value?"上传中...":"上传头像"),1)]),_:1},8,["loading"])]),_:1},8,["action","headers"]),k(_,{size:"small",onClick:ja,disabled:!fa.avatar},{default:j(()=>s[14]||(s[14]=[N("移除",-1)])),_:1,__:[14]},8,["disabled"])])])]),_:1}),k(_a,{label:"昵称",prop:"nickname"},{default:j(()=>[k(Ea,{modelValue:fa.nickname,"onUpdate:modelValue":s[0]||(s[0]=a=>fa.nickname=a),placeholder:"请输入昵称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),k(_a,{label:"邮箱",prop:"email"},{default:j(()=>[k(Ea,{modelValue:fa.email,"onUpdate:modelValue":s[1]||(s[1]=a=>fa.email=a),placeholder:"请输入邮箱",type:"email",readonly:""},null,8,["modelValue"]),s[15]||(s[15]=P("div",{class:"field-note"},"邮箱不支持修改",-1))]),_:1,__:[15]}),k(_a,{label:"个人简介",prop:"bio"},{default:j(()=>[k(Ea,{modelValue:fa.bio,"onUpdate:modelValue":s[2]||(s[2]=a=>fa.bio=a),type:"textarea",rows:4,placeholder:"介绍一下自己吧...",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),k(_a,{label:"个人网站",prop:"website"},{default:j(()=>[k(Ea,{modelValue:fa.website,"onUpdate:modelValue":s[3]||(s[3]=a=>fa.website=a),placeholder:"请输入个人网站地址",maxlength:"200"},null,8,["modelValue"])]),_:1}),k(_a,{label:"GitHub",prop:"github"},{default:j(()=>[k(Ea,{modelValue:fa.github,"onUpdate:modelValue":s[4]||(s[4]=a=>fa.github=a),placeholder:"请输入GitHub地址",maxlength:"200"},null,8,["modelValue"])]),_:1}),k(_a,null,{default:j(()=>[k(_,{type:"primary",onClick:ya,loading:ca.value},{default:j(()=>[N(x(ca.value?"保存中...":"保存更改"),1)]),_:1},8,["loading"]),k(_,{onClick:Va},{default:j(()=>s[16]||(s[16]=[N("重置",-1)])),_:1,__:[16]})]),_:1})]),_:1},8,["model"])])]),P("div",F,[s[20]||(s[20]=P("div",{class:"card-header"},[P("h3",null,"偏好设置"),P("p",null,"自定义您的使用体验")],-1)),P("div",R,[P("div",S,[s[18]||(s[18]=P("div",{class:"preference-info"},[P("h4",null,"邮件通知"),P("p",null,"接收系统邮件通知")],-1)),k(Oa,{modelValue:ha.emailNotifications,"onUpdate:modelValue":s[5]||(s[5]=a=>ha.emailNotifications=a),onChange:s[6]||(s[6]=a=>xa("emailNotifications"))},null,8,["modelValue"])]),P("div",T,[s[19]||(s[19]=P("div",{class:"preference-info"},[P("h4",null,"桌面通知"),P("p",null,"接收浏览器桌面通知")],-1)),k(Oa,{modelValue:ha.desktopNotifications,"onUpdate:modelValue":s[7]||(s[7]=a=>ha.desktopNotifications=a),onChange:s[8]||(s[8]=a=>xa("desktopNotifications"))},null,8,["modelValue"])]),P("div",K,[k(_,{type:"primary",onClick:Ua,loading:pa.value},{default:j(()=>[N(x(pa.value?"保存中...":"保存偏好"),1)]),_:1},8,["loading"])])])]),P("div",L,[s[22]||(s[22]=P("div",{class:"card-header"},[P("h3",null,"密码修改"),P("p",null,"定期更改密码可提高账户安全性")],-1)),P("div",Q,[k(za,{model:wa,rules:ba,ref_key:"passwordFormRef",ref:ua,"label-width":"100px"},{default:j(()=>[k(_a,{label:"当前密码",prop:"oldPassword"},{default:j(()=>[k(Ea,{modelValue:wa.oldPassword,"onUpdate:modelValue":s[9]||(s[9]=a=>wa.oldPassword=a),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),k(_a,{label:"新密码",prop:"newPassword"},{default:j(()=>[k(Ea,{modelValue:wa.newPassword,"onUpdate:modelValue":s[10]||(s[10]=a=>wa.newPassword=a),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),k(_a,{label:"确认密码",prop:"confirmPassword"},{default:j(()=>[k(Ea,{modelValue:wa.confirmPassword,"onUpdate:modelValue":s[11]||(s[11]=a=>wa.confirmPassword=a),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),k(_a,null,{default:j(()=>[k(_,{type:"primary",onClick:Ca,loading:va.value},{default:j(()=>[N(x(va.value?"修改中...":"修改密码"),1)]),_:1},8,["loading"]),k(_,{onClick:Aa},{default:j(()=>s[21]||(s[21]=[N("重置",-1)])),_:1,__:[21]})]),_:1})]),_:1},8,["model"])])]),P("div",W,[s[27]||(s[27]=P("div",{class:"card-header"},[P("h3",null,"账户状态"),P("p",null,"查看您的账户信息和状态")],-1)),P("div",X,[P("div",Z,[P("div",$,[P("div",J,[k(b,null,{default:j(()=>[k(U(g))]),_:1})]),P("div",Y,[s[23]||(s[23]=P("h4",null,"账户状态",-1)),P("p",null,x((null==(l=U(da).user)?void 0:l.status)?"正常":"已停用"),1)])]),P("div",aa,[P("div",ea,[k(b,null,{default:j(()=>[k(U(g))]),_:1})]),s[24]||(s[24]=P("div",{class:"status-info"},[P("h4",null,"邮箱验证"),P("p",null,"已验证")],-1))]),P("div",sa,[P("div",la,[k(b,null,{default:j(()=>[k(U(w))]),_:1})]),P("div",ta,[s[25]||(s[25]=P("h4",null,"用户角色",-1)),P("p",null,x("ADMIN"===(null==(t=U(da).user)?void 0:t.role)?"管理员":"普通用户"),1)])]),P("div",oa,[P("div",ia,[k(b,null,{default:j(()=>[k(U(w))]),_:1})]),P("div",ra,[s[26]||(s[26]=P("h4",null,"注册时间",-1)),P("p",null,x((qa=null==(n=U(da).user)?void 0:n.createdAt,qa?new Date(qa).toLocaleDateString("zh-CN"):"未知")),1)])])])])])])])]);var qa}}},[["__scopeId","data-v-81309321"]]);export{da as default};
