/* empty css             *//* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                  */import{r as e,X as a,b as t,Y as l,p as s,c as i,a as n,Q as o,I as r,J as u,K as d,H as c,O as p,ay as m,o as g,M as f,u as h,P as y,a6 as v}from"./vue-B9wWIsxR.js";import{j as _,K as w,J as b,a1 as C,E as k,aS as j,r as z,aT as $,T as x,m as T,a0 as V,a2 as I,aU as A,e as U,aG as B,aa as Y}from"./element-plus-CXASJE3V.js";import{g as L,b as P,c as S,d as D,p as H,u as M,e as O}from"./article-Pn5uYJFo.js";import{c as E}from"./category-PKu3E1eX.js";import{a as J,s as K,b as X}from"./positionedConfirm-DdmNknNt.js";import{_ as Z}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-di9GIa25.js";import"./utils-C28rWPR3.js";const G={class:"admin-articles"},Q={class:"page-header"},R={class:"search-section"},q={class:"table-section"},F={class:"article-title"},N={key:0,class:"batch-actions"},W={class:"pagination"},ee=Z({__name:"Articles",setup(Z){const ee=m(),ae=e(!1),te=e([]),le=e([]),se=e([]),ie=a({title:"",categoryId:"",status:""}),ne=a({page:1,size:10,total:0}),oe=t(()=>se.value.filter(e=>me(e.status,"draft")).length),re=t(()=>se.value.filter(e=>me(e.status,"published")).length),ue=t(()=>se.value.filter(e=>!me(e.status,"deleted")).length),de=t(()=>oe.value>0),ce=t(()=>re.value>0),pe=t(()=>ue.value>0),me=(e,a)=>(e?e.toLowerCase():"")===(a?a.toLowerCase():""),ge=e=>({published:"已发布",draft:"草稿",deleted:"已删除",archived:"已归档"}[e?e.toLowerCase():""]||"未知"),fe=e=>{se.value=e},he=()=>{ne.page=1,be()},ye=()=>{Object.assign(ie,{title:"",categoryId:"",status:""}),ne.page=1,be()},ve=()=>{ee.push("/admin/articles/create")},_e=e=>{ne.size=e,ne.page=1,be()},we=e=>{ne.page=e,be()},be=async()=>{ae.value=!0;try{let e=null;if(ie.categoryId){const a=le.value.find(e=>e.id==ie.categoryId);e=a?a.name:null}const a=await L({page:ne.page-1,size:ne.size,keyword:ie.title,status:ie.status,category:e,sortBy:"createdAt",sortDir:"desc"});200===a.code?(te.value=a.data.content,ne.total=a.data.totalElements):k.error(a.message||"加载文章列表失败")}catch(e){k.error("加载文章列表失败");const a=[{id:1,title:"Vue 3 Composition API 深度解析",category:{id:1,name:"技术分享"},author:{id:1,nickname:"管理员"},status:"published",isTop:!0,viewCount:1234,likeCount:56,commentCount:23,publishedAt:"2024-01-15T10:00:00Z"},{id:2,title:"2024年前端技术发展趋势报告",category:{id:5,name:"新闻资讯"},author:{id:1,nickname:"管理员"},status:"published",isTop:!1,viewCount:987,likeCount:43,commentCount:18,publishedAt:"2024-01-14T15:30:00Z"}];te.value=a,ne.total=a.length}finally{ae.value=!1}};return l(()=>{be()}),s(()=>{be(),(async()=>{try{const e=await E.getAllCategories();200===e.code?le.value=e.data:le.value=[{id:1,name:"技术分享"},{id:2,name:"生活随笔"},{id:3,name:"学习笔记"},{id:4,name:"项目实战"},{id:5,name:"新闻资讯"},{id:6,name:"竞赛活动"}]}catch(e){le.value=[{id:1,name:"技术分享"},{id:2,name:"生活随笔"},{id:3,name:"学习笔记"},{id:4,name:"项目实战"},{id:5,name:"新闻资讯"},{id:6,name:"竞赛活动"}]}})()}),(e,a)=>{const t=z,l=_,s=T,m=x,L=I,E=V,Z=w,Ce=A,ke=U,je=B,ze=j,$e=C,xe=b;return g(),i("div",G,[n("div",Q,[a[9]||(a[9]=n("h1",null,"文章管理",-1)),o(l,{type:"primary",onClick:ve},{default:r(()=>[o(t,null,{default:r(()=>[o(h($))]),_:1}),a[8]||(a[8]=f(" 新建文章 ",-1))]),_:1,__:[8]})]),n("div",R,[o(Z,{model:ie,inline:""},{default:r(()=>[o(m,{label:"标题"},{default:r(()=>[o(s,{modelValue:ie.title,"onUpdate:modelValue":a[0]||(a[0]=e=>ie.title=e),placeholder:"请输入文章标题",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),o(m,{label:"分类"},{default:r(()=>[o(E,{modelValue:ie.categoryId,"onUpdate:modelValue":a[1]||(a[1]=e=>ie.categoryId=e),placeholder:"请选择分类",clearable:"",style:{width:"150px"}},{default:r(()=>[(g(!0),i(y,null,v(le.value,e=>(g(),c(L,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(m,{label:"状态"},{default:r(()=>[o(E,{modelValue:ie.status,"onUpdate:modelValue":a[2]||(a[2]=e=>ie.status=e),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:r(()=>[o(L,{label:"已发布",value:"published"}),o(L,{label:"草稿",value:"draft"}),o(L,{label:"已删除",value:"deleted"})]),_:1},8,["modelValue"])]),_:1}),o(m,null,{default:r(()=>[o(l,{type:"primary",onClick:he},{default:r(()=>a[10]||(a[10]=[f("搜索",-1)])),_:1,__:[10]}),o(l,{onClick:ye},{default:r(()=>a[11]||(a[11]=[f("重置",-1)])),_:1,__:[11]})]),_:1})]),_:1},8,["model"])]),n("div",q,[u((g(),c(ze,{data:te.value,style:{width:"100%"},onSelectionChange:fe},{default:r(()=>[o(Ce,{type:"selection",width:"55"}),o(Ce,{prop:"title",label:"标题","min-width":"200"},{default:r(({row:e})=>[n("div",F,[n("span",null,p(e.title),1),e.isTop?(g(),c(ke,{key:0,type:"danger",size:"small",style:{"margin-left":"8px"}},{default:r(()=>a[12]||(a[12]=[f(" 置顶 ",-1)])),_:1,__:[12]})):d("",!0)])]),_:1}),o(Ce,{prop:"category",label:"分类",width:"120"},{default:r(({row:e})=>[o(ke,{type:"info",size:"small"},{default:r(()=>{var a;return[f(p(null==(a=e.category)?void 0:a.name),1)]}),_:2},1024)]),_:1}),o(Ce,{prop:"author",label:"作者",width:"120"},{default:r(({row:e})=>{var a;return[f(p(null==(a=e.author)?void 0:a.nickname),1)]}),_:1}),o(Ce,{prop:"status",label:"状态",width:"100"},{default:r(({row:e})=>{return[o(ke,{type:(a=e.status,{published:"success",draft:"warning",deleted:"danger",archived:"info"}[a?a.toLowerCase():""]||"info"),size:"small"},{default:r(()=>[f(p(ge(e.status)),1)]),_:2},1032,["type"])];var a}),_:1}),o(Ce,{prop:"viewCount",label:"阅读量",width:"100"}),o(Ce,{prop:"likeCount",label:"点赞数",width:"100"}),o(Ce,{prop:"commentCount",label:"评论数",width:"100"}),o(Ce,{prop:"publishedAt",label:"发布时间",width:"180"},{default:r(({row:e})=>{return[f(p((a=e.publishedAt,a?Y(a).format("YYYY-MM-DD HH:mm"):"-")),1)];var a}),_:1}),o(Ce,{label:"操作",width:"240",fixed:"right"},{default:r(({row:e})=>[o(l,{type:"primary",size:"small",onClick:a=>(e=>{ee.push(`/admin/articles/${e.id}/edit`)})(e)},{default:r(()=>a[13]||(a[13]=[f(" 编辑 ",-1)])),_:2,__:[13]},1032,["onClick"]),me(e.status,"draft")?(g(),c(l,{key:0,type:"primary",size:"small",onClick:a=>(async(e,a)=>{let t=null;try{if(me(e.status,"published"))return void k.warning("文章已经是发布状态");await J(`确定要发布文章《${e.title}》吗？\n\n发布后文章将在前台显示，用户可以浏览和评论。`,"确认发布",{confirmButtonText:"确定发布",cancelButtonText:"取消"},a),t=k({message:"正在发布文章...",type:"info",duration:0});const l=await H(e.id);200===l.code?(k.success("文章发布成功"),be()):k.error(l.message||"发布失败")}catch(l){"cancel"!==l&&"close"!==l&&k.error("发布失败: "+(l.message||l))}finally{if(t)try{t.close()}catch(s){}}})(e,a)},{default:r(()=>a[14]||(a[14]=[f(" 发布 ",-1)])),_:2,__:[14]},1032,["onClick"])):me(e.status,"published")?(g(),c(l,{key:1,type:"warning",size:"small",onClick:a=>(async(e,a)=>{let t=null;try{if(me(e.status,"draft"))return void k.warning("文章已经是草稿状态");await K(`确定下线文章《${e.title}》吗？`,"确认下线",{confirmButtonText:"确定",cancelButtonText:"取消"},a),t=k({message:"正在下线文章...",type:"info",duration:0});const l=await M(e.id);200===l.code?(k.success("文章下线成功"),be()):k.error(l.message||"下线失败")}catch(l){"cancel"!==l&&"close"!==l&&k.error("下线失败: "+(l.message||l))}finally{if(t)try{t.close()}catch(s){}}})(e,a)},{default:r(()=>a[15]||(a[15]=[f(" 下线 ",-1)])),_:2,__:[15]},1032,["onClick"])):d("",!0),me(e.status,"deleted")?(g(),c(je,{key:3,content:"文章已被删除",placement:"top"},{default:r(()=>[o(l,{type:"info",size:"small",disabled:""},{default:r(()=>a[17]||(a[17]=[f(" 已删除 ",-1)])),_:1,__:[17]})]),_:1})):(g(),c(l,{key:2,type:"danger",size:"small",onClick:a=>(async(e,a)=>{let t=null;try{await X(e.title,a),t=k({message:"正在删除文章...",type:"info",duration:0});const l=await O(e.id);200===l.code?(k.success("文章删除成功"),be()):k.error(l.message||"删除失败")}catch(l){"cancel"!==l&&"close"!==l&&k.error("删除失败: "+(l.message||l))}finally{if(t)try{t.close()}catch(s){}}})(e,a)},{default:r(()=>a[16]||(a[16]=[f(" 删除 ",-1)])),_:2,__:[16]},1032,["onClick"]))]),_:1})]),_:1},8,["data"])),[[xe,ae.value]]),se.value.length>0?(g(),i("div",N,[n("span",null,"已选择 "+p(se.value.length)+" 项",1),de.value?(g(),c(l,{key:0,type:"primary",size:"small",onClick:a[3]||(a[3]=e=>(async e=>{let a=null;try{if(0===se.value.length)return void k.warning("请先选择要发布的文章");const t=se.value.filter(e=>me(e.status,"published"));if(t.length>0)return void k.warning(`选中的文章中有 ${t.length} 篇已经是发布状态`);await J(`确定要发布选中的 ${se.value.length} 篇文章吗？\n\n发布后这些文章将在前台显示，用户可以浏览和评论。`,"确认批量发布",e),a=k({message:`正在发布 ${se.value.length} 篇文章...`,type:"info",duration:0});const l=se.value.map(e=>e.id),s=await P(l);200===s.code?(k.success(`成功发布 ${se.value.length} 篇文章`),se.value=[],be()):k.error(s.message||"批量发布失败")}catch(t){"cancel"!==t&&"close"!==t&&k.error("批量发布失败: "+(t.message||t))}finally{if(a)try{a.close()}catch(l){}}})(e))},{default:r(()=>[f(" 批量发布 ("+p(oe.value)+") ",1)]),_:1})):d("",!0),ce.value?(g(),c(l,{key:1,type:"warning",size:"small",onClick:a[4]||(a[4]=e=>(async e=>{let a=null;try{if(0===se.value.length)return void k.warning("请先选择要下线的文章");const t=se.value.filter(e=>me(e.status,"draft"));if(t.length>0)return void k.warning(`选中的文章中有 ${t.length} 篇已经是草稿状态`);await K(`确定下线选中的 ${se.value.length} 篇文章吗？`,"批量下线",e),a=k({message:`正在下线 ${se.value.length} 篇文章...`,type:"info",duration:0});const l=se.value.map(e=>e.id),s=await S(l);200===s.code?(k.success(`成功下线 ${se.value.length} 篇文章`),se.value=[],be()):k.error(s.message||"批量下线失败")}catch(t){"cancel"!==t&&"close"!==t&&k.error("批量下线失败: "+(t.message||t))}finally{if(a)try{a.close()}catch(l){}}})(e))},{default:r(()=>[f(" 批量下线 ("+p(re.value)+") ",1)]),_:1})):d("",!0),pe.value?(g(),c(l,{key:2,type:"danger",size:"small",onClick:a[5]||(a[5]=e=>(async e=>{let a=null;try{if(0===se.value.length)return void k.warning("请先选择要删除的文章");const t=se.value.filter(e=>me(e.status,"deleted"));if(t.length>0)return void k.warning(`选中的文章中有 ${t.length} 篇已经是删除状态`);await X(`选中的 ${se.value.length} 篇文章`,e),a=k({message:`正在删除 ${se.value.length} 篇文章...`,type:"info",duration:0});const l=se.value.map(e=>e.id),s=await D(l);200===s.code?(k.success(`成功删除 ${se.value.length} 篇文章`),se.value=[],be()):k.error(s.message||"批量删除失败")}catch(t){"cancel"!==t&&"close"!==t&&k.error("批量删除失败: "+(t.message||t))}finally{if(a)try{a.close()}catch(l){}}})(e))},{default:r(()=>[f(" 批量删除 ("+p(ue.value)+") ",1)]),_:1})):d("",!0)])):d("",!0),n("div",W,[o($e,{"current-page":ne.page,"onUpdate:currentPage":a[6]||(a[6]=e=>ne.page=e),"page-size":ne.size,"onUpdate:pageSize":a[7]||(a[7]=e=>ne.size=e),"page-sizes":[10,20,50,100],total:ne.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:_e,onCurrentChange:we},null,8,["current-page","page-size","total"])])])])}}},[["__scopeId","data-v-fedb58cc"]]);export{ee as default};
