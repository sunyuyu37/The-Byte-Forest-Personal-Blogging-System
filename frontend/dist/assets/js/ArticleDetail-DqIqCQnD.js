/* empty css             *//* empty css                  *//* empty css                 *//* empty css                  *//* empty css               *//* empty css                  *//* empty css                           *//* empty css                         */import{r as a,p as e,w as l,c as t,a as s,Q as i,K as n,I as o,O as u,M as r,P as c,a6 as d,u as v,al as m,aD as p,o as k,H as f}from"./vue-B9wWIsxR.js";import{u as g}from"./index-di9GIa25.js";import{a6 as y,a7 as _,G as h,r as C,F as w,j as L,a8 as j,m as b,a9 as x,E as A,aa as I,ab as M,a5 as H,U as D,e as T}from"./element-plus-CXASJE3V.js";import{a as Y}from"./article-Pn5uYJFo.js";import{c as z}from"./comment-DttPZ_iH.js";import{_ as P}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./utils-C28rWPR3.js";const U={class:"article-detail"},V={class:"container"},$={key:0,class:"loading"},O={key:1,class:"article-content"},B={class:"article-header"},E={class:"breadcrumb"},F={class:"title"},G={class:"meta"},K={class:"author-info"},Q={class:"author-details"},S={class:"name"},q={class:"time"},J={class:"stats"},N={class:"stat-item"},R={class:"stat-item"},W={class:"stat-item"},X={key:0,class:"tags"},Z={class:"article-body"},aa=["innerHTML"],ea={class:"article-footer"},la={class:"actions"},ta={class:"comments-section"},sa={key:0,class:"comment-form"},ia={class:"form-actions"},na={key:1,class:"login-prompt"},oa={class:"comments-list"},ua={class:"comment-avatar"},ra={class:"comment-content"},ca={class:"comment-header"},da={class:"username"},va={class:"time"},ma={class:"comment-text"},pa={class:"comment-actions"},ka={key:0},fa={key:2,class:"not-found"},ga=P({__name:"ArticleDetail",setup(P){const ga=p(),ya=g(),_a=a(!0),ha=a(null),Ca=a([]),wa=a(!1),La=a(""),ja=a(!1),ba=a=>I(a).format("YYYY-MM-DD HH:mm"),xa=async()=>{var a,e;_a.value=!0;try{const e=ga.params.slug,t=await Y.getArticleBySlug(e);if(ha.value=t.data,ya.isLoggedIn&&(null==(a=ha.value)?void 0:a.id))try{const a=await Y.isArticleLiked(ha.value.id);wa.value=!!a.data}catch(l){wa.value=!1}else wa.value=!1;await Aa()}catch(t){ha.value=null,404===(null==(e=t.response)?void 0:e.status)?A.error("文章不存在"):A.error("加载文章失败，请稍后重试")}finally{_a.value=!1}},Aa=async()=>{var a;if(ha.value)try{const e=ha.value.slug||ha.value.id,l=await z.getArticleComments(e),t=(null==(a=l.data)?void 0:a.content)||l.data||[];Ca.value=t.map(a=>({...a,isLiked:!1,likeCount:a.likeCount||0})),ya.isLoggedIn&&await Promise.all(Ca.value.map(async a=>{try{const e=await z.isCommentLiked(a.id);a.isLiked=!!e.data}catch{}}))}catch(e){}},Ia=async()=>{var a,e,l;if(ya.isLoggedIn){if(null==(a=ha.value)?void 0:a.id)try{wa.value?(await Y.unlikeArticle(ha.value.id),wa.value=!1,ha.value.likeCount=Math.max(0,(ha.value.likeCount||0)-1),A.success("取消点赞")):(await Y.likeArticle(ha.value.id),wa.value=!0,ha.value.likeCount=(ha.value.likeCount||0)+1,A.success("点赞成功"))}catch(t){A.error((null==(l=null==(e=null==t?void 0:t.response)?void 0:e.data)?void 0:l.message)||"操作失败，请重试")}}else A.warning("请先登录")},Ma=()=>{navigator.share?navigator.share({title:ha.value.title,text:ha.value.summary,url:window.location.href}):(navigator.clipboard.writeText(window.location.href),A.success("链接已复制到剪贴板"))},Ha=async()=>{var a,e;if(ya.isLoggedIn)if(La.value.trim()){ja.value=!0;try{await z.createComment({articleId:ha.value.id,content:La.value.trim()});await Aa(),ha.value.commentCount=(ha.value.commentCount||0)+1,La.value="",A.success("评论成功")}catch(l){A.error((null==(e=null==(a=null==l?void 0:l.response)?void 0:a.data)?void 0:e.message)||"发表评论失败，请稍后重试")}finally{ja.value=!1}}else A.warning("请输入评论内容");else A.warning("请先登录")};return e(()=>{xa()}),l(()=>ga.params.slug,()=>{xa()}),(a,e)=>{var l,p;const g=y,I=M,Y=_,P=h,ga=C,xa=T,Aa=L,Da=b,Ta=m("router-link"),Ya=x;return k(),t("div",U,[s("div",V,[_a.value?(k(),t("div",$,[i(g,{rows:10,animated:""})])):ha.value?(k(),t("div",O,[s("header",B,[s("div",E,[i(Y,{separator:"/"},{default:o(()=>[i(I,{to:"/"},{default:o(()=>e[2]||(e[2]=[r("首页",-1)])),_:1,__:[2]}),i(I,{to:"/articles"},{default:o(()=>e[3]||(e[3]=[r("文章",-1)])),_:1,__:[3]}),i(I,null,{default:o(()=>[r(u(ha.value.title),1)]),_:1})]),_:1})]),s("h1",F,u(ha.value.title),1),s("div",G,[s("div",K,[i(P,{src:null==(l=ha.value.author)?void 0:l.avatar,size:40},{default:o(()=>{var a,e;return[r(u(null==(e=null==(a=ha.value.author)?void 0:a.nickname)?void 0:e.charAt(0)),1)]}),_:1},8,["src"]),s("div",Q,[s("div",S,u(null==(p=ha.value.author)?void 0:p.nickname),1),s("div",q,u(ba(ha.value.publishedAt)),1)])]),s("div",J,[s("span",N,[i(ga,null,{default:o(()=>[i(v(H))]),_:1}),r(" "+u(ha.value.viewCount)+" 阅读 ",1)]),s("span",R,[i(ga,null,{default:o(()=>[i(v(w))]),_:1}),r(" "+u(ha.value.likeCount)+" 点赞 ",1)]),s("span",W,[i(ga,null,{default:o(()=>[i(v(D))]),_:1}),r(" "+u(ha.value.commentCount||0)+" 评论 ",1)])])]),ha.value.tags&&ha.value.tags.length?(k(),t("div",X,[(k(!0),t(c,null,d(ha.value.tags,e=>(k(),f(xa,{key:e.id,type:"primary",effect:"plain",onClick:l=>a.$router.push(`/tag/${e.slug}`)},{default:o(()=>[r(u(e.name),1)]),_:2},1032,["onClick"]))),128))])):n("",!0)]),s("main",Z,[s("div",{class:"content",innerHTML:ha.value.content},null,8,aa)]),s("footer",ea,[s("div",la,[i(Aa,{type:wa.value?"primary":"default",icon:v(w),onClick:Ia},{default:o(()=>[r(u(wa.value?"已点赞":"点赞")+" ("+u(ha.value.likeCount)+") ",1)]),_:1},8,["type","icon"]),i(Aa,{icon:v(j),onClick:Ma},{default:o(()=>e[4]||(e[4]=[r(" 分享 ",-1)])),_:1,__:[4]},8,["icon"])])]),s("section",ta,[s("h3",null,"评论 ("+u(ha.value.commentCount||0)+")",1),v(ya).isLoggedIn?(k(),t("div",sa,[i(Da,{modelValue:La.value,"onUpdate:modelValue":e[0]||(e[0]=a=>La.value=a),type:"textarea",rows:4,placeholder:"写下你的评论...",maxlength:"500","show-word-limit":""},null,8,["modelValue"]),s("div",ia,[i(Aa,{type:"primary",loading:ja.value,onClick:Ha},{default:o(()=>e[5]||(e[5]=[r(" 发表评论 ",-1)])),_:1,__:[5]},8,["loading"])])])):(k(),t("div",na,[s("p",null,[i(Ta,{to:"/auth/login"},{default:o(()=>e[6]||(e[6]=[r("登录",-1)])),_:1,__:[6]}),e[7]||(e[7]=r(" 后参与评论 ",-1))])])),s("div",oa,[(k(!0),t(c,null,d(Ca.value,a=>{var e,l;return k(),t("div",{key:a.id,class:"comment-item"},[s("div",ua,[i(P,{src:null==(e=a.user)?void 0:e.avatar,size:36},{default:o(()=>{var e,l;return[r(u(null==(l=null==(e=a.user)?void 0:e.nickname)?void 0:l.charAt(0)),1)]}),_:2},1032,["src"])]),s("div",ra,[s("div",ca,[s("span",da,u(null==(l=a.user)?void 0:l.nickname),1),s("span",va,u(ba(a.createdAt)),1)]),s("div",ma,u(a.content),1),s("div",pa,[i(Aa,{size:"small",text:"",type:a.isLiked?"primary":"default",icon:v(w),onClick:e=>(async a=>{var e,l;if(ya.isLoggedIn)try{a.isLiked?(await z.unlikeComment(a.id),a.isLiked=!1,a.likeCount=Math.max(0,(a.likeCount||0)-1),A.success("已取消点赞评论")):(await z.likeComment(a.id),a.isLiked=!0,a.likeCount=(a.likeCount||0)+1,A.success("已点赞评论"))}catch(t){A.error((null==(l=null==(e=null==t?void 0:t.response)?void 0:e.data)?void 0:l.message)||"操作失败，请重试")}else A.warning("请先登录")})(a)},{default:o(()=>[r(u(a.isLiked?"已赞":"点赞")+" ",1),a.likeCount>0?(k(),t("span",ka,"("+u(a.likeCount)+")",1)):n("",!0)]),_:2},1032,["type","icon","onClick"])])])])}),128))])])])):(k(),t("div",fa,[i(Ya,{icon:"warning",title:"文章不存在","sub-title":"抱歉，您访问的文章不存在或已被删除"},{extra:o(()=>[i(Aa,{type:"primary",onClick:e[1]||(e[1]=e=>a.$router.push("/articles"))},{default:o(()=>e[8]||(e[8]=[r(" 返回文章列表 ",-1)])),_:1,__:[8]})]),_:1})]))])])}}},[["__scopeId","data-v-bf399390"]]);export{ga as default};
