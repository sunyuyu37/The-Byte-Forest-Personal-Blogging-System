import{_ as ge,r as V,av as B,c as fe,o as _e,b as j,d as f,e as a,w as s,j as be,P as ve,J as I,I as P,H as h,bd as v,L as d,l as E,G as u,n as we,h as ye,b3 as Ve,E as he,F as ke,X as Ce,ac as Ee}from"./index-Da7ZqcH5.js";/* empty css                *//* empty css                *//* empty css              *//* empty css                   *//* empty css               */import"./scrollbar-PN-ehNXN.js";/* empty css                     */import"./tooltip-l0sNRNKZ.js";/* empty css               *//* empty css                  */import{h as Ue,d as xe,s as A,f as F,g as ze,i as Te,j as Be}from"./positionedConfirm-C6ixQw3s.js";import{a as q}from"./placeholder-BiywPu__.js";import{E as Ae,a as De}from"./index-BJ8ssZSI.js";import{v as Se}from"./directive-iqmOBkSf.js";import{E as Le}from"./index-DSEo_ZHY.js";import{E as Re,a as $e}from"./index-mDFjMy5P.js";import{a as je}from"./index-CZyikzse.js";import"./vnode-DsZHVpXe.js";import"./index-k6BulDX8.js";import"./index-lPpvXrw4.js";import"./isEqual-HUGtL056.js";import"./_Uint8Array-CNK7Frb1.js";import"./index-Chbwi6h6.js";import"./index-BwTCsBpr.js";import"./castArray-DVWVVBpp.js";import"./index-Ddj3Fd5B.js";import"./index-R92uOlC6.js";import"./index-DuvIoQvO.js";import"./index-ViZWhRvA.js";import"./index-BLAWzDFp.js";const Ie={class:"admin-users"},Pe={class:"page-header"},Fe={class:"search-section"},qe={class:"table-section"},Me={class:"user-info"},Ne={class:"user-details"},Oe={class:"username"},Ye={class:"nickname"},He={key:0,class:"batch-actions"},Ze={class:"pagination"},Ge={class:"dialog-footer"},Je={__name:"Users",setup(We){const U=V(!1),x=V([]),g=V([]),y=V(!1),z=V(!1),T=V(),i=B({username:"",nickname:"",email:"",role:"",status:""}),o=B({id:null,username:"",nickname:"",email:"",password:"",role:"user",avatar:"",bio:"",status:"active"}),m=B({page:1,size:20,total:0}),M={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线",trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:1,max:50,message:"昵称长度在 1 到 50 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]},N=fe(()=>o.id?"编辑用户":"新建用户"),O=l=>({admin:"danger",user:"primary"})[l]||"info",Y=l=>({admin:"管理员",user:"普通用户"})[l]||"未知",D=l=>l?Ee(l).format("YYYY-MM-DD HH:mm"):"-",H=l=>{g.value=l},Z=async l=>{try{const e=await v.toggleUserStatus(l.id);if(e.code===200)d.success("状态更新成功"),l.status=e.data.status?"active":"disabled";else throw new Error(e.message||"状态更新失败")}catch(e){console.error("更新状态失败:",e),d.error(e.message||"状态更新失败"),l.status=l.status==="active"?"disabled":"active"}},G=()=>{m.page=1,_()},J=()=>{Object.assign(i,{username:"",nickname:"",email:"",role:"",status:""}),m.page=1,_()},W=()=>{S(),y.value=!0},X=l=>{Object.assign(o,{id:l.id,username:l.username,nickname:l.nickname,email:l.email,password:"",role:l.role,avatar:l.avatar,bio:l.bio,status:l.status}),y.value=!0},K=async(l,e)=>{try{await A(`确定要重置用户"${l.username}"的密码吗？`,"确认",e);const n=await v.resetPassword(l.id);if(n.code===200)d.success("密码重置成功");else throw new Error(n.message||"密码重置失败")}catch(n){n!=="cancel"&&(console.error("重置密码失败:",n),d.error(n.message||"重置密码失败"))}},Q=async(l,e)=>{if(l.role==="admin"){d.warning("管理员用户无法删除");return}try{await F(l.username,e);const n=await v.deleteUser(l.id);if(n.code===200)d.success("删除成功"),await _();else throw new Error(n.message||"删除用户失败")}catch(n){n!=="cancel"&&(console.error("删除用户失败:",n),d.error(n.message||"删除失败"))}},ee=async l=>{if(g.value.length===0){d.warning("请选择要启用的用户");return}try{await A(`确定要启用选中的 ${g.value.length} 个用户吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消"},l);const e=g.value.map(r=>r.id),n=await v.batchEnableUsers(e);if(n.code===200)d.success("批量启用成功"),g.value=[],await _();else throw new Error(n.message||"批量启用失败")}catch(e){e!=="cancel"&&(console.error("批量启用失败:",e),d.error(e.message||"批量启用失败"))}},ae=async l=>{if(g.value.length===0){d.warning("请选择要禁用的用户");return}try{await A(`确定要禁用选中的 ${g.value.length} 个用户吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消"},l);const e=g.value.map(r=>r.id),n=await v.batchDisableUsers(e);if(n.code===200)d.success("批量禁用成功"),g.value=[],await _();else throw new Error(n.message||"批量禁用失败")}catch(e){e!=="cancel"&&(console.error("批量禁用失败:",e),d.error(e.message||"批量禁用失败"))}},te=async l=>{const e=g.value.filter(n=>n.role!=="admin");if(e.length===0){d.warning("选中的用户中包含管理员，无法删除");return}try{await F(`确定要删除选中的 ${e.length} 个用户吗？删除后无法恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消"},l);const n=e.map(p=>p.id),r=await v.batchDeleteUsers(n);if(r.code===200)d.success("批量删除成功"),g.value=[],await _();else throw new Error(r.message||"批量删除失败")}catch(n){n!=="cancel"&&(console.error("批量删除失败:",n),d.error(n.message||"批量删除失败"))}},le=async()=>{try{await T.value.validate(),z.value=!0;const l={username:o.username,nickname:o.nickname,email:o.email,role:o.role.toUpperCase(),avatar:o.avatar,bio:o.bio,status:o.status==="active"};!o.id&&o.password&&(l.password=o.password);let e;if(o.id?e=await v.updateUserByAdmin(o.id,l):e=await v.createUser(l),e.code===200)d.success(o.id?"更新成功":"创建成功"),y.value=!1,_();else throw new Error(e.message||(o.id?"更新用户失败":"创建用户失败"))}catch(l){console.error("提交失败:",l),d.error(l.message||"操作失败")}finally{z.value=!1}},se=()=>{var l;(l=T.value)==null||l.resetFields(),S()},S=()=>{Object.assign(o,{id:null,username:"",nickname:"",email:"",password:"",role:"user",avatar:"",bio:"",status:"active"})},oe=l=>{m.size=l,m.page=1,_()},ne=l=>{m.page=l,_()},_=async()=>{U.value=!0;try{const l={page:m.page-1,size:m.size},e=[];i.username&&e.push(i.username),i.nickname&&e.push(i.nickname),i.email&&e.push(i.email),e.length>0&&(l.keyword=e.join(" ")),i.role&&(l.role=i.role);const n=await v.getUsers(l);if(n.code===200)x.value=n.data.content.map(r=>{var p;return{id:r.id,username:r.username,nickname:r.nickname||r.username,email:r.email,role:((p=r.role)==null?void 0:p.toLowerCase())||"user",avatar:r.avatar||q(r.nickname||r.username,40),bio:r.bio||"",articleCount:r.articleCount||0,commentCount:0,status:r.status?"active":"disabled",lastLoginAt:r.lastLoginTime,createdAt:r.createdAt}}),m.total=n.data.totalElements;else throw new Error(n.message||"获取用户列表失败")}catch(l){console.error("加载用户列表失败:",l),d.error(`加载用户列表失败: ${l.message}`),x.value=[{id:1,username:"admin",nickname:"管理员",email:"admin@example.com",role:"admin",avatar:q("管理员",40),bio:"系统管理员",articleCount:15,commentCount:25,status:"active",lastLoginAt:"2025-08-10T10:00:00Z",createdAt:"2025-08-10T10:00:00Z"}],m.total=1}finally{U.value=!1}};return _e(()=>{_()}),(l,e)=>{const n=we,r=be,p=he,c=De,k=$e,L=Re,R=Ae,b=ze,re=ke,ie=Ce,de=je,ue=xe,me=Le,C=Be,$=Te,pe=Ue,ce=Se;return E(),j("div",Ie,[f("div",Pe,[e[21]||(e[21]=f("h1",null,"用户管理",-1)),a(r,{type:"primary",onClick:W},{default:s(()=>[a(n,null,{default:s(()=>[a(ye(Ve))]),_:1}),e[20]||(e[20]=u(" 新建用户 ",-1))]),_:1,__:[20]})]),f("div",Fe,[a(R,{model:i,inline:""},{default:s(()=>[a(c,{label:"用户名"},{default:s(()=>[a(p,{modelValue:i.username,"onUpdate:modelValue":e[0]||(e[0]=t=>i.username=t),placeholder:"请输入用户名",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),a(c,{label:"昵称"},{default:s(()=>[a(p,{modelValue:i.nickname,"onUpdate:modelValue":e[1]||(e[1]=t=>i.nickname=t),placeholder:"请输入昵称",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),a(c,{label:"邮箱"},{default:s(()=>[a(p,{modelValue:i.email,"onUpdate:modelValue":e[2]||(e[2]=t=>i.email=t),placeholder:"请输入邮箱",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),a(c,{label:"角色"},{default:s(()=>[a(L,{modelValue:i.role,"onUpdate:modelValue":e[3]||(e[3]=t=>i.role=t),placeholder:"请选择角色",clearable:"",style:{width:"120px"}},{default:s(()=>[a(k,{label:"管理员",value:"admin"}),a(k,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"状态"},{default:s(()=>[a(L,{modelValue:i.status,"onUpdate:modelValue":e[4]||(e[4]=t=>i.status=t),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:s(()=>[a(k,{label:"正常",value:"active"}),a(k,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),a(c,null,{default:s(()=>[a(r,{type:"primary",onClick:G},{default:s(()=>e[22]||(e[22]=[u("搜索",-1)])),_:1,__:[22]}),a(r,{onClick:J},{default:s(()=>e[23]||(e[23]=[u("重置",-1)])),_:1,__:[23]})]),_:1})]),_:1},8,["model"])]),f("div",qe,[ve((E(),P(ue,{data:x.value,style:{width:"100%"},onSelectionChange:H},{default:s(()=>[a(b,{type:"selection",width:"55"}),a(b,{prop:"user",label:"用户信息","min-width":"200"},{default:s(({row:t})=>[f("div",Me,[a(re,{size:40,src:t.avatar},null,8,["src"]),f("div",Ne,[f("div",Oe,h(t.username),1),f("div",Ye,h(t.nickname),1)])])]),_:1}),a(b,{prop:"email",label:"邮箱",width:"200"}),a(b,{prop:"role",label:"角色",width:"100"},{default:s(({row:t})=>[a(ie,{type:O(t.role),size:"small"},{default:s(()=>[u(h(Y(t.role)),1)]),_:2},1032,["type"])]),_:1}),a(b,{prop:"articleCount",label:"文章数",width:"100"}),a(b,{prop:"commentCount",label:"评论数",width:"100"}),a(b,{prop:"lastLoginAt",label:"最后登录",width:"180"},{default:s(({row:t})=>[u(h(D(t.lastLoginAt)),1)]),_:1}),a(b,{prop:"status",label:"状态",width:"100"},{default:s(({row:t})=>[a(de,{modelValue:t.status,"onUpdate:modelValue":w=>t.status=w,"active-value":"active","inactive-value":"disabled",onChange:w=>Z(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(b,{prop:"createdAt",label:"注册时间",width:"180"},{default:s(({row:t})=>[u(h(D(t.createdAt)),1)]),_:1}),a(b,{label:"操作",width:"200",fixed:"right"},{default:s(({row:t})=>[a(r,{type:"primary",size:"small",onClick:w=>X(t)},{default:s(()=>e[24]||(e[24]=[u(" 编辑 ",-1)])),_:2,__:[24]},1032,["onClick"]),a(r,{type:"warning",size:"small",onClick:w=>K(t,w)},{default:s(()=>e[25]||(e[25]=[u(" 重置密码 ",-1)])),_:2,__:[25]},1032,["onClick"]),a(r,{type:"danger",size:"small",onClick:w=>Q(t,w),disabled:t.role==="admin"},{default:s(()=>e[26]||(e[26]=[u(" 删除 ",-1)])),_:2,__:[26]},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[ce,U.value]]),g.value.length>0?(E(),j("div",He,[f("span",null,"已选择 "+h(g.value.length)+" 项",1),a(r,{type:"success",size:"small",onClick:e[5]||(e[5]=t=>ee(t))},{default:s(()=>e[27]||(e[27]=[u(" 批量启用 ",-1)])),_:1,__:[27]}),a(r,{type:"warning",size:"small",onClick:e[6]||(e[6]=t=>ae(t))},{default:s(()=>e[28]||(e[28]=[u(" 批量禁用 ",-1)])),_:1,__:[28]}),a(r,{type:"danger",size:"small",onClick:e[7]||(e[7]=t=>te(t))},{default:s(()=>e[29]||(e[29]=[u(" 批量删除 ",-1)])),_:1,__:[29]})])):I("",!0),f("div",Ze,[a(me,{"current-page":m.page,"onUpdate:currentPage":e[8]||(e[8]=t=>m.page=t),"page-size":m.size,"onUpdate:pageSize":e[9]||(e[9]=t=>m.size=t),"page-sizes":[10,20,50,100],total:m.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:oe,onCurrentChange:ne},null,8,["current-page","page-size","total"])])]),a(pe,{modelValue:y.value,"onUpdate:modelValue":e[19]||(e[19]=t=>y.value=t),title:N.value,width:"600px",onClose:se},{footer:s(()=>[f("div",Ge,[a(r,{onClick:e[18]||(e[18]=t=>y.value=!1)},{default:s(()=>e[34]||(e[34]=[u("取消",-1)])),_:1,__:[34]}),a(r,{type:"primary",onClick:le,loading:z.value},{default:s(()=>e[35]||(e[35]=[u(" 确定 ",-1)])),_:1,__:[35]},8,["loading"])])]),default:s(()=>[a(R,{ref_key:"formRef",ref:T,model:o,rules:M,"label-width":"100px"},{default:s(()=>[a(c,{label:"用户名",prop:"username"},{default:s(()=>[a(p,{modelValue:o.username,"onUpdate:modelValue":e[10]||(e[10]=t=>o.username=t),placeholder:"请输入用户名",disabled:!!o.id},null,8,["modelValue","disabled"])]),_:1}),a(c,{label:"昵称",prop:"nickname"},{default:s(()=>[a(p,{modelValue:o.nickname,"onUpdate:modelValue":e[11]||(e[11]=t=>o.nickname=t),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),a(c,{label:"邮箱",prop:"email"},{default:s(()=>[a(p,{modelValue:o.email,"onUpdate:modelValue":e[12]||(e[12]=t=>o.email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),o.id?I("",!0):(E(),P(c,{key:0,label:"密码",prop:"password"},{default:s(()=>[a(p,{modelValue:o.password,"onUpdate:modelValue":e[13]||(e[13]=t=>o.password=t),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),a(c,{label:"角色",prop:"role"},{default:s(()=>[a($,{modelValue:o.role,"onUpdate:modelValue":e[14]||(e[14]=t=>o.role=t)},{default:s(()=>[a(C,{label:"user"},{default:s(()=>e[30]||(e[30]=[u("普通用户",-1)])),_:1,__:[30]}),a(C,{label:"admin"},{default:s(()=>e[31]||(e[31]=[u("管理员",-1)])),_:1,__:[31]})]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"头像",prop:"avatar"},{default:s(()=>[a(p,{modelValue:o.avatar,"onUpdate:modelValue":e[15]||(e[15]=t=>o.avatar=t),placeholder:"请输入头像URL"},null,8,["modelValue"])]),_:1}),a(c,{label:"个人简介",prop:"bio"},{default:s(()=>[a(p,{modelValue:o.bio,"onUpdate:modelValue":e[16]||(e[16]=t=>o.bio=t),type:"textarea",rows:3,placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1}),a(c,{label:"状态",prop:"status"},{default:s(()=>[a($,{modelValue:o.status,"onUpdate:modelValue":e[17]||(e[17]=t=>o.status=t)},{default:s(()=>[a(C,{label:"active"},{default:s(()=>e[32]||(e[32]=[u("正常",-1)])),_:1,__:[32]}),a(C,{label:"disabled"},{default:s(()=>e[33]||(e[33]=[u("禁用",-1)])),_:1,__:[33]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},za=ge(Je,[["__scopeId","data-v-39ae34e4"]]);export{za as default};
