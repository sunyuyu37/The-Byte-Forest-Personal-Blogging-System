import{_ as C,u as J,r as f,c as y,o as O,be as $,b as B,e as s,w as t,bb as D,l as v,d,X as P,G as r,H as p,I as T,J as U,j as V,bd as j,L as E,bf as z}from"./index-Da7ZqcH5.js";/* empty css             */import{g as L}from"./security-DVS4TXAm.js";import{E as G}from"./index-lPpvXrw4.js";import{E as H,a as W,b as F}from"./index-k6BulDX8.js";import"./vnode-DsZHVpXe.js";const Q={class:"token-status"},X={class:"card-header"},q={class:"mt-20"},K={class:"mt-20"},R={__name:"TokenStatus",setup(Y){const I=J(),_=f(!1),i=f(!1),u=f(!1),l=f(0),b=y(()=>I.isLoggedIn),h=y(()=>I.user),w=y(()=>{if(l.value<=0)return"已过期";const a=Math.floor(l.value/(1e3*60*60)),e=Math.floor(l.value%(1e3*60*60)/(1e3*60)),o=Math.floor(l.value%(1e3*60)/1e3);return a>0?`${a}小时${e}分钟`:e>0?`${e}分钟${o}秒`:`${o}秒`});let k=null;const m=async()=>{const a=D();_.value=!!a;try{const e=await L(),o=(e==null?void 0:e.data)||e,n=(o==null?void 0:o.data)!==void 0?o.data:o;n?(i.value=!!(n.isTokenExpired??n.tokenExpired),u.value=!!(n.isTokenExpiringSoon??n.tokenExpiringSoon),l.value=Number(n.remainingTimeMillis??n.remainingMillis??0)):(i.value=!0,u.value=!0,l.value=0)}catch{i.value=!0,u.value=!0,l.value=0}},S=async()=>{try{const a=await j.getCurrentUser();E.success("API调用成功"),console.log("API响应:",a)}catch(a){E.error("API调用失败: "+a.message),console.error("API错误:",a)}},A=()=>{z("eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyIiwiaWF0IjoxNzU0ODIxOTgzLCJleHAiOjE3NTQ4MjE5ODN9.expired"),m(),E.warning("已设置过期Token，请测试系统行为")};return O(()=>{m(),k=setInterval(m,3e4)}),$(()=>{k&&clearInterval(k)}),(a,e)=>{const o=V,n=P,c=W,M=H,g=F,N=G;return v(),B("div",Q,[s(N,null,{header:t(()=>[d("div",X,[e[1]||(e[1]=d("span",null,"Token状态监控",-1)),s(o,{type:"primary",onClick:m},{default:t(()=>e[0]||(e[0]=[r("刷新状态",-1)])),_:1,__:[0]})])]),default:t(()=>[s(M,{column:2,border:""},{default:t(()=>[s(c,{label:"登录状态"},{default:t(()=>[s(n,{type:b.value?"success":"danger"},{default:t(()=>[r(p(b.value?"已登录":"未登录"),1)]),_:1},8,["type"])]),_:1}),s(c,{label:"Token存在"},{default:t(()=>[s(n,{type:_.value?"success":"danger"},{default:t(()=>[r(p(_.value?"是":"否"),1)]),_:1},8,["type"])]),_:1}),s(c,{label:"Token是否过期"},{default:t(()=>[s(n,{type:i.value?"danger":"success"},{default:t(()=>[r(p(i.value?"已过期":"有效"),1)]),_:1},8,["type"])]),_:1}),s(c,{label:"即将过期"},{default:t(()=>[s(n,{type:u.value?"warning":"success"},{default:t(()=>[r(p(u.value?"是":"否"),1)]),_:1},8,["type"])]),_:1}),s(c,{label:"剩余时间"},{default:t(()=>[d("span",null,p(w.value),1)]),_:1}),s(c,{label:"用户信息"},{default:t(()=>{var x;return[d("span",null,p(((x=h.value)==null?void 0:x.username)||"未获取"),1)]}),_:1})]),_:1}),d("div",q,[i.value?(v(),T(g,{key:0,title:"Token已过期",type:"error",description:"您的登录已过期，请重新登录","show-icon":""})):u.value?(v(),T(g,{key:1,title:"Token即将过期",type:"warning",description:`您的登录将在${Math.floor(l.value/(1e3*60))}分钟后过期`,"show-icon":""},null,8,["description"])):_.value?(v(),T(g,{key:2,title:"Token状态正常",type:"success",description:"您的登录状态正常","show-icon":""})):U("",!0)]),d("div",K,[s(o,{onClick:S,type:"primary"},{default:t(()=>e[2]||(e[2]=[r("测试API调用",-1)])),_:1,__:[2]}),s(o,{onClick:A,type:"danger"},{default:t(()=>e[3]||(e[3]=[r("模拟过期Token",-1)])),_:1,__:[3]})])]),_:1})])}}},ae=C(R,[["__scopeId","data-v-9fa43b90"]]);export{ae as default};
