/* empty css             *//* empty css                   *//* empty css                   *//* empty css                     *//* empty css                       *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css                    *//* empty css               *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                */import{r as e,aT as a,j as l,a3 as t,k as s,E as i,aA as n,m as o,s as d,a0 as r,a2 as u,Q as c,aS as p,aU as m,e as v,F as f,a_ as g,aG as y,w as _,at as b,bc as h,J as w,a1 as V,K as T,R as C,S as M,T as j,i as E,aY as A,bj as U}from"./element-plus-CXASJE3V.js";import{f as Y}from"./date-DeQj3nH2.js";import{a as x}from"./announcement-C-l9msDL.js";import{_ as I}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{r as k,X as S,p as D,c as H,a as z,Q as N,M as R,I as O,u as F,o as L,J as q,H as G,K as W,D as B,O as P}from"./vue-B9wWIsxR.js";import"./index-di9GIa25.js";import"./utils-C28rWPR3.js";const J={class:"announcement-manager"},K={class:"page-header"},Q={class:"header-content"},X={class:"header-left"},$={class:"page-title"},Z={class:"header-right"},ee={class:"filter-section"},ae={class:"filter-content"},le={class:"filter-left"},te={class:"filter-right"},se={class:"table-section"},ie={class:"title-cell"},ne={class:"read-count"},oe={class:"action-buttons"},de={class:"pagination-wrapper"},re={class:"form-switches"},ue={class:"dialog-footer"},ce={key:0,class:"stats-content"},pe={class:"stats-header"},me={class:"stats-grid"},ve={class:"stat-item"},fe={class:"stat-value"},ge={class:"stat-item"},ye={class:"stat-value"},_e={class:"stat-item"},be={class:"stat-value"},he=I({__name:"AnnouncementManager",setup(I){const he=k(!1),we=k([]),Ve=k(0),Te=k(1),Ce=k(10),Me=k(""),je=k(""),Ee=k(""),Ae=k("createdAt"),Ue=k("desc"),Ye=k(!1),xe=k(!1),Ie=k(!1),ke=k(!1),Se=k(),De=k(null),He=S({id:null,title:"",content:"",type:"SYSTEM",priority:"MEDIUM",enabled:!0,pinned:!1,startTime:"",endTime:""}),ze={title:[{required:!0,message:"请输入公告标题",trigger:"blur"},{min:1,max:100,message:"标题长度在 1 到 100 个字符",trigger:"blur"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"},{min:1,max:2e3,message:"内容长度在 1 到 2000 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择公告类型",trigger:"change"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}]},Ne=async()=>{he.value=!0;try{const e={page:Te.value-1,size:Ce.value,sortBy:Ae.value,sortDir:Ue.value};Me.value&&(e.keyword=Me.value),je.value&&(e.type=je.value),Ee.value&&(e.enabled="true"===Ee.value);const a=await x.getAdminAnnouncements(e);we.value=a.data.content,Ve.value=a.data.totalElements}catch(e){i.error("加载公告列表失败")}finally{he.value=!1}},Re=()=>{Te.value=1,Ne()},Oe=()=>{Te.value=1,Ne()},Fe=()=>{Me.value="",je.value="",Ee.value="",Te.value=1,Ne()},Le=({prop:e,order:a})=>{Ae.value=e||"createdAt",Ue.value="ascending"===a?"asc":"desc",Ne()},qe=e=>{Ce.value=e,Te.value=1,Ne()},Ge=e=>{Te.value=e,Ne()},We=()=>{Ie.value=!1,Be(),Ye.value=!0},Be=()=>{Object.assign(He,{id:null,title:"",content:"",type:"SYSTEM",priority:"MEDIUM",enabled:!0,pinned:!1,startTime:"",endTime:""}),Se.value&&Se.value.resetFields()},Pe=async()=>{if(Se.value)try{await Se.value.validate(),ke.value=!0,Ie.value?(await x.updateAnnouncement(He.id,He),i.success("公告更新成功")):(await x.createAnnouncement(He),i.success("公告发布成功")),Ye.value=!1,Ne()}catch(e){if(e.errors)return;i.error(Ie.value?"更新公告失败":"发布公告失败")}finally{ke.value=!1}},Je=e=>({SYSTEM:"系统公告",FEATURE:"功能更新",MAINTENANCE:"维护通知",ACTIVITY:"活动公告"}[e]||e),Ke=e=>({SYSTEM:"primary",FEATURE:"success",MAINTENANCE:"warning",ACTIVITY:"info"}[e]||"info"),Qe=e=>({LOW:"低",MEDIUM:"中",HIGH:"高"}[e]||e);return D(()=>{Ne()}),(I,k)=>{const S=e,D=l,Ae=o,Ue=u,Be=r,Xe=t,$e=v,Ze=m,ea=g,aa=y,la=p,ta=V,sa=j,ia=M,na=C,oa=E,da=A,ra=T,ua=s,ca=w;return L(),H("div",J,[z("div",K,[z("div",Q,[z("div",X,[z("h1",$,[N(S,null,{default:O(()=>[N(F(n))]),_:1}),k[16]||(k[16]=R(" 公告管理 ",-1))]),k[17]||(k[17]=z("p",{class:"page-description"},"管理系统公告，向用户发布重要信息",-1))]),z("div",Z,[N(D,{type:"primary",onClick:We,icon:F(a)},{default:O(()=>k[18]||(k[18]=[R(" 发布公告 ",-1)])),_:1,__:[18]},8,["icon"])])])]),z("div",ee,[N(Xe,{shadow:"never",class:"filter-card"},{default:O(()=>[z("div",ae,[z("div",le,[N(Ae,{modelValue:Me.value,"onUpdate:modelValue":k[0]||(k[0]=e=>Me.value=e),placeholder:"搜索公告标题或内容","prefix-icon":F(d),clearable:"",onInput:Re,style:{width:"300px"}},null,8,["modelValue","prefix-icon"]),N(Be,{modelValue:je.value,"onUpdate:modelValue":k[1]||(k[1]=e=>je.value=e),placeholder:"公告类型",clearable:"",style:{width:"150px","margin-left":"12px"},onChange:Oe},{default:O(()=>[N(Ue,{label:"系统公告",value:"SYSTEM"}),N(Ue,{label:"功能更新",value:"FEATURE"}),N(Ue,{label:"维护通知",value:"MAINTENANCE"}),N(Ue,{label:"活动公告",value:"ACTIVITY"})]),_:1},8,["modelValue"]),N(Be,{modelValue:Ee.value,"onUpdate:modelValue":k[2]||(k[2]=e=>Ee.value=e),placeholder:"状态",clearable:"",style:{width:"120px","margin-left":"12px"},onChange:Oe},{default:O(()=>[N(Ue,{label:"启用",value:"true"}),N(Ue,{label:"禁用",value:"false"})]),_:1},8,["modelValue"])]),z("div",te,[N(D,{onClick:Fe,icon:F(c)},{default:O(()=>k[19]||(k[19]=[R("重置",-1)])),_:1,__:[19]},8,["icon"])])])]),_:1})]),z("div",se,[N(Xe,{shadow:"never",class:"table-card"},{default:O(()=>[q((L(),G(la,{data:we.value,stripe:"",style:{width:"100%"},onSortChange:Le},{default:O(()=>[N(Ze,{prop:"title",label:"标题","min-width":"200"},{default:O(({row:e})=>[z("div",ie,[e.pinned?(L(),G($e,{key:0,type:"warning",size:"small",class:"pin-tag"},{default:O(()=>[N(S,null,{default:O(()=>[N(F(f))]),_:1}),k[20]||(k[20]=R(" 置顶 ",-1))]),_:1,__:[20]})):W("",!0),z("span",{class:B(["title-text",{pinned:e.pinned}])},P(e.title),3)])]),_:1}),N(Ze,{prop:"type",label:"类型",width:"120"},{default:O(({row:e})=>[N($e,{type:Ke(e.type),size:"small"},{default:O(()=>[R(P(Je(e.type)),1)]),_:2},1032,["type"])]),_:1}),N(Ze,{prop:"priority",label:"优先级",width:"100"},{default:O(({row:e})=>{return[N($e,{type:(a=e.priority,{LOW:"info",MEDIUM:"warning",HIGH:"danger"}[a]||"info"),size:"small"},{default:O(()=>[R(P(Qe(e.priority)),1)]),_:2},1032,["type"])];var a}),_:1}),N(Ze,{prop:"enabled",label:"状态",width:"80"},{default:O(({row:e})=>[N(ea,{modelValue:e.enabled,"onUpdate:modelValue":a=>e.enabled=a,onChange:a=>(async e=>{e.statusLoading=!0;try{await x.toggleStatus(e.id,e.enabled),i.success(e.enabled?"公告已启用":"公告已禁用")}catch(a){e.enabled=!e.enabled,i.error("状态切换失败")}finally{e.statusLoading=!1}})(e),loading:e.statusLoading},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),_:1}),N(Ze,{prop:"readCount",label:"已读数",width:"100",align:"center"},{default:O(({row:e})=>[z("span",ne,P(e.readCount||0),1)]),_:1}),N(Ze,{prop:"publisherName",label:"发布者",width:"120"}),N(Ze,{prop:"createdAt",label:"创建时间",width:"180",sortable:"custom"},{default:O(({row:e})=>[R(P(F(Y)(e.createdAt)),1)]),_:1}),N(Ze,{label:"操作",width:"200",fixed:"right"},{default:O(({row:e})=>[z("div",oe,[N(aa,{content:"编辑",placement:"top"},{default:O(()=>[N(D,{type:"primary",size:"small",icon:F(_),onClick:a=>(e=>{Ie.value=!0,Object.assign(He,{id:e.id,title:e.title,content:e.content,type:e.type,priority:e.priority,enabled:e.enabled,pinned:e.pinned,startTime:e.startTime,endTime:e.endTime}),Ye.value=!0})(e),circle:""},null,8,["icon","onClick"])]),_:2},1024),N(aa,{content:e.pinned?"取消置顶":"置顶",placement:"top"},{default:O(()=>[N(D,{type:e.pinned?"warning":"info",size:"small",icon:F(f),onClick:a=>(async e=>{try{const a=!e.pinned;await x.togglePin(e.id,a),e.pinned=a,i.success(a?"公告已置顶":"公告已取消置顶")}catch(a){i.error("置顶状态切换失败")}})(e),circle:""},null,8,["type","icon","onClick"])]),_:2},1032,["content"]),N(aa,{content:"查看统计",placement:"top"},{default:O(()=>[N(D,{type:"success",size:"small",icon:F(b),onClick:a=>(async e=>{try{const a=await x.getReadStats(e.id);De.value={...e,readCount:a.data},xe.value=!0}catch(a){i.error("获取统计信息失败")}})(e),circle:""},null,8,["icon","onClick"])]),_:2},1024),N(aa,{content:"删除",placement:"top"},{default:O(()=>[N(D,{type:"danger",size:"small",icon:F(h),onClick:a=>(async e=>{try{await U.confirm(`确定要删除公告「${e.title}」吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await x.deleteAnnouncement(e.id),i.success("公告删除成功"),Ne()}catch(a){"cancel"!==a&&i.error("删除公告失败")}})(e),circle:""},null,8,["icon","onClick"])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[ca,he.value]]),z("div",de,[N(ta,{"current-page":Te.value,"onUpdate:currentPage":k[3]||(k[3]=e=>Te.value=e),"page-size":Ce.value,"onUpdate:pageSize":k[4]||(k[4]=e=>Ce.value=e),"page-sizes":[10,20,50,100],total:Ve.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:qe,onCurrentChange:Ge},null,8,["current-page","page-size","total"])])]),_:1})]),N(ua,{modelValue:Ye.value,"onUpdate:modelValue":k[14]||(k[14]=e=>Ye.value=e),title:Ie.value?"编辑公告":"发布公告",width:"800px","close-on-click-modal":!1},{footer:O(()=>[z("div",ue,[N(D,{onClick:k[13]||(k[13]=e=>Ye.value=!1)},{default:O(()=>k[23]||(k[23]=[R("取消",-1)])),_:1,__:[23]}),N(D,{type:"primary",onClick:Pe,loading:ke.value},{default:O(()=>[R(P(Ie.value?"更新":"发布"),1)]),_:1},8,["loading"])])]),default:O(()=>[N(ra,{ref_key:"formRef",ref:Se,model:He,rules:ze,"label-width":"100px","label-position":"left"},{default:O(()=>[N(na,{gutter:20},{default:O(()=>[N(ia,{span:24},{default:O(()=>[N(sa,{label:"公告标题",prop:"title"},{default:O(()=>[N(Ae,{modelValue:He.title,"onUpdate:modelValue":k[5]||(k[5]=e=>He.title=e),placeholder:"请输入公告标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),N(na,{gutter:20},{default:O(()=>[N(ia,{span:8},{default:O(()=>[N(sa,{label:"公告类型",prop:"type"},{default:O(()=>[N(Be,{modelValue:He.type,"onUpdate:modelValue":k[6]||(k[6]=e=>He.type=e),placeholder:"选择类型",style:{width:"100%"}},{default:O(()=>[N(Ue,{label:"系统公告",value:"SYSTEM"}),N(Ue,{label:"功能更新",value:"FEATURE"}),N(Ue,{label:"维护通知",value:"MAINTENANCE"}),N(Ue,{label:"活动公告",value:"ACTIVITY"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),N(ia,{span:8},{default:O(()=>[N(sa,{label:"优先级",prop:"priority"},{default:O(()=>[N(Be,{modelValue:He.priority,"onUpdate:modelValue":k[7]||(k[7]=e=>He.priority=e),placeholder:"选择优先级",style:{width:"100%"}},{default:O(()=>[N(Ue,{label:"低",value:"LOW"}),N(Ue,{label:"中",value:"MEDIUM"}),N(Ue,{label:"高",value:"HIGH"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),N(ia,{span:8},{default:O(()=>[N(sa,{label:"设置"},{default:O(()=>[z("div",re,[N(oa,{modelValue:He.enabled,"onUpdate:modelValue":k[8]||(k[8]=e=>He.enabled=e)},{default:O(()=>k[21]||(k[21]=[R("启用",-1)])),_:1,__:[21]},8,["modelValue"]),N(oa,{modelValue:He.pinned,"onUpdate:modelValue":k[9]||(k[9]=e=>He.pinned=e)},{default:O(()=>k[22]||(k[22]=[R("置顶",-1)])),_:1,__:[22]},8,["modelValue"])])]),_:1})]),_:1})]),_:1}),N(na,{gutter:20},{default:O(()=>[N(ia,{span:12},{default:O(()=>[N(sa,{label:"开始时间"},{default:O(()=>[N(da,{modelValue:He.startTime,"onUpdate:modelValue":k[10]||(k[10]=e=>He.startTime=e),type:"datetime",placeholder:"选择开始时间",style:{width:"100%"},format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1}),N(ia,{span:12},{default:O(()=>[N(sa,{label:"结束时间"},{default:O(()=>[N(da,{modelValue:He.endTime,"onUpdate:modelValue":k[11]||(k[11]=e=>He.endTime=e),type:"datetime",placeholder:"选择结束时间",style:{width:"100%"},format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),N(sa,{label:"公告内容",prop:"content"},{default:O(()=>[N(Ae,{modelValue:He.content,"onUpdate:modelValue":k[12]||(k[12]=e=>He.content=e),type:"textarea",rows:8,placeholder:"请输入公告内容",maxlength:"2000","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),N(ua,{modelValue:xe.value,"onUpdate:modelValue":k[15]||(k[15]=e=>xe.value=e),title:"公告统计",width:"600px"},{default:O(()=>[De.value?(L(),H("div",ce,[z("div",pe,[z("h3",null,P(De.value.title),1),N($e,{type:Ke(De.value.type)},{default:O(()=>[R(P(Je(De.value.type)),1)]),_:1},8,["type"])]),z("div",me,[z("div",ve,[z("div",fe,P(De.value.readCount||0),1),k[24]||(k[24]=z("div",{class:"stat-label"},"已读用户",-1))]),z("div",ge,[z("div",ye,P(F(Y)(De.value.createdAt)),1),k[25]||(k[25]=z("div",{class:"stat-label"},"发布时间",-1))]),z("div",_e,[z("div",be,P(De.value.publisherName),1),k[26]||(k[26]=z("div",{class:"stat-label"},"发布者",-1))])])])):W("",!0)]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-cba80a0f"]]);export{he as default};
