/* empty css             *//* empty css                  *//* empty css                 *//* empty css                  *//* empty css               *//* empty css                  *//* empty css                           *//* empty css                         */import{r as a,p as e,c as l,a as t,Q as s,K as i,I as n,O as o,M as u,P as r,a6 as c,u as d,al as v,aD as m,o as p,H as f}from"./vue-B9wWIsxR.js";import{u as k}from"./index-di9GIa25.js";import{a6 as y,a7 as g,G as _,aa as h,r as w,F as C,j,a8 as L,m as b,a9 as x,E as A,ab as I,a5 as H,U as M,e as D}from"./element-plus-CXASJE3V.js";import{a as T}from"./article-Pn5uYJFo.js";import{c as Y}from"./comment-DttPZ_iH.js";import{_ as z}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./utils-C28rWPR3.js";const U={class:"life-essays-detail"},V={class:"container"},$={key:0,class:"loading"},E={key:1,class:"article-content"},O={class:"life-header"},P={class:"breadcrumb"},B={class:"title"},F={class:"life-meta"},G={class:"author-info"},K={class:"author-details"},Q={class:"name"},S={class:"time"},q={class:"life-stats"},J={class:"stat-item"},N={class:"stat-item"},R={class:"stat-item"},W={key:0,class:"life-tags"},X={class:"life-body"},Z=["innerHTML"],aa={class:"life-footer"},ea={class:"actions"},la={class:"comments-section"},ta={key:0,class:"comment-form"},sa={class:"form-actions"},ia={key:1,class:"login-prompt"},na={class:"comments-list"},oa={class:"comment-avatar"},ua={class:"comment-content"},ra={class:"comment-header"},ca={class:"username"},da={class:"time"},va={class:"comment-text"},ma={class:"comment-actions"},pa={key:0},fa={key:2,class:"not-found"},ka=z({__name:"LifeEssaysDetail",setup(z){const ka=m(),ya=k(),ga=a(!0),_a=a(null),ha=a([]),wa=a(!1),Ca=a(""),ja=a(!1),La=a=>h(a).format("YYYY-MM-DD HH:mm"),ba=async()=>{var a;if(_a.value)try{const e=_a.value.slug||_a.value.id,l=await Y.getArticleComments(e),t=(null==(a=l.data)?void 0:a.content)||l.data||[];ha.value=t.map(a=>({...a,isLiked:!1,likeCount:a.likeCount||0}))}catch(e){}},xa=async()=>{if(ya.isLoggedIn)try{wa.value?(await T.unlikeArticle(_a.value.id),_a.value.likeCount--):(await T.likeArticle(_a.value.id),_a.value.likeCount++),wa.value=!wa.value}catch(a){A.error("操作失败")}else A.warning("请先登录")},Aa=()=>{navigator.share?navigator.share({title:_a.value.title,text:_a.value.excerpt,url:window.location.href}):(navigator.clipboard.writeText(window.location.href),A.success("链接已复制到剪贴板"))},Ia=async()=>{if(Ca.value.trim()){ja.value=!0;try{await Y.createComment({articleId:_a.value.id,content:Ca.value}),Ca.value="",A.success("留言发表成功"),await ba()}catch(a){A.error("留言失败")}finally{ja.value=!1}}else A.warning("请输入留言内容")};return e(async()=>{var a;ga.value=!0;try{const l=ka.params.slug,t=await T.getArticleBySlug(l);if(_a.value=t.data,ya.isLoggedIn&&(null==(a=_a.value)?void 0:a.id))try{const a=await T.isArticleLiked(_a.value.id);wa.value=!!a.data}catch(e){wa.value=!1}await ba()}catch(l){_a.value=null,A.error("加载文章失败，请稍后重试")}finally{ga.value=!1}}),(a,e)=>{var m,k;const h=y,T=I,z=g,ka=_,ba=w,Ha=D,Ma=j,Da=b,Ta=v("router-link"),Ya=x;return p(),l("div",U,[t("div",V,[ga.value?(p(),l("div",$,[s(h,{rows:10,animated:""})])):_a.value?(p(),l("div",E,[t("header",O,[t("div",P,[s(z,{separator:">"},{default:n(()=>[s(T,{to:"/"},{default:n(()=>e[2]||(e[2]=[u("首页",-1)])),_:1,__:[2]}),s(T,{to:"/life-essays"},{default:n(()=>e[3]||(e[3]=[u("生活随笔",-1)])),_:1,__:[3]}),s(T,null,{default:n(()=>[u(o(_a.value.title),1)]),_:1})]),_:1})]),t("h1",B,o(_a.value.title),1),t("div",F,[t("div",G,[s(ka,{src:null==(m=_a.value.author)?void 0:m.avatar,size:44},{default:n(()=>{var a,e;return[u(o(null==(e=null==(a=_a.value.author)?void 0:a.nickname)?void 0:e.charAt(0)),1)]}),_:1},8,["src"]),t("div",K,[t("div",Q,o(null==(k=_a.value.author)?void 0:k.nickname),1),t("div",S,o(La(_a.value.publishedAt)),1)])]),t("div",q,[t("span",J,[s(ba,null,{default:n(()=>[s(d(H))]),_:1}),u(o(_a.value.viewCount)+" 阅读",1)]),t("span",N,[s(ba,null,{default:n(()=>[s(d(C))]),_:1}),u(o(_a.value.likeCount)+" 点赞",1)]),t("span",R,[s(ba,null,{default:n(()=>[s(d(M))]),_:1}),u(o(_a.value.commentCount||0)+" 评论",1)])])]),_a.value.tags&&_a.value.tags.length?(p(),l("div",W,[(p(!0),l(r,null,c(_a.value.tags,e=>(p(),f(Ha,{key:e.id,type:"warning",effect:"plain",onClick:l=>a.$router.push(`/tag/${e.slug}`)},{default:n(()=>[u(o(e.name),1)]),_:2},1032,["onClick"]))),128))])):i("",!0)]),t("main",X,[t("div",{class:"content",innerHTML:_a.value.content},null,8,Z)]),t("footer",aa,[t("div",ea,[s(Ma,{type:wa.value?"primary":"default",icon:d(C),onClick:xa},{default:n(()=>[u(o(wa.value?"已点赞":"点赞")+" ("+o(_a.value.likeCount)+") ",1)]),_:1},8,["type","icon"]),s(Ma,{icon:d(L),onClick:Aa},{default:n(()=>e[4]||(e[4]=[u("分享",-1)])),_:1,__:[4]},8,["icon"])])]),t("section",la,[e[8]||(e[8]=t("h3",null,"留言 ({ { article.commentCount || 0 } })",-1)),d(ya).isLoggedIn?(p(),l("div",ta,[s(Da,{modelValue:Ca.value,"onUpdate:modelValue":e[0]||(e[0]=a=>Ca.value=a),type:"textarea",rows:4,placeholder:"写下此刻的想法...",maxlength:"500","show-word-limit":""},null,8,["modelValue"]),t("div",sa,[s(Ma,{type:"primary",loading:ja.value,onClick:Ia},{default:n(()=>e[5]||(e[5]=[u("发布留言",-1)])),_:1,__:[5]},8,["loading"])])])):(p(),l("div",ia,[t("p",null,[s(Ta,{to:"/auth/login"},{default:n(()=>e[6]||(e[6]=[u("登录",-1)])),_:1,__:[6]}),e[7]||(e[7]=u(" 后参与留言互动 ",-1))])])),t("div",na,[(p(!0),l(r,null,c(ha.value,a=>{var e,r;return p(),l("div",{key:a.id,class:"comment-item"},[t("div",oa,[s(ka,{src:null==(e=a.user)?void 0:e.avatar,size:36},{default:n(()=>{var e,l;return[u(o(null==(l=null==(e=a.user)?void 0:e.nickname)?void 0:l.charAt(0)),1)]}),_:2},1032,["src"])]),t("div",ua,[t("div",ra,[t("span",ca,o(null==(r=a.user)?void 0:r.nickname),1),t("span",da,o(La(a.createdAt)),1)]),t("div",va,o(a.content),1),t("div",ma,[s(Ma,{size:"small",text:"",type:a.isLiked?"primary":"default",icon:d(C),onClick:e=>(async a=>{if(ya.isLoggedIn)try{a.isLiked?(await Y.unlikeComment(a.id),a.likeCount--):(await Y.likeComment(a.id),a.likeCount++),a.isLiked=!a.isLiked}catch(e){A.error("操作失败")}else A.warning("请先登录")})(a)},{default:n(()=>[u(o(a.isLiked?"已赞":"点赞")+" ",1),a.likeCount>0?(p(),l("span",pa,"("+o(a.likeCount)+")",1)):i("",!0)]),_:2},1032,["type","icon","onClick"])])])])}),128))])])])):(p(),l("div",fa,[s(Ya,{icon:"warning",title:"文章不存在","sub-title":"抱歉，您访问的随笔不存在或已被删除"},{extra:n(()=>[s(Ma,{type:"primary",onClick:e[1]||(e[1]=e=>a.$router.push("/life-essays"))},{default:n(()=>e[9]||(e[9]=[u("返回生活随笔",-1)])),_:1,__:[9]})]),_:1})]))])])}}},[["__scopeId","data-v-2576a9d7"]]);export{ka as default};
