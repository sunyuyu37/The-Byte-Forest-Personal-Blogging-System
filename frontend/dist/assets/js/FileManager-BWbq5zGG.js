/* empty css             *//* empty css                   *//* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                       *//* empty css                  */import{r as e,X as a,w as l,p as t,c as i,a as s,Q as o,M as d,I as r,O as n,a4 as c,u,J as v,P as p,a6 as f,H as m,o as g,V as _,K as y}from"./vue-B9wWIsxR.js";import{r as b,j as h,s as w,m as k,a0 as z,aV as V,J as j,a1 as C,k as S,E as U,aS as N,O as T,Q as x,C as M,bd as F,aX as B,be as D,a2 as $,bf as E,B as O,bg as A,bh as I,ae as H,bc as K,aU as P,e as W,bi as X,v as J,af as Q,bj as G}from"./element-plus-CXASJE3V.js";import{f as L}from"./file-kw6L8mGP.js";import{_ as R}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-di9GIa25.js";import"./utils-C28rWPR3.js";const q={class:"file-manager"},Y={class:"page-header"},Z={class:"header-content"},ee={class:"title-section"},ae={class:"header-actions"},le={class:"stats-section"},te={class:"stats-grid"},ie={class:"stat-card"},se={class:"stat-icon"},oe={class:"stat-content"},de={class:"stat-number"},re={class:"stat-card"},ne={class:"stat-icon"},ce={class:"stat-content"},ue={class:"stat-number"},ve={class:"stat-card"},pe={class:"stat-icon"},fe={class:"stat-content"},me={class:"stat-number"},ge={class:"stat-card"},_e={class:"stat-icon"},ye={class:"stat-content"},be={class:"stat-number"},he={class:"filter-section"},we={class:"filter-content"},ke={class:"search-box"},ze={class:"filter-options"},Ve={class:"files-section"},je={class:"view-toggle"},Ce={key:0,class:"files-grid"},Se=["onClick"],Ue={class:"file-preview"},Ne=["src","alt"],Te={key:1,class:"video-preview"},xe=["src"],Me={class:"video-overlay"},Fe={key:2,class:"file-icon"},Be={class:"file-info"},De=["title"],$e={class:"file-meta"},Ee={class:"file-size"},Oe={class:"file-date"},Ae={class:"file-actions"},Ie={key:1,class:"files-table"},He={class:"table-preview"},Ke=["src","alt"],Pe={key:0,class:"video-metadata"},We={class:"metadata-item"},Xe={key:0,class:"metadata-item"},Je={key:1},Qe={class:"pagination-section"},Ge={class:"preview-content"},Le=["src","alt"],Re=["src"],qe={key:2,class:"preview-other"},Ye={class:"preview-actions"},Ze=R({__name:"FileManager",setup(R){const Ze=e(!1),ea=e([]),aa=e({}),la=e(""),ta=e(""),ia=e("createdAt"),sa=e("desc"),oa=e("grid"),da=e(!1),ra=e(null),na=a({page:1,size:20,total:0}),ca=async()=>{try{Ze.value=!0;const e={page:na.page-1,size:na.size,sortBy:ia.value,sortDir:sa.value};let a;a=la.value?await L.searchFiles(la.value,e):await L.getUserFiles(e),ea.value=a.data.content||[],na.total=a.data.totalElements||0}catch(e){U.error("加载文件列表失败")}finally{Ze.value=!1}},ua=async()=>{try{const e=await L.getFileStats();aa.value=e.data||{}}catch(e){}},va=()=>{na.page=1,ca()},pa=()=>{ca(),ua()},fa=e=>{na.size=e,na.page=1,ca()},ma=e=>{na.page=e,ca()},ga=e=>{ra.value=e,da.value=!0},_a=async e=>{try{await navigator.clipboard.writeText(e.fileUrl),U.success("文件链接已复制到剪贴板")}catch(a){U.error("复制失败")}},ya=async e=>{try{await G.confirm(`确定要删除文件 "${e.originalName}" 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await L.deleteFile(e.id),U.success("文件删除成功"),pa()}catch(a){"cancel"!==a&&U.error("删除文件失败")}},ba=e=>{const a=e.target;"VIDEO"===a.tagName&&a.play()},ha=e=>{const a=e.target;"VIDEO"===a.tagName&&(a.pause(),a.currentTime=0)},wa=e=>{if(0===e)return"0 B";const a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(2))+" "+["B","KB","MB","GB"][a]},ka=e=>new Date(e).toLocaleString("zh-CN"),za=e=>({image:"图片",video:"视频",document:"文档",audio:"音频"}[e]||"其他"),Va=e=>{if(!e||e<=0)return"00:00";const a=Math.floor(e/3600),l=Math.floor(e%3600/60),t=Math.floor(e%60);return a>0?`${a.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`:`${l.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`};return l([ta,ia,sa],()=>{na.page=1,ca()}),t(()=>{ca(),ua()}),(e,a)=>{var l;const t=b,U=h,G=k,L=$,R=z,ca=E,ua=V,ja=P,Ca=W,Sa=N,Ua=C,Na=S,Ta=j;return g(),i("div",q,[s("div",Y,[s("div",Z,[s("div",ee,[s("h1",null,[o(t,{class:"title-icon"},{default:r(()=>[o(u(T))]),_:1}),a[11]||(a[11]=d(" 文件管理 ",-1))]),a[12]||(a[12]=s("p",null,"管理您上传的所有文件，包括图片、视频等",-1))]),s("div",ae,[o(U,{type:"primary",onClick:pa},{default:r(()=>[o(t,null,{default:r(()=>[o(u(x))]),_:1}),a[13]||(a[13]=d(" 刷新 ",-1))]),_:1,__:[13]})])])]),s("div",le,[s("div",te,[s("div",ie,[s("div",se,[o(t,null,{default:r(()=>[o(u(M))]),_:1})]),s("div",oe,[s("div",de,n(aa.value.totalFiles||0),1),a[14]||(a[14]=s("div",{class:"stat-label"},"总文件数",-1))])]),s("div",re,[s("div",ne,[o(t,null,{default:r(()=>[o(u(F))]),_:1})]),s("div",ce,[s("div",ue,n(aa.value.imageFiles||0),1),a[15]||(a[15]=s("div",{class:"stat-label"},"图片文件",-1))])]),s("div",ve,[s("div",pe,[o(t,null,{default:r(()=>[o(u(B))]),_:1})]),s("div",fe,[s("div",me,n(aa.value.videoFiles||0),1),a[16]||(a[16]=s("div",{class:"stat-label"},"视频文件",-1))])]),s("div",ge,[s("div",_e,[o(t,null,{default:r(()=>[o(u(D))]),_:1})]),s("div",ye,[s("div",be,n(wa(aa.value.totalSize||0)),1),a[17]||(a[17]=s("div",{class:"stat-label"},"总大小",-1))])])])]),s("div",he,[s("div",we,[s("div",ke,[o(G,{modelValue:la.value,"onUpdate:modelValue":a[0]||(a[0]=e=>la.value=e),placeholder:"搜索文件名...","prefix-icon":u(w),onKeyup:c(va,["enter"]),clearable:""},null,8,["modelValue","prefix-icon"])]),s("div",ze,[o(R,{modelValue:ta.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ta.value=e),placeholder:"文件类型",clearable:""},{default:r(()=>[o(L,{label:"全部",value:""}),o(L,{label:"图片",value:"image"}),o(L,{label:"视频",value:"video"}),o(L,{label:"文档",value:"document"})]),_:1},8,["modelValue"]),o(R,{modelValue:ia.value,"onUpdate:modelValue":a[2]||(a[2]=e=>ia.value=e),placeholder:"排序方式"},{default:r(()=>[o(L,{label:"上传时间",value:"createdAt"}),o(L,{label:"文件名",value:"originalName"}),o(L,{label:"文件大小",value:"fileSize"})]),_:1},8,["modelValue"]),o(R,{modelValue:sa.value,"onUpdate:modelValue":a[3]||(a[3]=e=>sa.value=e),placeholder:"排序方向"},{default:r(()=>[o(L,{label:"降序",value:"desc"}),o(L,{label:"升序",value:"asc"})]),_:1},8,["modelValue"])])])]),s("div",Ve,[s("div",je,[o(ua,{modelValue:oa.value,"onUpdate:modelValue":a[4]||(a[4]=e=>oa.value=e)},{default:r(()=>[o(ca,{label:"grid"},{default:r(()=>[o(t,null,{default:r(()=>[o(u(O))]),_:1}),a[18]||(a[18]=d(" 网格视图 ",-1))]),_:1,__:[18]}),o(ca,{label:"list"},{default:r(()=>[o(t,null,{default:r(()=>[o(u(A))]),_:1}),a[19]||(a[19]=d(" 列表视图 ",-1))]),_:1,__:[19]})]),_:1},8,["modelValue"])]),"grid"===oa.value?v((g(),i("div",Ce,[(g(!0),i(p,null,f(ea.value,e=>(g(),i("div",{key:e.id,class:"file-card",onClick:a=>ga(e)},[s("div",Ue,["image"===e.fileType?(g(),i("img",{key:0,src:e.fileUrl,alt:e.originalName,class:"preview-image"},null,8,Ne)):"video"===e.fileType?(g(),i("div",Te,[s("video",{src:e.fileUrl,class:"preview-video",muted:"",onMouseenter:ba,onMouseleave:ha}," 您的浏览器不支持视频播放 ",40,xe),s("div",Me,[o(t,{class:"play-icon"},{default:r(()=>[o(u(I))]),_:1})])])):(g(),i("div",Fe,[o(t,null,{default:r(()=>[o(u(M))]),_:1})]))]),s("div",Be,[s("div",{class:"file-name",title:e.originalName},n(e.originalName),9,De),s("div",$e,[s("span",Ee,n(wa(e.fileSize)),1),s("span",Oe,n(ka(e.createdAt)),1)])]),s("div",Ae,[o(U,{size:"small",type:"primary",onClick:_(a=>_a(e),["stop"])},{default:r(()=>[o(t,null,{default:r(()=>[o(u(H))]),_:1})]),_:2},1032,["onClick"]),o(U,{size:"small",type:"danger",onClick:_(a=>ya(e),["stop"])},{default:r(()=>[o(t,null,{default:r(()=>[o(u(K))]),_:1})]),_:2},1032,["onClick"])])],8,Se))),128))])),[[Ta,Ze.value]]):(g(),i("div",Ie,[v((g(),m(Sa,{data:ea.value},{default:r(()=>[o(ja,{label:"预览",width:"80"},{default:r(({row:e})=>[s("div",He,["image"===e.fileType?(g(),i("img",{key:0,src:e.fileUrl,alt:e.originalName,class:"table-preview-image"},null,8,Ke)):"video"===e.fileType?(g(),m(t,{key:1,class:"table-preview-icon"},{default:r(()=>[o(u(B))]),_:1})):(g(),m(t,{key:2,class:"table-preview-icon"},{default:r(()=>[o(u(M))]),_:1}))])]),_:1}),o(ja,{prop:"originalName",label:"文件名","min-width":"200"}),o(ja,{label:"类型",width:"100"},{default:r(({row:e})=>{return[o(Ca,{type:(a=e.fileType,{image:"success",video:"primary",document:"info",audio:"warning"}[a]||"info")},{default:r(()=>[d(n(za(e.fileType)),1)]),_:2},1032,["type"])];var a}),_:1}),o(ja,{label:"大小",width:"120"},{default:r(({row:e})=>[d(n(wa(e.fileSize)),1)]),_:1}),"video"===e.currentFilter?(g(),m(ja,{key:0,label:"视频信息",width:"180"},{default:r(({row:e})=>["video"===e.fileType&&e.videoDuration?(g(),i("div",Pe,[s("div",We,[o(t,null,{default:r(()=>[o(u(X))]),_:1}),d(" "+n(Va(e.videoDuration)),1)]),e.videoWidth&&e.videoHeight?(g(),i("div",Xe,[o(t,null,{default:r(()=>[o(u(J))]),_:1}),d(" "+n(e.videoWidth)+"×"+n(e.videoHeight),1)])):y("",!0)])):"video"===e.fileType?(g(),i("span",Je,"解析中...")):y("",!0)]),_:1})):y("",!0),o(ja,{label:"上传时间",width:"180"},{default:r(({row:e})=>[d(n(ka(e.createdAt)),1)]),_:1}),o(ja,{label:"操作",width:"150"},{default:r(({row:e})=>[o(U,{size:"small",type:"primary",onClick:a=>ga(e)},{default:r(()=>a[20]||(a[20]=[d(" 预览 ",-1)])),_:2,__:[20]},1032,["onClick"]),o(U,{size:"small",type:"danger",onClick:a=>ya(e)},{default:r(()=>a[21]||(a[21]=[d(" 删除 ",-1)])),_:2,__:[21]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ta,Ze.value]])])),s("div",Qe,[o(Ua,{"current-page":na.page,"onUpdate:currentPage":a[5]||(a[5]=e=>na.page=e),"page-size":na.size,"onUpdate:pageSize":a[6]||(a[6]=e=>na.size=e),total:na.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:fa,onCurrentChange:ma},null,8,["current-page","page-size","total"])])]),o(Na,{modelValue:da.value,"onUpdate:modelValue":a[10]||(a[10]=e=>da.value=e),title:null==(l=ra.value)?void 0:l.originalName,width:"80%",center:""},{footer:r(()=>[s("div",Ye,[o(U,{onClick:a[7]||(a[7]=e=>_a(ra.value))},{default:r(()=>[o(t,null,{default:r(()=>[o(u(H))]),_:1}),a[22]||(a[22]=d(" 复制链接 ",-1))]),_:1,__:[22]}),o(U,{onClick:a[8]||(a[8]=e=>(e=>{const a=document.createElement("a");a.href=e.fileUrl,a.download=e.originalName,document.body.appendChild(a),a.click(),document.body.removeChild(a)})(ra.value))},{default:r(()=>[o(t,null,{default:r(()=>[o(u(Q))]),_:1}),a[23]||(a[23]=d(" 下载文件 ",-1))]),_:1,__:[23]}),o(U,{onClick:a[9]||(a[9]=e=>da.value=!1)},{default:r(()=>a[24]||(a[24]=[d("关闭",-1)])),_:1,__:[24]})])]),default:r(()=>{var e,a,l,d;return[s("div",Ge,["image"===(null==(e=ra.value)?void 0:e.fileType)?(g(),i("img",{key:0,src:ra.value.fileUrl,alt:ra.value.originalName,class:"preview-full-image"},null,8,Le)):"video"===(null==(a=ra.value)?void 0:a.fileType)?(g(),i("video",{key:1,src:ra.value.fileUrl,controls:"",class:"preview-full-video"}," 您的浏览器不支持视频播放 ",8,Re)):(g(),i("div",qe,[o(t,{class:"large-icon"},{default:r(()=>[o(u(M))]),_:1}),s("p",null,n(null==(l=ra.value)?void 0:l.originalName),1),s("p",null,"文件大小: "+n(wa(null==(d=ra.value)?void 0:d.fileSize)),1)]))])]}),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-1cb1f91b"]]);export{Ze as default};
