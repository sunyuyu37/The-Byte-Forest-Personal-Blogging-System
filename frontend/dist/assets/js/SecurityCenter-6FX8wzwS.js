import{_ as J,av as x,c as W,r as h,o as X,b as P,d as s,e as t,G as m,w as i,n as Y,J as A,ag as I,I as b,H as p,j as K,N as Q,O as ee,L as l,l as f,h as v,aw as se,E as oe,bh as te,bi as le,bj as ae,Y as T,as as ne,q as re,X as ie}from"./index-Da7ZqcH5.js";/* empty css               */import"./scrollbar-PN-ehNXN.js";/* empty css               *//* empty css                  */import{s as N}from"./positionedConfirm-C6ixQw3s.js";import{t as k,e as ce,b as de,a as ue,c as pe,d as me,u as ve,f as fe}from"./security-DVS4TXAm.js";import{E as _e,a as ge}from"./index-BJ8ssZSI.js";import{a as we}from"./index-CZyikzse.js";import{E as ye,a as he}from"./index-mDFjMy5P.js";import"./vnode-DsZHVpXe.js";import"./index-k6BulDX8.js";import"./index-lPpvXrw4.js";import"./isEqual-HUGtL056.js";import"./_Uint8Array-CNK7Frb1.js";import"./index-Chbwi6h6.js";import"./index-BwTCsBpr.js";import"./castArray-DVWVVBpp.js";import"./index-Ddj3Fd5B.js";import"./index-R92uOlC6.js";import"./index-DuvIoQvO.js";import"./index-DSEo_ZHY.js";import"./index-ViZWhRvA.js";import"./index-BLAWzDFp.js";import"./directive-iqmOBkSf.js";const Pe={class:"security-center"},Se={class:"security-header"},be={class:"header-content"},ke={class:"title-section"},Ve={class:"page-title"},Ee={class:"security-content"},Ce={class:"security-grid"},xe={class:"security-card"},Ae={class:"card-content"},Ie={class:"password-strength"},Te={class:"strength-bar"},Ne={class:"strength-text"},Oe={class:"security-card"},Ue={class:"card-content"},Fe={class:"two-factor-status"},Le={class:"status-info"},Me={class:"status-text"},ze={key:0,class:"two-factor-options"},Be={class:"option-list"},je={class:"option-icon"},De={class:"option-icon"},Ge={class:"security-card"},He={class:"card-content"},Re={class:"activity-list"},Ze={class:"activity-icon"},$e={class:"activity-info"},qe={class:"activity-header"},Je={class:"activity-time"},We={class:"activity-location"},Xe={class:"activity-ip"},Ye={class:"activity-status"},Ke={class:"activity-actions"},Qe={class:"security-card"},es={class:"card-content"},ss={class:"security-options"},os={class:"option-item"},ts={class:"option-item"},ls={class:"option-item"},as={class:"security-actions"},ns={__name:"SecurityCenter",setup(rs){const c=x({currentPassword:"",newPassword:"",confirmPassword:""}),V=W(()=>{const o=c.newPassword;if(!o)return{level:"",text:""};let e=0;o.length>=8&&e++,/[a-z]/.test(o)&&e++,/[A-Z]/.test(o)&&e++,/[0-9]/.test(o)&&e++,/[^A-Za-z0-9]/.test(o)&&e++;const r=[{level:"weak",text:"弱"},{level:"fair",text:"一般"},{level:"good",text:"良好"},{level:"strong",text:"强"},{level:"very-strong",text:"很强"}];return r[Math.min(e-1,4)]||r[0]}),n=h(!1),d=h(!1),E=h([]),u=x({loginNotification:!1,anomalyProtection:!1,sessionTimeout:"120"}),O=h({totalLogins:0,failedAttempts:0,activeSessions:0,lastLogin:null}),U=async()=>{var o,e;console.log("=== 开始加载安全概览 ===");try{console.log("调用 getSecurityOverview API"),console.log("请求URL将是:","/api/security/overview");const r=await de();console.log("getSecurityOverview 响应:",r),r.code===200&&(O.value=r.data,console.log("安全概览数据加载成功:",r.data))}catch(r){console.error("加载安全概览失败:",r),console.error("错误详情:",{message:r.message,response:r.response,status:(o=r.response)==null?void 0:o.status,data:(e=r.response)==null?void 0:e.data})}},F=async()=>{console.log("=== 开始加载安全设置 ===");try{console.log("调用 getSecuritySettings API");const o=await ue();if(console.log("getSecuritySettings 响应:",o),o.code===200){const e=o.data;Object.assign(u,{loginNotification:e.loginNotificationEnabled,anomalyProtection:e.anomalyProtectionEnabled,sessionTimeout:e.sessionTimeoutMinutes.toString()}),d.value=e.twoFactorEnabled,console.log("安全设置数据加载成功:",e)}}catch(o){console.error("加载安全设置失败:",o),console.error("错误详情:",o.message,o.stack),l.error("加载安全设置失败")}},w=async()=>{try{const o=await pe();o.code===200&&(E.value=o.data.map(e=>({id:e.id,device:e.deviceInfo||"Unknown Device",location:e.location||"未知位置",ip:e.ipAddress,time:e.loginTime,current:e.isCurrentSession,sessionId:e.sessionId})))}catch(o){console.error("加载登录活动失败:",o),l.error("加载登录活动失败")}},L=async()=>{if(!c.currentPassword){l.error("请输入当前密码");return}if(!c.newPassword){l.error("请输入新密码");return}if(c.newPassword!==c.confirmPassword){l.error("两次输入的密码不一致");return}try{n.value=!0;const o=await me({currentPassword:c.currentPassword,newPassword:c.newPassword});o.code===200?(l.success("密码更新成功"),Object.assign(c,{currentPassword:"",newPassword:"",confirmPassword:""})):l.error(o.message||"密码更新失败")}catch(o){console.error("密码更新失败:",o),l.error("密码更新失败")}finally{n.value=!1}},M=async o=>{if(d.value)try{await N("确定要禁用两步验证吗？这将降低您的账户安全性。","确认禁用",o),n.value=!0;const e=await k({enabled:!1});e.code===200?(d.value=!1,l.success("两步验证已禁用")):l.error(e.message||"禁用两步验证失败")}catch(e){e.message!=="cancel"&&(console.error("禁用两步验证失败:",e),l.error("禁用两步验证失败"))}finally{n.value=!1}else l.info("请选择验证方式来启用两步验证")},z=async()=>{try{n.value=!0;const o=await k({enabled:!0,method:"AUTHENTICATOR"});o.code===200?(d.value=!0,l.success("身份验证器已启用")):l.error(o.message||"启用身份验证器失败")}catch(o){console.error("启用身份验证器失败:",o),l.error("启用身份验证器失败")}finally{n.value=!1}},B=async()=>{try{n.value=!0;const o=await k({enabled:!0,method:"SMS"});o.code===200?(d.value=!0,l.success("短信验证已启用")):l.error(o.message||"启用短信验证失败")}catch(o){console.error("启用短信验证失败:",o),l.error("启用短信验证失败")}finally{n.value=!1}},j=async()=>{try{n.value=!0,await w(),l.success("活动记录已刷新")}catch(o){console.error("刷新活动记录失败:",o),l.error("刷新活动记录失败")}finally{n.value=!1}},D=async o=>{try{await N("确定要注销所有设备吗？您需要重新登录。","确认注销",o),n.value=!0;const e=await ce();e.code===200?(l.success("已注销所有其他设备"),await w()):l.error(e.message||"注销设备失败")}catch(e){e.message!=="cancel"&&(console.error("注销设备失败:",e),l.error("注销设备失败"))}finally{n.value=!1}},G=async o=>{try{n.value=!0;const e=await fe(o);e.code===200?(l.success("会话已结束"),await w()):l.error(e.message||"结束会话失败")}catch(e){console.error("结束会话失败:",e),l.error("结束会话失败")}finally{n.value=!1}},H=async()=>{try{n.value=!0;const o=await ve({loginNotificationEnabled:u.loginNotification,anomalyProtectionEnabled:u.anomalyProtection,sessionTimeoutMinutes:parseInt(u.sessionTimeout)});o.code===200?l.success("安全设置保存成功"):l.error(o.message||"保存安全设置失败")}catch(o){console.error("保存安全设置失败:",o),l.error("保存安全设置失败")}finally{n.value=!1}},R=async()=>{n.value=!0;try{await Promise.all([U(),F(),w()])}catch(o){console.error("初始化数据失败:",o)}finally{n.value=!1}};return X(()=>{R()}),(o,e)=>{const r=Y,S=oe,y=ge,_=K,Z=_e,$=ie,C=we,g=he,q=ye;return f(),P("div",Pe,[s("div",Se,[s("div",be,[s("div",ke,[s("h1",Ve,[t(r,{class:"title-icon"},{default:i(()=>[t(v(se))]),_:1}),e[8]||(e[8]=m(" 安全中心 ",-1))]),e[9]||(e[9]=s("p",{class:"page-subtitle"},"保护您的账户安全，管理登录和验证设置",-1))])])]),s("div",Ee,[s("div",Ce,[s("div",xe,[e[11]||(e[11]=s("div",{class:"card-header"},[s("h3",null,"密码管理"),s("p",null,"定期更新密码以保护账户安全")],-1)),s("div",Ae,[t(Z,{model:c,"label-width":"120px",class:"password-form"},{default:i(()=>[t(y,{label:"当前密码"},{default:i(()=>[t(S,{modelValue:c.currentPassword,"onUpdate:modelValue":e[0]||(e[0]=a=>c.currentPassword=a),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),t(y,{label:"新密码"},{default:i(()=>[t(S,{modelValue:c.newPassword,"onUpdate:modelValue":e[1]||(e[1]=a=>c.newPassword=a),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"]),s("div",Ie,[s("div",Te,[s("div",{class:I(["strength-fill",V.value.level])},null,2)]),s("span",Ne,p(V.value.text),1)])]),_:1}),t(y,{label:"确认新密码"},{default:i(()=>[t(S,{modelValue:c.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=a=>c.confirmPassword=a),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),t(y,null,{default:i(()=>[t(_,{type:"primary",onClick:L,loading:n.value},{default:i(()=>e[10]||(e[10]=[m("更新密码",-1)])),_:1,__:[10]},8,["loading"])]),_:1})]),_:1},8,["model"])])]),s("div",Oe,[e[15]||(e[15]=s("div",{class:"card-header"},[s("h3",null,"两步验证"),s("p",null,"为您的账户添加额外的安全保护")],-1)),s("div",Ue,[s("div",Fe,[s("div",Le,[s("div",{class:I(["status-icon",d.value?"enabled":"disabled"])},[d.value?(f(),b(r,{key:0},{default:i(()=>[t(v(te))]),_:1})):(f(),b(r,{key:1},{default:i(()=>[t(v(le))]),_:1}))],2),s("div",Me,[s("h4",null,p(d.value?"已启用":"未启用"),1),s("p",null,p(d.value?"您的账户已受到两步验证保护":"启用两步验证以增强账户安全"),1)])]),t(_,{type:d.value?"danger":"primary",onClick:e[3]||(e[3]=a=>M(a)),loading:n.value},{default:i(()=>[m(p(d.value?"禁用":"启用"),1)]),_:1},8,["type","loading"])]),d.value?A("",!0):(f(),P("div",ze,[e[14]||(e[14]=s("h4",null,"选择验证方式",-1)),s("div",Be,[s("div",{class:"option-item",onClick:z},[s("div",je,[t(r,null,{default:i(()=>[t(v(ae))]),_:1})]),e[12]||(e[12]=s("div",{class:"option-info"},[s("h5",null,"身份验证器应用"),s("p",null,"使用 Google Authenticator 或类似应用")],-1)),t(r,{class:"arrow"},{default:i(()=>[t(v(T))]),_:1})]),s("div",{class:"option-item",onClick:B},[s("div",De,[t(r,null,{default:i(()=>[t(v(ne))]),_:1})]),e[13]||(e[13]=s("div",{class:"option-info"},[s("h5",null,"短信验证"),s("p",null,"通过手机短信接收验证码")],-1)),t(r,{class:"arrow"},{default:i(()=>[t(v(T))]),_:1})])])]))])]),s("div",Ge,[e[19]||(e[19]=s("div",{class:"card-header"},[s("h3",null,"登录活动"),s("p",null,"查看最近的登录记录和设备信息")],-1)),s("div",He,[s("div",Re,[(f(!0),P(Q,null,ee(E.value,a=>(f(),P("div",{key:a.id,class:"activity-item"},[s("div",Ze,[t(r,null,{default:i(()=>[t(v(re))]),_:1})]),s("div",$e,[s("div",qe,[s("h4",null,p(a.device),1),s("span",Je,p(a.time),1)]),s("p",We,p(a.location),1),s("p",Xe,"IP: "+p(a.ip),1)]),s("div",Ye,[t($,{type:a.current?"success":"info",size:"small"},{default:i(()=>[m(p(a.current?"当前会话":"已结束"),1)]),_:2},1032,["type"]),a.current&&a.sessionId?(f(),b(_,{key:0,type:"danger",size:"small",onClick:is=>G(a.sessionId),loading:n.value,style:{"margin-left":"10px"}},{default:i(()=>e[16]||(e[16]=[m(" 结束会话 ",-1)])),_:2,__:[16]},1032,["onClick","loading"])):A("",!0)])]))),128))]),s("div",Ke,[t(_,{onClick:j,loading:n.value},{default:i(()=>e[17]||(e[17]=[m("刷新记录",-1)])),_:1,__:[17]},8,["loading"]),t(_,{type:"danger",onClick:e[4]||(e[4]=a=>D(a)),loading:n.value},{default:i(()=>e[18]||(e[18]=[m("注销所有设备",-1)])),_:1,__:[18]},8,["loading"])])])]),s("div",Qe,[e[24]||(e[24]=s("div",{class:"card-header"},[s("h3",null,"安全设置"),s("p",null,"配置其他安全相关选项")],-1)),s("div",es,[s("div",ss,[s("div",os,[e[20]||(e[20]=s("div",{class:"option-info"},[s("h4",null,"登录通知"),s("p",null,"新设备登录时发送邮件通知")],-1)),t(C,{modelValue:u.loginNotification,"onUpdate:modelValue":e[5]||(e[5]=a=>u.loginNotification=a)},null,8,["modelValue"])]),s("div",ts,[e[21]||(e[21]=s("div",{class:"option-info"},[s("h4",null,"异常登录保护"),s("p",null,"检测到异常登录时要求额外验证")],-1)),t(C,{modelValue:u.anomalyProtection,"onUpdate:modelValue":e[6]||(e[6]=a=>u.anomalyProtection=a)},null,8,["modelValue"])]),s("div",ls,[e[22]||(e[22]=s("div",{class:"option-info"},[s("h4",null,"会话超时"),s("p",null,"设置自动登出时间")],-1)),t(q,{modelValue:u.sessionTimeout,"onUpdate:modelValue":e[7]||(e[7]=a=>u.sessionTimeout=a),placeholder:"选择超时时间"},{default:i(()=>[t(g,{label:"30分钟",value:"30"}),t(g,{label:"1小时",value:"60"}),t(g,{label:"2小时",value:"120"}),t(g,{label:"4小时",value:"240"}),t(g,{label:"8小时",value:"480"})]),_:1},8,["modelValue"])])]),s("div",as,[t(_,{type:"primary",onClick:H,loading:n.value},{default:i(()=>e[23]||(e[23]=[m("保存设置",-1)])),_:1,__:[23]},8,["loading"])])])])])])])}}},Us=J(ns,[["__scopeId","data-v-6e266d07"]]);export{Us as default};
