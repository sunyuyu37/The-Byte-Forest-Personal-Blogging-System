import{_ as X,u as Y,r as w,av as U,o as ee,b as se,d as s,e as t,G as f,w as o,n as te,j as ae,H as g,h as m,L as r,l as oe,Z as le,F as re,bb as ie,bg as ne,E as de,bh as R,aO as z,bd as k}from"./index-Da7ZqcH5.js";/* empty css               *//* empty css                  *//* empty css               *//* empty css                 */import{a as ue,u as D}from"./security-DVS4TXAm.js";import{E as ce,a as pe}from"./index-BJ8ssZSI.js";import{a as me,E as fe}from"./index-CZyikzse.js";import"./castArray-DVWVVBpp.js";import"./_Uint8Array-CNK7Frb1.js";import"./index-ViZWhRvA.js";import"./isEqual-HUGtL056.js";const ve={class:"account-settings"},ge={class:"settings-header"},_e={class:"header-content"},we={class:"title-section"},be={class:"page-title"},he={class:"settings-content"},ye={class:"settings-grid"},Ve={class:"settings-card"},Pe={class:"card-content"},ke={class:"avatar-upload"},Ne={class:"upload-actions"},Ue={class:"settings-card"},Ee={class:"card-content"},xe={class:"preference-item"},Ae={class:"preference-item"},Se={class:"preference-actions"},Fe={class:"settings-card"},Ce={class:"card-content"},Ie={class:"settings-card"},Be={class:"card-content"},Re={class:"status-grid"},ze={class:"status-item"},De={class:"status-icon success"},Le={class:"status-info"},Me={class:"status-item"},Ge={class:"status-icon success"},He={class:"status-item"},Oe={class:"status-icon info"},$e={class:"status-info"},je={class:"status-item"},qe={class:"status-icon info"},Te={class:"status-info"},Ze="/api",Je={__name:"AccountSettings",setup(Ke){const n=Y(),N=w(),b=w(),y=w(!1),h=w(!1),V=w(!1),P=w(!1),i=U({avatar:"",nickname:"",email:"",bio:"",website:"",github:""}),L={nickname:[{max:50,message:"昵称长度不能超过50个字符",trigger:"blur"}],bio:[{max:200,message:"个人简介长度不能超过200个字符",trigger:"blur"}],website:[{max:200,message:"网站地址长度不能超过200个字符",trigger:"blur"}],github:[{max:200,message:"GitHub地址长度不能超过200个字符",trigger:"blur"}]},c=U({oldPassword:"",newPassword:"",confirmPassword:""}),M={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:100,message:"密码长度必须在6-100个字符之间",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(a,e,d)=>{e!==c.newPassword?d(new Error("两次输入的密码不一致")):d()},trigger:"blur"}]},u=U({emailNotifications:!0,desktopNotifications:!1}),E=()=>{n.user&&Object.assign(i,{avatar:n.user.avatar||"",nickname:n.user.nickname||"",email:n.user.email||"",bio:n.user.bio||"",website:n.user.website||"",github:n.user.github||""})},G=async()=>{try{const a=await ue();a.code===200&&(u.emailNotifications=a.data.loginNotificationEnabled||!1,u.desktopNotifications=a.data.anomalyProtectionEnabled||!1)}catch(a){console.error("加载安全设置失败:",a)}},H=async()=>{if(N.value)try{await N.value.validate(),y.value=!0;const a={nickname:i.nickname,bio:i.bio,website:i.website,github:i.github},e=await k.updateUser(n.user.id,a);e.code===200?(n.updateUser(e.data),r.success("基本信息保存成功")):r.error(e.message||"保存失败")}catch(a){console.error("保存基本信息失败:",a),r.error("保存失败")}finally{y.value=!1}},O=()=>{E(),r.info("已重置为原始信息")},$=a=>{const e=a.type.indexOf("image")===0,d=a.size/1024/1024<2;return e?d?(h.value=!0,!0):(r.error("图片大小不能超过 2MB!"),!1):(r.error("只能上传图片文件!"),!1)},j=async a=>{if(h.value=!1,a.code===200){const e=a.data.fileUrl;i.avatar=e;try{(await k.updateAvatar(n.user.id,e)).code===200?(n.updateUser({avatar:e}),r.success("头像上传成功")):r.error("头像更新失败")}catch(d){console.error("更新头像失败:",d),r.error("头像更新失败")}}else r.error(a.message||"头像上传失败")},q=()=>{h.value=!1,r.error("头像上传失败")},T=async()=>{try{(await k.updateAvatar(n.user.id,"")).code===200?(i.avatar="",n.updateUser({avatar:""}),r.success("头像已移除")):r.error("移除头像失败")}catch(a){console.error("移除头像失败:",a),r.error("移除头像失败")}},x=async a=>{try{const e={loginNotificationEnabled:u.emailNotifications,anomalyProtectionEnabled:u.desktopNotifications};(await D(e)).code===200?r.success("设置已更新"):(r.error("设置更新失败"),u[a]=!u[a])}catch(e){console.error("更新偏好设置失败:",e),r.error("设置更新失败"),u[a]=!u[a]}},Z=async()=>{try{V.value=!0;const a={loginNotificationEnabled:u.emailNotifications,anomalyProtectionEnabled:u.desktopNotifications},e=await D(a);e.code===200?r.success("偏好设置保存成功"):r.error(e.message||"保存失败")}catch(a){console.error("保存偏好设置失败:",a),r.error("保存失败")}finally{V.value=!1}},J=async()=>{if(b.value)try{await b.value.validate(),P.value=!0;const a=await k.updatePassword(n.user.id,{oldPassword:c.oldPassword,newPassword:c.newPassword});a.code===200?(r.success("密码修改成功"),A()):r.error(a.message||"密码修改失败")}catch(a){console.error("修改密码失败:",a),r.error("密码修改失败")}finally{P.value=!1}},A=()=>{Object.assign(c,{oldPassword:"",newPassword:"",confirmPassword:""}),b.value&&b.value.clearValidate()},K=a=>a?new Date(a).toLocaleDateString("zh-CN"):"未知";return ee(()=>{E(),G()}),(a,e)=>{var C,I,B;const d=te,Q=re,_=ae,W=fe,p=pe,v=de,S=ce,F=me;return oe(),se("div",ve,[s("div",ge,[s("div",_e,[s("div",we,[s("h1",be,[t(d,{class:"title-icon"},{default:o(()=>[t(m(le))]),_:1}),e[12]||(e[12]=f(" 账户设置 ",-1))]),e[13]||(e[13]=s("p",{class:"page-subtitle"},"管理您的个人信息和账户偏好设置",-1))])])]),s("div",he,[s("div",ye,[s("div",Ve,[e[17]||(e[17]=s("div",{class:"card-header"},[s("h3",null,"基本信息"),s("p",null,"更新您的个人基本信息")],-1)),s("div",Pe,[t(S,{model:i,rules:L,ref_key:"userFormRef",ref:N,"label-width":"100px",class:"user-form"},{default:o(()=>[t(p,{label:"头像"},{default:o(()=>[s("div",ke,[t(Q,{src:i.avatar,size:80,class:"avatar-preview"},{default:o(()=>{var l;return[f(g(((l=i.nickname)==null?void 0:l.charAt(0))||"A"),1)]}),_:1},8,["src"]),s("div",Ne,[t(W,{class:"avatar-uploader",action:`${Ze}/files/upload/avatar`,headers:{Authorization:`Bearer ${m(ie)()}`},"show-file-list":!1,"on-success":j,"on-error":q,"before-upload":$,accept:"image/*"},{default:o(()=>[t(_,{type:"primary",size:"small",loading:h.value},{default:o(()=>[t(d,null,{default:o(()=>[t(m(ne))]),_:1}),f(" "+g(h.value?"上传中...":"上传头像"),1)]),_:1},8,["loading"])]),_:1},8,["action","headers"]),t(_,{size:"small",onClick:T,disabled:!i.avatar},{default:o(()=>e[14]||(e[14]=[f("移除",-1)])),_:1,__:[14]},8,["disabled"])])])]),_:1}),t(p,{label:"昵称",prop:"nickname"},{default:o(()=>[t(v,{modelValue:i.nickname,"onUpdate:modelValue":e[0]||(e[0]=l=>i.nickname=l),placeholder:"请输入昵称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(p,{label:"邮箱",prop:"email"},{default:o(()=>[t(v,{modelValue:i.email,"onUpdate:modelValue":e[1]||(e[1]=l=>i.email=l),placeholder:"请输入邮箱",type:"email",readonly:""},null,8,["modelValue"]),e[15]||(e[15]=s("div",{class:"field-note"},"邮箱不支持修改",-1))]),_:1,__:[15]}),t(p,{label:"个人简介",prop:"bio"},{default:o(()=>[t(v,{modelValue:i.bio,"onUpdate:modelValue":e[2]||(e[2]=l=>i.bio=l),type:"textarea",rows:4,placeholder:"介绍一下自己吧...",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(p,{label:"个人网站",prop:"website"},{default:o(()=>[t(v,{modelValue:i.website,"onUpdate:modelValue":e[3]||(e[3]=l=>i.website=l),placeholder:"请输入个人网站地址",maxlength:"200"},null,8,["modelValue"])]),_:1}),t(p,{label:"GitHub",prop:"github"},{default:o(()=>[t(v,{modelValue:i.github,"onUpdate:modelValue":e[4]||(e[4]=l=>i.github=l),placeholder:"请输入GitHub地址",maxlength:"200"},null,8,["modelValue"])]),_:1}),t(p,null,{default:o(()=>[t(_,{type:"primary",onClick:H,loading:y.value},{default:o(()=>[f(g(y.value?"保存中...":"保存更改"),1)]),_:1},8,["loading"]),t(_,{onClick:O},{default:o(()=>e[16]||(e[16]=[f("重置",-1)])),_:1,__:[16]})]),_:1})]),_:1},8,["model"])])]),s("div",Ue,[e[20]||(e[20]=s("div",{class:"card-header"},[s("h3",null,"偏好设置"),s("p",null,"自定义您的使用体验")],-1)),s("div",Ee,[s("div",xe,[e[18]||(e[18]=s("div",{class:"preference-info"},[s("h4",null,"邮件通知"),s("p",null,"接收系统邮件通知")],-1)),t(F,{modelValue:u.emailNotifications,"onUpdate:modelValue":e[5]||(e[5]=l=>u.emailNotifications=l),onChange:e[6]||(e[6]=l=>x("emailNotifications"))},null,8,["modelValue"])]),s("div",Ae,[e[19]||(e[19]=s("div",{class:"preference-info"},[s("h4",null,"桌面通知"),s("p",null,"接收浏览器桌面通知")],-1)),t(F,{modelValue:u.desktopNotifications,"onUpdate:modelValue":e[7]||(e[7]=l=>u.desktopNotifications=l),onChange:e[8]||(e[8]=l=>x("desktopNotifications"))},null,8,["modelValue"])]),s("div",Se,[t(_,{type:"primary",onClick:Z,loading:V.value},{default:o(()=>[f(g(V.value?"保存中...":"保存偏好"),1)]),_:1},8,["loading"])])])]),s("div",Fe,[e[22]||(e[22]=s("div",{class:"card-header"},[s("h3",null,"密码修改"),s("p",null,"定期更改密码可提高账户安全性")],-1)),s("div",Ce,[t(S,{model:c,rules:M,ref_key:"passwordFormRef",ref:b,"label-width":"100px"},{default:o(()=>[t(p,{label:"当前密码",prop:"oldPassword"},{default:o(()=>[t(v,{modelValue:c.oldPassword,"onUpdate:modelValue":e[9]||(e[9]=l=>c.oldPassword=l),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),t(p,{label:"新密码",prop:"newPassword"},{default:o(()=>[t(v,{modelValue:c.newPassword,"onUpdate:modelValue":e[10]||(e[10]=l=>c.newPassword=l),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),t(p,{label:"确认密码",prop:"confirmPassword"},{default:o(()=>[t(v,{modelValue:c.confirmPassword,"onUpdate:modelValue":e[11]||(e[11]=l=>c.confirmPassword=l),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),t(p,null,{default:o(()=>[t(_,{type:"primary",onClick:J,loading:P.value},{default:o(()=>[f(g(P.value?"修改中...":"修改密码"),1)]),_:1},8,["loading"]),t(_,{onClick:A},{default:o(()=>e[21]||(e[21]=[f("重置",-1)])),_:1,__:[21]})]),_:1})]),_:1},8,["model"])])]),s("div",Ie,[e[27]||(e[27]=s("div",{class:"card-header"},[s("h3",null,"账户状态"),s("p",null,"查看您的账户信息和状态")],-1)),s("div",Be,[s("div",Re,[s("div",ze,[s("div",De,[t(d,null,{default:o(()=>[t(m(R))]),_:1})]),s("div",Le,[e[23]||(e[23]=s("h4",null,"账户状态",-1)),s("p",null,g((C=m(n).user)!=null&&C.status?"正常":"已停用"),1)])]),s("div",Me,[s("div",Ge,[t(d,null,{default:o(()=>[t(m(R))]),_:1})]),e[24]||(e[24]=s("div",{class:"status-info"},[s("h4",null,"邮箱验证"),s("p",null,"已验证")],-1))]),s("div",He,[s("div",Oe,[t(d,null,{default:o(()=>[t(m(z))]),_:1})]),s("div",$e,[e[25]||(e[25]=s("h4",null,"用户角色",-1)),s("p",null,g(((I=m(n).user)==null?void 0:I.role)==="ADMIN"?"管理员":"普通用户"),1)])]),s("div",je,[s("div",qe,[t(d,null,{default:o(()=>[t(m(z))]),_:1})]),s("div",Te,[e[26]||(e[26]=s("h4",null,"注册时间",-1)),s("p",null,g(K((B=m(n).user)==null?void 0:B.createdAt)),1)])])])])])])])])}}},ns=X(Je,[["__scopeId","data-v-81309321"]]);export{ns as default};
