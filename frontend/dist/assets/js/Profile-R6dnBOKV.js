/* empty css             *//* empty css                    *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                     *//* empty css               *//* empty css                 *//* empty css                *//* empty css                  *//* empty css                    *//* empty css                  *//* empty css                  */import{r as e,b as a,X as l,p as s,c as t,a as r,Q as o,I as i,ay as d,o as u,M as n,O as c,K as m,u as p,P as v,a6 as f,V as w}from"./vue-B9wWIsxR.js";import{a3 as b,G as g,aZ as _,j as h,f as y,d as V,K as k,R as C,S as P,T as j,m as U,r as x,s as A,a0 as z,a2 as T,e as R,a5 as Z,U as q,F as H,h as S,E as Y,aa as $}from"./element-plus-CXASJE3V.js";import{u as E,b as F}from"./index-di9GIa25.js";import{b as I}from"./positionedConfirm-DdmNknNt.js";import{_ as L}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./utils-C28rWPR3.js";const M={class:"profile-page"},O={class:"profile-container"},G={class:"profile-header"},B={class:"avatar-section"},D={class:"user-info"},J={class:"username"},K={class:"bio"},N={class:"user-stats"},Q={class:"stat-item"},W={class:"stat-number"},X={class:"stat-item"},ee={class:"stat-number"},ae={class:"stat-item"},le={class:"stat-number"},se={class:"stat-item"},te={class:"stat-number"},re={class:"articles-section"},oe={class:"articles-header"},ie={class:"articles-list"},de=["onClick"],ue={class:"article-info"},ne={class:"article-summary"},ce={class:"article-meta"},me={class:"article-date"},pe={class:"article-stats"},ve={class:"article-actions"},fe={key:0,class:"empty-state"},we={class:"comments-section"},be={class:"comments-list"},ge={class:"comment-content"},_e={class:"comment-meta"},he={class:"comment-article"},ye=["onClick"],Ve={class:"comment-date"},ke={class:"comment-actions"},Ce={key:0,class:"empty-state"},Pe=L({__name:"Profile",setup(L){const Pe=d(),je=E(),Ue=e("info"),xe=e(!1),Ae=e(!1),ze=e(""),Te=e(""),Re=e(!1),Ze=e(),qe=e(),He=e(),Se=e("/api/files/upload/avatar"),Ye=a(()=>({Authorization:`Bearer ${je.token}`})),$e=a(()=>je.user||{}),Ee=l({username:"",nickname:"",email:"",phone:"",bio:"",website:"",github:""}),Fe=l({oldPassword:"",newPassword:"",confirmPassword:""}),Ie=e([]),Le=e([]),Me={nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:1,max:50,message:"昵称长度在 1 到 50 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},Oe={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(e,a,l)=>{a!==Fe.newPassword?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]},Ge=a(()=>{let e=Ie.value;return ze.value&&(e=e.filter(e=>e.title.toLowerCase().includes(ze.value.toLowerCase())||e.summary.toLowerCase().includes(ze.value.toLowerCase()))),Te.value&&(e=e.filter(e=>e.status===Te.value)),e}),Be=e=>({published:"已发布",draft:"草稿"}[e]||"未知"),De=e=>$(e).format("YYYY-MM-DD HH:mm"),Je=e=>{const a=e.type.startsWith("image/"),l=e.size/1024/1024<2;return a?l?(Re.value=!0,!0):(Y.error("图片大小不能超过 2MB!"),!1):(Y.error("只能上传图片文件!"),!1)},Ke=e=>{Re.value=!1,200===e.code?($e.value.avatar=e.data.fileUrl,Y.success("头像更新成功!"),Qe(e.data.fileUrl)):Y.error(e.message||"上传失败")},Ne=e=>{Re.value=!1,Y.error("头像上传失败，请重试")},Qe=async e=>{try{const a=await F.updateAvatar($e.value.id,e);200===a.code?je.updateUser({avatar:a.data.avatar}):Y.error(a.message||"头像更新失败")}catch(a){Y.error("头像保存失败")}},We=async()=>{try{await Ze.value.validate(),xe.value=!0;const e=await F.updateUser($e.value.id,Ee);200===e.code?(je.updateUser(e.data),Y.success("个人信息更新成功")):Y.error(e.message||"更新失败")}catch(e){"validation failed"!==e&&Y.error("更新失败")}finally{xe.value=!1}},Xe=async()=>{try{await qe.value.validate(),Ae.value=!0;const e=await F.updatePassword($e.value.id,{oldPassword:Fe.oldPassword,newPassword:Fe.newPassword});200===e.code?(qe.value.resetFields(),Object.assign(Fe,{oldPassword:"",newPassword:"",confirmPassword:""}),Y.success("密码修改成功")):Y.error(e.message||"修改失败")}catch(e){"validation failed"!==e&&Y.error("修改失败")}finally{Ae.value=!1}},ea=e=>{Pe.push(`/article/${e.slug}`)},aa=async()=>{try{Ie.value=[{id:1,title:"Vue.js 3.0 新特性详解",summary:"本文详细介绍了Vue.js 3.0的新特性和改进...",status:"published",viewCount:1250,commentCount:15,likeCount:89,createdAt:"2025-01-15T10:00:00Z"},{id:2,title:"JavaScript ES2023 新特性",summary:"探索JavaScript ES2023版本中的新特性...",status:"published",viewCount:890,commentCount:8,likeCount:56,createdAt:"2025-01-10T14:30:00Z"},{id:3,title:"React Hooks 最佳实践",summary:"分享React Hooks的使用技巧和最佳实践...",status:"draft",viewCount:0,commentCount:0,likeCount:0,createdAt:"2025-01-08T09:15:00Z"}]}catch(e){}},la=async()=>{try{Le.value=[{id:1,content:"这篇文章写得很好，学到了很多新知识！",article:{id:10,title:"TypeScript 进阶指南"},createdAt:"2025-01-14T16:20:00Z"},{id:2,content:"感谢分享，代码示例很实用。",article:{id:11,title:"Node.js 性能优化技巧"},createdAt:"2025-01-12T11:45:00Z"}]}catch(e){}};return s(async()=>{je.user||await je.initUser(),$e.value&&Object.assign(Ee,{username:$e.value.username||"",nickname:$e.value.nickname||"",email:$e.value.email||"",phone:$e.value.phone||"",bio:$e.value.bio||"",website:$e.value.website||"",github:$e.value.github||""}),await Promise.all([aa(),la()])}),(e,a)=>{const l=g,s=h,d=_,$=b,E=U,F=j,L=P,je=C,Qe=k,aa=V,la=x,sa=T,ta=z,ra=R,oa=S,ia=y;return u(),t("div",M,[r("div",O,[o($,{class:"profile-card"},{default:i(()=>[r("div",G,[r("div",B,[o(l,{size:120,src:$e.value.avatar},null,8,["src"]),o(d,{ref_key:"avatarUploadRef",ref:He,action:Se.value,headers:Ye.value,"show-file-list":!1,"before-upload":Je,"on-success":Ke,"on-error":Ne,accept:"image/*"},{default:i(()=>[o(s,{type:"primary",size:"small",loading:Re.value},{default:i(()=>[n(c(Re.value?"上传中...":"更换头像"),1)]),_:1},8,["loading"])]),_:1},8,["action","headers"])]),r("div",D,[r("h2",null,c($e.value.nickname),1),r("p",J,"@"+c($e.value.username),1),r("p",K,c($e.value.bio||"这个人很懒，什么都没有留下..."),1),r("div",N,[r("div",Q,[r("span",W,c($e.value.articleCount),1),a[13]||(a[13]=r("span",{class:"stat-label"},"文章",-1))]),r("div",X,[r("span",ee,c($e.value.followersCount),1),a[14]||(a[14]=r("span",{class:"stat-label"},"粉丝",-1))]),r("div",ae,[r("span",le,c($e.value.followingCount),1),a[15]||(a[15]=r("span",{class:"stat-label"},"关注",-1))]),r("div",se,[r("span",te,c($e.value.likesCount),1),a[16]||(a[16]=r("span",{class:"stat-label"},"获赞",-1))])])])])]),_:1}),o($,{class:"content-card"},{default:i(()=>[o(ia,{modelValue:Ue.value,"onUpdate:modelValue":a[12]||(a[12]=e=>Ue.value=e),class:"profile-tabs"},{default:i(()=>[o(aa,{label:"个人信息",name:"info"},{default:i(()=>[o(Qe,{ref_key:"infoFormRef",ref:Ze,model:Ee,rules:Me,"label-width":"100px",class:"profile-form"},{default:i(()=>[o(je,{gutter:20},{default:i(()=>[o(L,{span:12},{default:i(()=>[o(F,{label:"用户名",prop:"username"},{default:i(()=>[o(E,{modelValue:Ee.username,"onUpdate:modelValue":a[0]||(a[0]=e=>Ee.username=e),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),o(L,{span:12},{default:i(()=>[o(F,{label:"昵称",prop:"nickname"},{default:i(()=>[o(E,{modelValue:Ee.nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>Ee.nickname=e),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(je,{gutter:20},{default:i(()=>[o(L,{span:12},{default:i(()=>[o(F,{label:"邮箱",prop:"email"},{default:i(()=>[o(E,{modelValue:Ee.email,"onUpdate:modelValue":a[2]||(a[2]=e=>Ee.email=e),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1}),o(L,{span:12},{default:i(()=>[o(F,{label:"手机号",prop:"phone"},{default:i(()=>[o(E,{modelValue:Ee.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>Ee.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(F,{label:"个人简介",prop:"bio"},{default:i(()=>[o(E,{modelValue:Ee.bio,"onUpdate:modelValue":a[4]||(a[4]=e=>Ee.bio=e),type:"textarea",rows:4,placeholder:"请输入个人简介",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(F,{label:"个人网站",prop:"website"},{default:i(()=>[o(E,{modelValue:Ee.website,"onUpdate:modelValue":a[5]||(a[5]=e=>Ee.website=e),placeholder:"请输入个人网站"},null,8,["modelValue"])]),_:1}),o(F,{label:"GitHub",prop:"github"},{default:i(()=>[o(E,{modelValue:Ee.github,"onUpdate:modelValue":a[6]||(a[6]=e=>Ee.github=e),placeholder:"请输入GitHub地址"},null,8,["modelValue"])]),_:1}),o(F,null,{default:i(()=>[o(s,{type:"primary",onClick:We,loading:xe.value},{default:i(()=>a[17]||(a[17]=[n(" 保存修改 ",-1)])),_:1,__:[17]},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),o(aa,{label:"修改密码",name:"password"},{default:i(()=>[o(Qe,{ref_key:"passwordFormRef",ref:qe,model:Fe,rules:Oe,"label-width":"100px",class:"profile-form",style:{"max-width":"400px"}},{default:i(()=>[o(F,{label:"当前密码",prop:"oldPassword"},{default:i(()=>[o(E,{modelValue:Fe.oldPassword,"onUpdate:modelValue":a[7]||(a[7]=e=>Fe.oldPassword=e),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),o(F,{label:"新密码",prop:"newPassword"},{default:i(()=>[o(E,{modelValue:Fe.newPassword,"onUpdate:modelValue":a[8]||(a[8]=e=>Fe.newPassword=e),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),o(F,{label:"确认密码",prop:"confirmPassword"},{default:i(()=>[o(E,{modelValue:Fe.confirmPassword,"onUpdate:modelValue":a[9]||(a[9]=e=>Fe.confirmPassword=e),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),o(F,null,{default:i(()=>[o(s,{type:"primary",onClick:Xe,loading:Ae.value},{default:i(()=>a[18]||(a[18]=[n(" 修改密码 ",-1)])),_:1,__:[18]},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),o(aa,{label:"我的文章",name:"articles"},{default:i(()=>[r("div",re,[r("div",oe,[o(E,{modelValue:ze.value,"onUpdate:modelValue":a[10]||(a[10]=e=>ze.value=e),placeholder:"搜索我的文章",style:{width:"300px"},clearable:""},{prefix:i(()=>[o(la,null,{default:i(()=>[o(p(A))]),_:1})]),_:1},8,["modelValue"]),o(ta,{modelValue:Te.value,"onUpdate:modelValue":a[11]||(a[11]=e=>Te.value=e),placeholder:"文章状态",style:{width:"120px"}},{default:i(()=>[o(sa,{label:"全部",value:""}),o(sa,{label:"已发布",value:"published"}),o(sa,{label:"草稿",value:"draft"})]),_:1},8,["modelValue"])]),r("div",ie,[(u(!0),t(v,null,f(Ge.value,e=>{return u(),t("div",{key:e.id,class:"article-item",onClick:a=>ea(e)},[r("div",ue,[r("h3",null,c(e.title),1),r("p",ne,c(e.summary),1),r("div",ce,[o(ra,{type:(l=e.status,{published:"success",draft:"warning"}[l]||"info"),size:"small"},{default:i(()=>[n(c(Be(e.status)),1)]),_:2},1032,["type"]),r("span",me,c(De(e.createdAt)),1),r("span",pe,[o(la,null,{default:i(()=>[o(p(Z))]),_:1}),n(" "+c(e.viewCount)+" ",1),o(la,null,{default:i(()=>[o(p(q))]),_:1}),n(" "+c(e.commentCount)+" ",1),o(la,null,{default:i(()=>[o(p(H))]),_:1}),n(" "+c(e.likeCount),1)])])]),r("div",ve,[o(s,{type:"primary",size:"small",onClick:w(a=>(e=>{Pe.push(`/admin/articles/edit/${e.id}`)})(e),["stop"])},{default:i(()=>a[19]||(a[19]=[n(" 编辑 ",-1)])),_:2,__:[19]},1032,["onClick"]),o(s,{type:"danger",size:"small",onClick:w(a=>(async(e,a)=>{try{await I(`确定要删除文章"${e.title}"吗？`,a);const l=Ie.value.findIndex(a=>a.id===e.id);l>-1&&Ie.value.splice(l,1),Y.success("删除成功")}catch(l){"cancel"!==l&&Y.error("删除失败")}})(e,a),["stop"])},{default:i(()=>a[20]||(a[20]=[n(" 删除 ",-1)])),_:2,__:[20]},1032,["onClick"])])],8,de);var l}),128))]),0===Ge.value.length?(u(),t("div",fe,[o(oa,{description:"暂无文章"})])):m("",!0)])]),_:1}),o(aa,{label:"我的评论",name:"comments"},{default:i(()=>[r("div",we,[r("div",be,[(u(!0),t(v,null,f(Le.value,e=>(u(),t("div",{key:e.id,class:"comment-item"},[r("div",ge,[r("p",null,c(e.content),1),r("div",_e,[r("span",he,[a[21]||(a[21]=n(" 评论于：",-1)),r("a",{onClick:a=>ea(e.article)},c(e.article.title),9,ye)]),r("span",Ve,c(De(e.createdAt)),1)])]),r("div",ke,[o(s,{type:"danger",size:"small",onClick:a=>(async(e,a)=>{try{await I("确定要删除这条评论吗？",a);const l=Le.value.findIndex(a=>a.id===e.id);l>-1&&Le.value.splice(l,1),Y.success("删除成功")}catch(l){"cancel"!==l&&Y.error("删除失败")}})(e,a)},{default:i(()=>a[22]||(a[22]=[n(" 删除 ",-1)])),_:2,__:[22]},1032,["onClick"])])]))),128))]),0===Le.value.length?(u(),t("div",Ce,[o(oa,{description:"暂无评论"})])):m("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])}}},[["__scopeId","data-v-4ead1583"]]);export{Pe as default};
