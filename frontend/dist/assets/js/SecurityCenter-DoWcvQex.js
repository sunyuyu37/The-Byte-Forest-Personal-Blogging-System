/* empty css             *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 */import{r as a,K as e,j as s,a_ as l,a0 as t,E as o,aw as i,T as n,m as c,b9 as r,ba as d,bb as u,P as v,aq as p,v as m,e as y,a2 as f}from"./element-plus-CXASJE3V.js";import{s as w}from"./positionedConfirm-DdmNknNt.js";import{t as g,e as h,b as _,a as P,c as b,d as j,u as V,f as k}from"./security-GM4R7VwQ.js";import{_ as x}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{X as C,b as T,r as I,p as U,c as N,a as A,Q as E,M as S,I as M,K as O,D as z,H as D,O as H,P as K,a6 as L,o as R,u as Z}from"./vue-B9wWIsxR.js";import"./index-di9GIa25.js";import"./utils-C28rWPR3.js";const q={class:"security-center"},F={class:"security-header"},G={class:"header-content"},Q={class:"title-section"},X={class:"page-title"},B={class:"security-content"},J={class:"security-grid"},W={class:"security-card"},Y={class:"card-content"},$={class:"password-strength"},aa={class:"strength-bar"},ea={class:"strength-text"},sa={class:"security-card"},la={class:"card-content"},ta={class:"two-factor-status"},oa={class:"status-info"},ia={class:"status-text"},na={key:0,class:"two-factor-options"},ca={class:"option-list"},ra={class:"option-icon"},da={class:"option-icon"},ua={class:"security-card"},va={class:"card-content"},pa={class:"activity-list"},ma={class:"activity-icon"},ya={class:"activity-info"},fa={class:"activity-header"},wa={class:"activity-time"},ga={class:"activity-location"},ha={class:"activity-ip"},_a={class:"activity-status"},Pa={class:"activity-actions"},ba={class:"security-card"},ja={class:"card-content"},Va={class:"security-options"},ka={class:"option-item"},xa={class:"option-item"},Ca={class:"option-item"},Ta={class:"security-actions"},Ia=x({__name:"SecurityCenter",setup(x){const Ia=C({currentPassword:"",newPassword:"",confirmPassword:""}),Ua=T(()=>{const a=Ia.newPassword;if(!a)return{level:"",text:""};let e=0;a.length>=8&&e++,/[a-z]/.test(a)&&e++,/[A-Z]/.test(a)&&e++,/[0-9]/.test(a)&&e++,/[^A-Za-z0-9]/.test(a)&&e++;const s=[{level:"weak",text:"弱"},{level:"fair",text:"一般"},{level:"good",text:"良好"},{level:"strong",text:"强"},{level:"very-strong",text:"很强"}];return s[Math.min(e-1,4)]||s[0]}),Na=I(!1),Aa=I(!1),Ea=I([]),Sa=C({loginNotification:!1,anomalyProtection:!1,sessionTimeout:"120"}),Ma=I({totalLogins:0,failedAttempts:0,activeSessions:0,lastLogin:null}),Oa=async()=>{try{const a=await _();200===a.code&&(Ma.value=a.data)}catch(a){}},za=async()=>{try{const a=await P();if(200===a.code){const e=a.data;Object.assign(Sa,{loginNotification:e.loginNotificationEnabled,anomalyProtection:e.anomalyProtectionEnabled,sessionTimeout:e.sessionTimeoutMinutes.toString()}),Aa.value=e.twoFactorEnabled}}catch(a){o.error("加载安全设置失败")}},Da=async()=>{try{const a=await b();200===a.code&&(Ea.value=a.data.map(a=>({id:a.id,device:a.deviceInfo||"Unknown Device",location:a.location||"未知位置",ip:a.ipAddress,time:a.loginTime,current:a.isCurrentSession,sessionId:a.sessionId})))}catch(a){o.error("加载登录活动失败")}},Ha=async()=>{if(Ia.currentPassword)if(Ia.newPassword)if(Ia.newPassword===Ia.confirmPassword)try{Na.value=!0;const a=await j({currentPassword:Ia.currentPassword,newPassword:Ia.newPassword});200===a.code?(o.success("密码更新成功"),Object.assign(Ia,{currentPassword:"",newPassword:"",confirmPassword:""})):o.error(a.message||"密码更新失败")}catch(a){o.error("密码更新失败")}finally{Na.value=!1}else o.error("两次输入的密码不一致");else o.error("请输入新密码");else o.error("请输入当前密码")},Ka=async()=>{try{Na.value=!0;const a=await g({enabled:!0,method:"AUTHENTICATOR"});200===a.code?(Aa.value=!0,o.success("身份验证器已启用")):o.error(a.message||"启用身份验证器失败")}catch(a){o.error("启用身份验证器失败")}finally{Na.value=!1}},La=async()=>{try{Na.value=!0;const a=await g({enabled:!0,method:"SMS"});200===a.code?(Aa.value=!0,o.success("短信验证已启用")):o.error(a.message||"启用短信验证失败")}catch(a){o.error("启用短信验证失败")}finally{Na.value=!1}},Ra=async()=>{try{Na.value=!0,await Da(),o.success("活动记录已刷新")}catch(a){o.error("刷新活动记录失败")}finally{Na.value=!1}},Za=async()=>{try{Na.value=!0;const a=await V({loginNotificationEnabled:Sa.loginNotification,anomalyProtectionEnabled:Sa.anomalyProtection,sessionTimeoutMinutes:parseInt(Sa.sessionTimeout)});200===a.code?o.success("安全设置保存成功"):o.error(a.message||"保存安全设置失败")}catch(a){o.error("保存安全设置失败")}finally{Na.value=!1}};return U(()=>{(async()=>{Na.value=!0;try{await Promise.all([Oa(),za(),Da()])}catch(a){}finally{Na.value=!1}})()}),(_,P)=>{const b=a,j=c,V=n,x=s,C=e,T=y,I=l,U=f,Ma=t;return R(),N("div",q,[A("div",F,[A("div",G,[A("div",Q,[A("h1",X,[E(b,{class:"title-icon"},{default:M(()=>[E(Z(i))]),_:1}),P[8]||(P[8]=S(" 安全中心 ",-1))]),P[9]||(P[9]=A("p",{class:"page-subtitle"},"保护您的账户安全，管理登录和验证设置",-1))])])]),A("div",B,[A("div",J,[A("div",W,[P[11]||(P[11]=A("div",{class:"card-header"},[A("h3",null,"密码管理"),A("p",null,"定期更新密码以保护账户安全")],-1)),A("div",Y,[E(C,{model:Ia,"label-width":"120px",class:"password-form"},{default:M(()=>[E(V,{label:"当前密码"},{default:M(()=>[E(j,{modelValue:Ia.currentPassword,"onUpdate:modelValue":P[0]||(P[0]=a=>Ia.currentPassword=a),type:"password",placeholder:"请输入当前密码","show-password":""},null,8,["modelValue"])]),_:1}),E(V,{label:"新密码"},{default:M(()=>[E(j,{modelValue:Ia.newPassword,"onUpdate:modelValue":P[1]||(P[1]=a=>Ia.newPassword=a),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"]),A("div",$,[A("div",aa,[A("div",{class:z(["strength-fill",Ua.value.level])},null,2)]),A("span",ea,H(Ua.value.text),1)])]),_:1}),E(V,{label:"确认新密码"},{default:M(()=>[E(j,{modelValue:Ia.confirmPassword,"onUpdate:modelValue":P[2]||(P[2]=a=>Ia.confirmPassword=a),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),E(V,null,{default:M(()=>[E(x,{type:"primary",onClick:Ha,loading:Na.value},{default:M(()=>P[10]||(P[10]=[S("更新密码",-1)])),_:1,__:[10]},8,["loading"])]),_:1})]),_:1},8,["model"])])]),A("div",sa,[P[15]||(P[15]=A("div",{class:"card-header"},[A("h3",null,"两步验证"),A("p",null,"为您的账户添加额外的安全保护")],-1)),A("div",la,[A("div",ta,[A("div",oa,[A("div",{class:z(["status-icon",Aa.value?"enabled":"disabled"])},[Aa.value?(R(),D(b,{key:0},{default:M(()=>[E(Z(r))]),_:1})):(R(),D(b,{key:1},{default:M(()=>[E(Z(d))]),_:1}))],2),A("div",ia,[A("h4",null,H(Aa.value?"已启用":"未启用"),1),A("p",null,H(Aa.value?"您的账户已受到两步验证保护":"启用两步验证以增强账户安全"),1)])]),E(x,{type:Aa.value?"danger":"primary",onClick:P[3]||(P[3]=a=>(async a=>{if(Aa.value)try{await w("确定要禁用两步验证吗？这将降低您的账户安全性。","确认禁用",a),Na.value=!0;const e=await g({enabled:!1});200===e.code?(Aa.value=!1,o.success("两步验证已禁用")):o.error(e.message||"禁用两步验证失败")}catch(e){"cancel"!==e.message&&o.error("禁用两步验证失败")}finally{Na.value=!1}else o.info("请选择验证方式来启用两步验证")})(a)),loading:Na.value},{default:M(()=>[S(H(Aa.value?"禁用":"启用"),1)]),_:1},8,["type","loading"])]),Aa.value?O("",!0):(R(),N("div",na,[P[14]||(P[14]=A("h4",null,"选择验证方式",-1)),A("div",ca,[A("div",{class:"option-item",onClick:Ka},[A("div",ra,[E(b,null,{default:M(()=>[E(Z(u))]),_:1})]),P[12]||(P[12]=A("div",{class:"option-info"},[A("h5",null,"身份验证器应用"),A("p",null,"使用 Google Authenticator 或类似应用")],-1)),E(b,{class:"arrow"},{default:M(()=>[E(Z(v))]),_:1})]),A("div",{class:"option-item",onClick:La},[A("div",da,[E(b,null,{default:M(()=>[E(Z(p))]),_:1})]),P[13]||(P[13]=A("div",{class:"option-info"},[A("h5",null,"短信验证"),A("p",null,"通过手机短信接收验证码")],-1)),E(b,{class:"arrow"},{default:M(()=>[E(Z(v))]),_:1})])])]))])]),A("div",ua,[P[19]||(P[19]=A("div",{class:"card-header"},[A("h3",null,"登录活动"),A("p",null,"查看最近的登录记录和设备信息")],-1)),A("div",va,[A("div",pa,[(R(!0),N(K,null,L(Ea.value,a=>(R(),N("div",{key:a.id,class:"activity-item"},[A("div",ma,[E(b,null,{default:M(()=>[E(Z(m))]),_:1})]),A("div",ya,[A("div",fa,[A("h4",null,H(a.device),1),A("span",wa,H(a.time),1)]),A("p",ga,H(a.location),1),A("p",ha,"IP: "+H(a.ip),1)]),A("div",_a,[E(T,{type:a.current?"success":"info",size:"small"},{default:M(()=>[S(H(a.current?"当前会话":"已结束"),1)]),_:2},1032,["type"]),a.current&&a.sessionId?(R(),D(x,{key:0,type:"danger",size:"small",onClick:e=>(async a=>{try{Na.value=!0;const e=await k(a);200===e.code?(o.success("会话已结束"),await Da()):o.error(e.message||"结束会话失败")}catch(e){o.error("结束会话失败")}finally{Na.value=!1}})(a.sessionId),loading:Na.value,style:{"margin-left":"10px"}},{default:M(()=>P[16]||(P[16]=[S(" 结束会话 ",-1)])),_:2,__:[16]},1032,["onClick","loading"])):O("",!0)])]))),128))]),A("div",Pa,[E(x,{onClick:Ra,loading:Na.value},{default:M(()=>P[17]||(P[17]=[S("刷新记录",-1)])),_:1,__:[17]},8,["loading"]),E(x,{type:"danger",onClick:P[4]||(P[4]=a=>(async a=>{try{await w("确定要注销所有设备吗？您需要重新登录。","确认注销",a),Na.value=!0;const e=await h();200===e.code?(o.success("已注销所有其他设备"),await Da()):o.error(e.message||"注销设备失败")}catch(e){"cancel"!==e.message&&o.error("注销设备失败")}finally{Na.value=!1}})(a)),loading:Na.value},{default:M(()=>P[18]||(P[18]=[S("注销所有设备",-1)])),_:1,__:[18]},8,["loading"])])])]),A("div",ba,[P[24]||(P[24]=A("div",{class:"card-header"},[A("h3",null,"安全设置"),A("p",null,"配置其他安全相关选项")],-1)),A("div",ja,[A("div",Va,[A("div",ka,[P[20]||(P[20]=A("div",{class:"option-info"},[A("h4",null,"登录通知"),A("p",null,"新设备登录时发送邮件通知")],-1)),E(I,{modelValue:Sa.loginNotification,"onUpdate:modelValue":P[5]||(P[5]=a=>Sa.loginNotification=a)},null,8,["modelValue"])]),A("div",xa,[P[21]||(P[21]=A("div",{class:"option-info"},[A("h4",null,"异常登录保护"),A("p",null,"检测到异常登录时要求额外验证")],-1)),E(I,{modelValue:Sa.anomalyProtection,"onUpdate:modelValue":P[6]||(P[6]=a=>Sa.anomalyProtection=a)},null,8,["modelValue"])]),A("div",Ca,[P[22]||(P[22]=A("div",{class:"option-info"},[A("h4",null,"会话超时"),A("p",null,"设置自动登出时间")],-1)),E(Ma,{modelValue:Sa.sessionTimeout,"onUpdate:modelValue":P[7]||(P[7]=a=>Sa.sessionTimeout=a),placeholder:"选择超时时间"},{default:M(()=>[E(U,{label:"30分钟",value:"30"}),E(U,{label:"1小时",value:"60"}),E(U,{label:"2小时",value:"120"}),E(U,{label:"4小时",value:"240"}),E(U,{label:"8小时",value:"480"})]),_:1},8,["modelValue"])])]),A("div",Ta,[E(x,{type:"primary",onClick:Za,loading:Na.value},{default:M(()=>P[23]||(P[23]=[S("保存设置",-1)])),_:1,__:[23]},8,["loading"])])])])])])])}}},[["__scopeId","data-v-6e266d07"]]);export{Ia as default};
