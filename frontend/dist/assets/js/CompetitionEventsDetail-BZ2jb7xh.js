/* empty css             *//* empty css                  *//* empty css                 *//* empty css                  *//* empty css                  *//* empty css               *//* empty css                           *//* empty css                         */import{r as a,p as e,c as t,a as l,Q as i,K as s,I as n,O as o,M as u,P as r,a6 as c,u as d,al as m,aD as v,o as p,H as f}from"./vue-B9wWIsxR.js";import{u as k}from"./index-di9GIa25.js";import{a6 as _,a7 as y,e as g,G as h,aa as C,r as w,F as j,j as L,a8 as b,m as x,a9 as A,E as I,ab as z,A as H,a5 as M,U as D,_ as T}from"./element-plus-CXASJE3V.js";import{a as Y}from"./article-Pn5uYJFo.js";import{c as U}from"./comment-DttPZ_iH.js";import{_ as V}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./utils-C28rWPR3.js";const $={class:"competition-events-detail"},E={class:"container"},O={key:0,class:"loading"},P={key:1,class:"article-content"},B={class:"competition-header"},F={class:"breadcrumb"},G={class:"competition-category"},K={class:"title"},Q={class:"competition-meta"},S={class:"author-info"},q={class:"author-details"},J={class:"name"},N={class:"time"},R={class:"competition-stats"},W={class:"stat-item"},X={class:"stat-item"},Z={class:"stat-item"},aa={key:0,class:"competition-tags"},ea={class:"competition-body"},ta=["innerHTML"],la={class:"competition-footer"},ia={class:"actions"},sa={class:"competition-comments-section"},na={key:0,class:"comment-form"},oa={class:"form-actions"},ua={key:1,class:"login-prompt"},ra={class:"comments-list"},ca={class:"comment-avatar"},da={class:"comment-content"},ma={class:"comment-header"},va={class:"username"},pa={class:"time"},fa={class:"comment-text"},ka={class:"comment-actions"},_a={key:0},ya={key:2,class:"not-found"},ga=V({__name:"CompetitionEventsDetail",setup(V){const ga=v(),ha=k(),Ca=a(!0),wa=a(null),ja=a([]),La=a(!1),ba=a(""),xa=a(!1),Aa=a=>C(a).format("YYYY-MM-DD HH:mm"),Ia=async()=>{var a;if(wa.value)try{const e=wa.value.slug||wa.value.id,t=await U.getArticleComments(e),l=(null==(a=t.data)?void 0:a.content)||t.data||[];ja.value=l.map(a=>({...a,isLiked:!1,likeCount:a.likeCount||0}))}catch(e){}},za=async()=>{if(ha.isLoggedIn)try{La.value?(await Y.unlikeArticle(wa.value.id),wa.value.likeCount--):(await Y.likeArticle(wa.value.id),wa.value.likeCount++),La.value=!La.value}catch(a){I.error("操作失败")}else I.warning("请先登录")},Ha=()=>{navigator.share?navigator.share({title:wa.value.title,text:wa.value.excerpt,url:window.location.href}):(navigator.clipboard.writeText(window.location.href),I.success("链接已复制到剪贴板"))},Ma=async()=>{if(ba.value.trim()){xa.value=!0;try{await U.createComment({articleId:wa.value.id,content:ba.value}),ba.value="",I.success("评论发表成功"),await Ia()}catch(a){I.error("评论失败")}finally{xa.value=!1}}else I.warning("请输入评论内容")};return e(async()=>{var a;Ca.value=!0;try{const t=ga.params.slug,l=await Y.getArticleBySlug(t);if(wa.value=l.data,ha.isLoggedIn&&(null==(a=wa.value)?void 0:a.id))try{const a=await Y.isArticleLiked(wa.value.id);La.value=!!a.data}catch(e){La.value=!1}await Ia()}catch(t){wa.value=null,I.error("加载文章失败，请稍后重试")}finally{Ca.value=!1}}),(a,e)=>{var v,k;const C=_,Y=z,V=y,ga=w,Ia=g,Da=h,Ta=L,Ya=x,Ua=m("router-link"),Va=A;return p(),t("div",$,[l("div",E,[Ca.value?(p(),t("div",O,[i(C,{rows:10,animated:""})])):wa.value?(p(),t("div",P,[l("header",B,[l("div",F,[i(V,{separator:"/"},{default:n(()=>[i(Y,{to:"/"},{default:n(()=>e[2]||(e[2]=[u("首页",-1)])),_:1,__:[2]}),i(Y,{to:"/competition-events"},{default:n(()=>e[3]||(e[3]=[u("竞赛活动",-1)])),_:1,__:[3]}),i(Y,null,{default:n(()=>[u(o(wa.value.title),1)]),_:1})]),_:1})]),l("div",G,[i(Ia,{type:"primary",size:"large",effect:"dark"},{default:n(()=>[i(ga,null,{default:n(()=>[i(d(H))]),_:1}),e[4]||(e[4]=u(" 竞赛活动 ",-1))]),_:1,__:[4]})]),l("h1",K,o(wa.value.title),1),l("div",Q,[l("div",S,[i(Da,{src:null==(v=wa.value.author)?void 0:v.avatar,size:44},{default:n(()=>{var a,e;return[u(o(null==(e=null==(a=wa.value.author)?void 0:a.nickname)?void 0:e.charAt(0)),1)]}),_:1},8,["src"]),l("div",q,[l("div",J,o(null==(k=wa.value.author)?void 0:k.nickname),1),l("div",N,o(Aa(wa.value.publishedAt)),1)])]),l("div",R,[l("span",W,[i(ga,null,{default:n(()=>[i(d(M))]),_:1}),u(o(wa.value.viewCount)+" 阅读",1)]),l("span",X,[i(ga,null,{default:n(()=>[i(d(j))]),_:1}),u(o(wa.value.likeCount)+" 点赞",1)]),l("span",Z,[i(ga,null,{default:n(()=>[i(d(D))]),_:1}),u(o(wa.value.commentCount||0)+" 评论",1)])])]),wa.value.tags&&wa.value.tags.length?(p(),t("div",aa,[(p(!0),t(r,null,c(wa.value.tags,e=>(p(),f(Ia,{key:e.id,type:"primary",effect:"plain",size:"large",onClick:t=>a.$router.push(`/tag/${e.slug}`)},{default:n(()=>[i(ga,null,{default:n(()=>[i(d(T))]),_:1}),u(" "+o(e.name),1)]),_:2},1032,["onClick"]))),128))])):s("",!0)]),l("main",ea,[l("div",{class:"content",innerHTML:wa.value.content},null,8,ta)]),l("footer",la,[l("div",ia,[i(Ta,{type:La.value?"primary":"default",icon:d(j),onClick:za},{default:n(()=>[u(o(La.value?"已点赞":"点赞")+" ("+o(wa.value.likeCount)+") ",1)]),_:1},8,["type","icon"]),i(Ta,{icon:d(b),onClick:Ha},{default:n(()=>e[5]||(e[5]=[u("分享",-1)])),_:1,__:[5]},8,["icon"])])]),l("section",sa,[l("h3",null,"讨论 ("+o(wa.value.commentCount||0)+")",1),d(ha).isLoggedIn?(p(),t("div",na,[i(Ya,{modelValue:ba.value,"onUpdate:modelValue":e[0]||(e[0]=a=>ba.value=a),type:"textarea",rows:4,placeholder:"欢迎分享你的赛前/赛后心得...",maxlength:"500","show-word-limit":""},null,8,["modelValue"]),l("div",oa,[i(Ta,{type:"primary",loading:xa.value,onClick:Ma},{default:n(()=>e[6]||(e[6]=[u("发表评论",-1)])),_:1,__:[6]},8,["loading"])])])):(p(),t("div",ua,[l("p",null,[i(Ua,{to:"/auth/login"},{default:n(()=>e[7]||(e[7]=[u("登录",-1)])),_:1,__:[7]}),e[8]||(e[8]=u(" 后参与讨论 ",-1))])])),l("div",ra,[(p(!0),t(r,null,c(ja.value,a=>{var e,r;return p(),t("div",{key:a.id,class:"comment-item"},[l("div",ca,[i(Da,{src:null==(e=a.user)?void 0:e.avatar,size:36},{default:n(()=>{var e,t;return[u(o(null==(t=null==(e=a.user)?void 0:e.nickname)?void 0:t.charAt(0)),1)]}),_:2},1032,["src"])]),l("div",da,[l("div",ma,[l("span",va,o(null==(r=a.user)?void 0:r.nickname),1),l("span",pa,o(Aa(a.createdAt)),1)]),l("div",fa,o(a.content),1),l("div",ka,[i(Ta,{size:"small",text:"",type:a.isLiked?"primary":"default",icon:d(j),onClick:e=>(async a=>{if(ha.isLoggedIn)try{a.isLiked?(await U.unlikeComment(a.id),a.likeCount--):(await U.likeComment(a.id),a.likeCount++),a.isLiked=!a.isLiked}catch(e){I.error("操作失败")}else I.warning("请先登录")})(a)},{default:n(()=>[u(o(a.isLiked?"已赞":"点赞")+" ",1),a.likeCount>0?(p(),t("span",_a,"("+o(a.likeCount)+")",1)):s("",!0)]),_:2},1032,["type","icon","onClick"])])])])}),128))])])])):(p(),t("div",ya,[i(Va,{icon:"warning",title:"活动不存在","sub-title":"抱歉，您访问的竞赛活动不存在或已被删除"},{extra:n(()=>[i(Ta,{type:"primary",onClick:e[1]||(e[1]=e=>a.$router.push("/competition-events"))},{default:n(()=>e[9]||(e[9]=[u("返回竞赛活动",-1)])),_:1,__:[9]})]),_:1})]))])])}}},[["__scopeId","data-v-3aa6e6da"]]);export{ga as default};
