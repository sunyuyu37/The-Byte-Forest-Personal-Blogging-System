/* empty css             *//* empty css                   *//* empty css                   *//* empty css                       *//* empty css                 *//* empty css                 *//* empty css                        *//* empty css                  *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                     */import{j as e,K as a,J as l,a1 as t,k as o,E as s,aS as r,r as i,Q as n,aT as d,T as u,m as c,aU as p,e as m,a_ as g,b1 as f,b0 as h,aV as _,aW as y,aa as v}from"./element-plus-CXASJE3V.js";import{g as b}from"./index-di9GIa25.js";import{s as w,b as j}from"./positionedConfirm-DdmNknNt.js";import{_ as V}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{r as C,X as z,b as T,p as U,c as k,a as x,Q as B,I as A,J as S,K as $,H as E,O,o as P,M as D,u as J,C as L}from"./vue-B9wWIsxR.js";import"./utils-C28rWPR3.js";const R={class:"admin-tags"},Y={class:"page-header"},q={class:"header-actions"},H={class:"search-section"},M={class:"table-section"},N={key:0,class:"batch-actions"},I={class:"pagination"},K={class:"color-input"},Q={class:"dialog-footer"},W=V({__name:"Tags",setup(V){const W=C(!1),X=C([]),F=C([]),G=C(!1),Z=C(!1),ee=C(!1),ae=C(),le=z({name:""}),te=z({id:null,name:"",slug:"",color:"#409eff",description:"",sort:0,status:1}),oe=z({page:1,size:20,total:0}),se={name:[{required:!0,message:"请输入标签名称",trigger:"blur"},{min:1,max:20,message:"标签名称长度在 1 到 20 个字符",trigger:"blur"}],slug:[{required:!0,message:"请输入标签别名",trigger:"blur"},{pattern:/^[a-zA-Z0-9-_]+$/,message:"别名只能包含字母、数字、横线和下划线",trigger:"blur"}],color:[{required:!0,message:"请选择标签颜色",trigger:"blur"}]},re=T(()=>te.id?"编辑标签":"新建标签"),ie=e=>{F.value=e},ne=()=>{oe.page=1,he()},de=()=>{le.name="",oe.page=1,he()},ue=()=>{me(),G.value=!0},ce=async()=>{if(ae.value)try{await ae.value.validate(),Z.value=!0;const e={name:te.name,description:te.description,color:te.color};let a;a=te.id?await fetch(`/api/admin/tags/${te.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b()}`},body:JSON.stringify(e)}):await fetch("/api/admin/tags",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b()}`},body:JSON.stringify(e)});const l=await a.json();200===l.code?(s.success(l.message||(te.id?"更新成功":"创建成功")),G.value=!1,he()):s.error(l.message||"操作失败")}catch(e){s.error("操作失败")}finally{Z.value=!1}},pe=()=>{var e;null==(e=ae.value)||e.resetFields(),me()},me=()=>{Object.assign(te,{id:null,name:"",slug:"",color:"#409eff",description:"",sort:0,status:1})},ge=e=>{oe.size=e,oe.page=1,he()},fe=e=>{oe.page=e,he()},he=async()=>{W.value=!0;try{const e={page:oe.page-1,size:oe.size,sortBy:"createdAt",sortDir:"desc"};le.name&&(e.keyword=le.name);const a=await fetch("/api/admin/tags?"+new URLSearchParams(e),{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b()}`}}),l=await a.json();200===l.code?(X.value=l.data.content.map(e=>({...e,status:e.deleted?0:1})),oe.total=l.data.totalElements):s.error(l.message||"加载标签列表失败")}catch(e){s.error("加载标签列表失败")}finally{W.value=!1}};return U(()=>{he()}),(V,C)=>{const z=i,T=e,U=c,me=u,_e=a,ye=p,ve=m,be=g,we=r,je=t,Ve=f,Ce=h,ze=y,Te=_,Ue=o,ke=l;return P(),k("div",R,[x("div",Y,[C[16]||(C[16]=x("h1",null,"标签管理",-1)),x("div",q,[B(T,{type:"warning",onClick:C[0]||(C[0]=e=>(async e=>{try{await w("此操作将重新计算所有标签的文章数量（只统计已发布的文章），确定要继续吗？","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消"},e),ee.value=!0;const a=await fetch("/api/admin/tags/recalculate-counts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b()}`}}),l=await a.json();200===l.code?(s.success(l.message||"重新计算完成"),he()):s.error(l.message||"重新计算失败")}catch(a){"cancel"!==a&&s.error("重新计算失败")}finally{ee.value=!1}})(e)),loading:ee.value},{default:A(()=>[B(z,null,{default:A(()=>[B(J(n))]),_:1}),C[14]||(C[14]=D(" 重新计算文章数 ",-1))]),_:1,__:[14]},8,["loading"]),B(T,{type:"primary",onClick:ue},{default:A(()=>[B(z,null,{default:A(()=>[B(J(d))]),_:1}),C[15]||(C[15]=D(" 新建标签 ",-1))]),_:1,__:[15]})])]),x("div",H,[B(_e,{model:le,inline:""},{default:A(()=>[B(me,{label:"标签名称"},{default:A(()=>[B(U,{modelValue:le.name,"onUpdate:modelValue":C[1]||(C[1]=e=>le.name=e),placeholder:"请输入标签名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),B(me,null,{default:A(()=>[B(T,{type:"primary",onClick:ne},{default:A(()=>C[17]||(C[17]=[D("搜索",-1)])),_:1,__:[17]}),B(T,{onClick:de},{default:A(()=>C[18]||(C[18]=[D("重置",-1)])),_:1,__:[18]})]),_:1})]),_:1},8,["model"])]),x("div",M,[S((P(),E(we,{data:X.value,style:{width:"100%"},onSelectionChange:ie},{default:A(()=>[B(ye,{type:"selection",width:"55"}),B(ye,{prop:"name",label:"标签名称","min-width":"150"},{default:A(({row:e})=>[B(ve,{color:e.color,style:{color:"white",border:"none"}},{default:A(()=>[D(O(e.name),1)]),_:2},1032,["color"])]),_:1}),B(ye,{prop:"slug",label:"别名",width:"150"}),B(ye,{prop:"description",label:"描述","min-width":"200"}),B(ye,{prop:"color",label:"颜色",width:"100"},{default:A(({row:e})=>[x("div",{class:"color-preview",style:L({backgroundColor:e.color})},null,4)]),_:1}),B(ye,{prop:"articleCount",label:"文章数",width:"100"}),B(ye,{prop:"sort",label:"排序",width:"100"}),B(ye,{prop:"status",label:"状态",width:"100"},{default:A(({row:e})=>[B(be,{modelValue:e.status,"onUpdate:modelValue":a=>e.status=a,"active-value":1,"inactive-value":0,onChange:a=>(async e=>{try{s.success("状态更新成功")}catch(a){s.error("状态更新失败"),e.status=1===e.status?0:1}})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),B(ye,{prop:"createdAt",label:"创建时间",width:"180"},{default:A(({row:e})=>{return[D(O((a=e.createdAt,a?v(a).format("YYYY-MM-DD HH:mm"):"-")),1)];var a}),_:1}),B(ye,{label:"操作",width:"150",fixed:"right"},{default:A(({row:e})=>[B(T,{type:"primary",size:"small",onClick:a=>(e=>{Object.assign(te,{id:e.id,name:e.name,slug:e.slug,color:e.color,description:e.description,sort:e.sort,status:e.status}),G.value=!0})(e)},{default:A(()=>C[19]||(C[19]=[D(" 编辑 ",-1)])),_:2,__:[19]},1032,["onClick"]),B(T,{type:"danger",size:"small",onClick:a=>(async(e,a)=>{if(e.articleCount>0)s.warning("该标签下还有文章，无法删除");else try{await j(e.name,a);const l=await fetch(`/api/admin/tags/${e.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b()}`}}),t=await l.json();200===t.code?(s.success(t.message||"删除成功"),he()):s.error(t.message||"删除失败")}catch(l){"cancel"!==l&&s.error("删除失败")}})(e,a),disabled:e.articleCount>0},{default:A(()=>C[20]||(C[20]=[D(" 删除 ",-1)])),_:2,__:[20]},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[ke,W.value]]),F.value.length>0?(P(),k("div",N,[x("span",null,"已选择 "+O(F.value.length)+" 项",1),B(T,{type:"danger",size:"small",onClick:C[2]||(C[2]=e=>(async e=>{const a=F.value.filter(e=>0===e.articleCount);if(0!==a.length)try{await j(`确定要删除选中的 ${a.length} 个标签吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消"},e);const l=await fetch("/api/admin/tags/batch",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b()}`},body:JSON.stringify({ids:a.map(e=>e.id)})}),t=await l.json();200===t.code?(s.success(t.message||"批量删除成功"),he(),F.value=[]):s.error(t.message||"批量删除失败")}catch(l){"cancel"!==l&&s.error("批量删除失败")}else s.warning("选中的标签都有关联文章，无法删除")})(e))},{default:A(()=>C[21]||(C[21]=[D(" 批量删除 ",-1)])),_:1,__:[21]})])):$("",!0),x("div",I,[B(je,{"current-page":oe.page,"onUpdate:currentPage":C[3]||(C[3]=e=>oe.page=e),"page-size":oe.size,"onUpdate:pageSize":C[4]||(C[4]=e=>oe.size=e),"page-sizes":[10,20,50,100],total:oe.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ge,onCurrentChange:fe},null,8,["current-page","page-size","total"])])]),B(Ue,{modelValue:G.value,"onUpdate:modelValue":C[13]||(C[13]=e=>G.value=e),title:re.value,width:"500px",onClose:pe},{footer:A(()=>[x("div",Q,[B(T,{onClick:C[12]||(C[12]=e=>G.value=!1)},{default:A(()=>C[24]||(C[24]=[D("取消",-1)])),_:1,__:[24]}),B(T,{type:"primary",onClick:ce,loading:Z.value},{default:A(()=>C[25]||(C[25]=[D(" 确定 ",-1)])),_:1,__:[25]},8,["loading"])])]),default:A(()=>[B(_e,{ref_key:"formRef",ref:ae,model:te,rules:se,"label-width":"80px"},{default:A(()=>[B(me,{label:"标签名称",prop:"name"},{default:A(()=>[B(U,{modelValue:te.name,"onUpdate:modelValue":C[5]||(C[5]=e=>te.name=e),placeholder:"请输入标签名称"},null,8,["modelValue"])]),_:1}),B(me,{label:"标签别名",prop:"slug"},{default:A(()=>[B(U,{modelValue:te.slug,"onUpdate:modelValue":C[6]||(C[6]=e=>te.slug=e),placeholder:"请输入标签别名（用于URL）"},null,8,["modelValue"])]),_:1}),B(me,{label:"标签颜色",prop:"color"},{default:A(()=>[x("div",K,[B(Ve,{modelValue:te.color,"onUpdate:modelValue":C[7]||(C[7]=e=>te.color=e)},null,8,["modelValue"]),B(U,{modelValue:te.color,"onUpdate:modelValue":C[8]||(C[8]=e=>te.color=e),placeholder:"请选择或输入颜色值",style:{"margin-left":"10px"}},null,8,["modelValue"])])]),_:1}),B(me,{label:"标签描述",prop:"description"},{default:A(()=>[B(U,{modelValue:te.description,"onUpdate:modelValue":C[9]||(C[9]=e=>te.description=e),type:"textarea",rows:3,placeholder:"请输入标签描述"},null,8,["modelValue"])]),_:1}),B(me,{label:"排序",prop:"sort"},{default:A(()=>[B(Ce,{modelValue:te.sort,"onUpdate:modelValue":C[10]||(C[10]=e=>te.sort=e),min:0,max:999,placeholder:"数字越小越靠前"},null,8,["modelValue"])]),_:1}),B(me,{label:"状态",prop:"status"},{default:A(()=>[B(Te,{modelValue:te.status,"onUpdate:modelValue":C[11]||(C[11]=e=>te.status=e)},{default:A(()=>[B(ze,{label:1},{default:A(()=>C[22]||(C[22]=[D("启用",-1)])),_:1,__:[22]}),B(ze,{label:0},{default:A(()=>C[23]||(C[23]=[D("禁用",-1)])),_:1,__:[23]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-dc610b0e"]]);export{W as default};
