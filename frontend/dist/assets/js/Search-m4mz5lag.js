/* empty css             *//* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                 *//* empty css                        *//* empty css                *//* empty css                     *//* empty css               *//* empty css                  */import{r as e,w as a,p as l,aD as t,c as s,a as u,J as r,K as o,Q as n,I as i,a4 as c,u as v,M as d,O as p,R as m,P as g,a6 as y,ay as _,o as f,H as h}from"./vue-B9wWIsxR.js";import{s as k,m as b,a3 as C,W as j,j as V,a4 as w,a0 as S,J as x,h as z,a1 as R,E as U,K as q,R as H,S as I,T,a2 as J,a5 as L,r as M,F as O,e as B}from"./element-plus-CXASJE3V.js";import{a as E}from"./article-Pn5uYJFo.js";import{c as K}from"./category-PKu3E1eX.js";import{g as N}from"./placeholder-Cbo4Yzwr.js";import{_ as A}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-di9GIa25.js";import"./utils-C28rWPR3.js";const D={class:"search-page"},P={class:"container"},$={class:"search-header"},Q={class:"search-box"},F={key:0,class:"search-stats"},W={key:0},Y={key:1},G={class:"advanced-search"},X={class:"search-toolbar"},Z={class:"toolbar-left"},ee={class:"toolbar-right"},ae={class:"search-results"},le={key:0,class:"results-list"},te=["onClick"],se={class:"result-content"},ue=["innerHTML"],re=["innerHTML"],oe={class:"result-meta"},ne={class:"category"},ie={class:"author"},ce={class:"date"},ve={class:"stats"},de={key:0,class:"result-image"},pe=["src","alt"],me={key:1,class:"empty-state"},ge={key:2,class:"search-suggestions"},ye={class:"suggestion-tags"},_e={class:"recent-searches"},fe={key:0,class:"pagination"},he=A({__name:"Search",setup(A){const he=t(),ke=_(),be=e(!1),Ce=e(""),je=e(""),Ve=e([]),we=e([]),Se=e(0),xe=e(1),ze=e(20),Re=e(!1),Ue=e(!1),qe=e("all"),He=e({category:"",sortBy:"relevance",timeRange:""}),Ie=e([]),Te=e([]);e([]),e(!1);const Je=e=>{const a=null==e?void 0:e.coverImage,l="string"==typeof a&&/(^https?:)?\/\/via\.placeholder\.com/i.test(a);return!a||l?N(120,80):a},Le=e=>{const a=null==e?void 0:e.target;a&&(a.onerror=null,a.src=N(120,80))},Me=async()=>{if(Ce.value.trim()){be.value=!0,Re.value=!0,je.value=Ce.value.trim();try{const e={keyword:je.value,page:xe.value-1,size:ze.value,searchType:qe.value,...He.value},a=await E.searchArticles(e);Ve.value=a.data.content,Se.value=a.data.totalElements,Qe(je.value)}catch(e){U.error("搜索失败，请稍后重试")}finally{be.value=!1}}else U.warning("请输入搜索关键词")},Oe=()=>{xe.value=1,Me()},Be=()=>{xe.value=1,Me()},Ee=()=>{He.value={category:"",sortBy:"relevance",timeRange:""}},Ke=e=>{qe.value=e,Re.value&&(xe.value=1,Me())},Ne=e=>{ze.value=e,xe.value=1,Re.value&&Me()},Ae=e=>{xe.value=e,Me()},De=e=>{if(!je.value||!e)return e;const a=new RegExp(`(${je.value})`,"gi");return e.replace(a,"<mark>$1</mark>")},Pe=e=>{Ce.value=e,Oe()},$e=()=>{Ce.value="",je.value="",Ve.value=[],Re.value=!1,Se.value=0,xe.value=1},Qe=e=>{const a=Te.value.filter(a=>a!==e);a.unshift(e),Te.value=a.slice(0,10),localStorage.setItem("recentSearches",JSON.stringify(Te.value))};return a(()=>he.query.q,e=>{e&&(Ce.value=e,Oe())},{immediate:!0}),l(()=>{const e=localStorage.getItem("recentSearches");e&&(Te.value=JSON.parse(e)),(async()=>{try{const e=await K.getAllCategories();we.value=e.data}catch(e){}})(),(async()=>{try{const e=await E.getHotKeywords();Ie.value=e.data}catch(e){}})(),he.query.q&&(Ce.value=he.query.q,Oe())}),(e,a)=>{const l=V,t=b,_=J,U=S,E=T,K=I,N=H,A=q,he=C,Me=w,Qe=M,Fe=z,We=B,Ye=R,Ge=x;return f(),s("div",D,[u("div",P,[u("div",$,[a[15]||(a[15]=u("h1",null,"全局搜索",-1)),u("div",Q,[n(t,{modelValue:Ce.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Ce.value=e),placeholder:"搜索文章、标签、分类...","prefix-icon":v(k),size:"large",onKeyup:c(Oe,["enter"]),clearable:""},{append:i(()=>[n(l,{icon:v(k),onClick:Oe},null,8,["icon"])]),_:1},8,["modelValue","prefix-icon"])]),Ve.value.length>0||Re.value?(f(),s("div",F,[Ve.value.length>0?(f(),s("p",W,[a[11]||(a[11]=d(" 找到 ",-1)),u("strong",null,p(Se.value),1),a[12]||(a[12]=d(" 个结果，关键词：",-1)),u("strong",null,'"'+p(je.value)+'"',1)])):Re.value?(f(),s("p",Y,[a[13]||(a[13]=d(" 没有找到与 ",-1)),u("strong",null,'"'+p(je.value)+'"',1),a[14]||(a[14]=d(" 相关的结果 ",-1))])):o("",!0)])):o("",!0)]),r(u("div",G,[n(he,null,{header:i(()=>a[16]||(a[16]=[u("span",null,"高级搜索",-1)])),default:i(()=>[n(A,{model:He.value,"label-width":"80px"},{default:i(()=>[n(N,{gutter:20},{default:i(()=>[n(K,{span:8},{default:i(()=>[n(E,{label:"分类"},{default:i(()=>[n(U,{modelValue:He.value.category,"onUpdate:modelValue":a[1]||(a[1]=e=>He.value.category=e),placeholder:"选择分类",clearable:""},{default:i(()=>[(f(!0),s(g,null,y(we.value,e=>(f(),h(_,{key:e.id,label:e.name,value:e.slug},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),n(K,{span:8},{default:i(()=>[n(E,{label:"排序"},{default:i(()=>[n(U,{modelValue:He.value.sortBy,"onUpdate:modelValue":a[2]||(a[2]=e=>He.value.sortBy=e),placeholder:"排序方式"},{default:i(()=>[n(_,{label:"相关度",value:"relevance"}),n(_,{label:"最新发布",value:"latest"}),n(_,{label:"最多阅读",value:"views"}),n(_,{label:"最多点赞",value:"likes"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),n(K,{span:8},{default:i(()=>[n(E,{label:"时间范围"},{default:i(()=>[n(U,{modelValue:He.value.timeRange,"onUpdate:modelValue":a[3]||(a[3]=e=>He.value.timeRange=e),placeholder:"选择时间范围",clearable:""},{default:i(()=>[n(_,{label:"最近一周",value:"week"}),n(_,{label:"最近一月",value:"month"}),n(_,{label:"最近三月",value:"quarter"}),n(_,{label:"最近一年",value:"year"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),n(E,null,{default:i(()=>[n(l,{type:"primary",onClick:Be},{default:i(()=>a[17]||(a[17]=[d("搜索",-1)])),_:1,__:[17]}),n(l,{onClick:Ee},{default:i(()=>a[18]||(a[18]=[d("重置",-1)])),_:1,__:[18]})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[m,Ue.value]]),u("div",X,[u("div",Z,[n(l,{type:Ue.value?"primary":"",icon:v(j),onClick:a[4]||(a[4]=e=>Ue.value=!Ue.value)},{default:i(()=>a[19]||(a[19]=[d(" 高级搜索 ",-1)])),_:1,__:[19]},8,["type","icon"]),n(Me,null,{default:i(()=>[n(l,{type:"all"===qe.value?"primary":"",onClick:a[5]||(a[5]=e=>Ke("all"))},{default:i(()=>a[20]||(a[20]=[d(" 全部 ",-1)])),_:1,__:[20]},8,["type"]),n(l,{type:"title"===qe.value?"primary":"",onClick:a[6]||(a[6]=e=>Ke("title"))},{default:i(()=>a[21]||(a[21]=[d(" 标题 ",-1)])),_:1,__:[21]},8,["type"]),n(l,{type:"content"===qe.value?"primary":"",onClick:a[7]||(a[7]=e=>Ke("content"))},{default:i(()=>a[22]||(a[22]=[d(" 内容 ",-1)])),_:1,__:[22]},8,["type"])]),_:1})]),u("div",ee,[n(U,{modelValue:ze.value,"onUpdate:modelValue":a[8]||(a[8]=e=>ze.value=e),onChange:Ne,style:{width:"120px"}},{default:i(()=>[n(_,{label:"10条/页",value:10}),n(_,{label:"20条/页",value:20}),n(_,{label:"50条/页",value:50})]),_:1},8,["modelValue"])])]),r((f(),s("div",ae,[Ve.value.length>0?(f(),s("div",le,[(f(!0),s(g,null,y(Ve.value,e=>{var a,l,t;return f(),s("div",{key:e.id,class:"result-item",onClick:a=>{return l=e.slug,void ke.push(`/article/${l}`);var l}},[u("div",se,[u("h3",{class:"result-title",innerHTML:De(e.title)},null,8,ue),u("p",{class:"result-summary",innerHTML:De(e.summary)},null,8,re),u("div",oe,[u("span",ne,p(null==(a=e.category)?void 0:a.name),1),u("span",ie,p(null==(l=e.author)?void 0:l.nickname),1),u("span",ce,p((t=e.publishedAt,new Date(t).toLocaleDateString("zh-CN"))),1),u("span",ve,[n(Qe,null,{default:i(()=>[n(v(L))]),_:1}),d(p(e.viewCount)+" ",1),n(Qe,null,{default:i(()=>[n(v(O))]),_:1}),d(p(e.likeCount),1)])])]),Je(e)?(f(),s("div",de,[u("img",{src:Je(e),alt:e.title,onError:Le},null,40,pe)])):o("",!0)],8,te)}),128))])):Re.value&&!be.value?(f(),s("div",me,[n(Fe,{description:"没有找到相关结果"},{image:i(()=>[n(Qe,{size:"100"},{default:i(()=>[n(v(k))]),_:1})]),default:i(()=>[n(l,{type:"primary",onClick:$e},{default:i(()=>a[23]||(a[23]=[d("清空搜索",-1)])),_:1,__:[23]})]),_:1})])):o("",!0),Re.value?o("",!0):(f(),s("div",ge,[a[24]||(a[24]=u("h3",null,"热门搜索",-1)),u("div",ye,[(f(!0),s(g,null,y(Ie.value,e=>(f(),h(We,{key:e,onClick:a=>Pe(e),style:{cursor:"pointer",margin:"5px"}},{default:i(()=>[d(p(e),1)]),_:2},1032,["onClick"]))),128))]),a[25]||(a[25]=u("h3",null,"最近搜索",-1)),u("div",_e,[(f(!0),s(g,null,y(Te.value,e=>(f(),h(We,{key:e,closable:"",onClick:a=>Pe(e),onClose:a=>{return l=e,Te.value=Te.value.filter(e=>e!==l),void localStorage.setItem("recentSearches",JSON.stringify(Te.value));var l},style:{cursor:"pointer",margin:"5px"}},{default:i(()=>[d(p(e),1)]),_:2},1032,["onClick","onClose"]))),128))])]))])),[[Ge,be.value]]),Se.value>0?(f(),s("div",fe,[n(Ye,{"current-page":xe.value,"onUpdate:currentPage":a[9]||(a[9]=e=>xe.value=e),"page-size":ze.value,"onUpdate:pageSize":a[10]||(a[10]=e=>ze.value=e),total:Se.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Ne,onCurrentChange:Ae},null,8,["current-page","page-size","total"])])):o("",!0)])])}}},[["__scopeId","data-v-8477bc9f"]]);export{he as default};
