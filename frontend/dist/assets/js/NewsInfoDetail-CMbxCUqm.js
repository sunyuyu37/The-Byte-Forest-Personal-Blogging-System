/* empty css             *//* empty css                  *//* empty css                 *//* empty css                  *//* empty css                  *//* empty css               *//* empty css                           *//* empty css                         */import{r as a,p as e,c as l,a as t,Q as s,K as i,I as n,O as o,M as u,P as r,a6 as c,u as d,al as v,aD as m,o as g,H as f}from"./vue-B9wWIsxR.js";import{u as p}from"./index-di9GIa25.js";import{a6 as k,a7 as _,e as w,G as y,aa as h,r as C,F as j,j as L,a8 as b,m as x,a9 as A,E as I,ab as z,z as H,a5 as M,U as T,_ as $}from"./element-plus-CXASJE3V.js";import{a as D}from"./article-Pn5uYJFo.js";import{c as Y}from"./comment-DttPZ_iH.js";import{_ as B}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./utils-C28rWPR3.js";const P={class:"news-info-detail"},U={class:"container"},V={key:0,class:"loading"},E={key:1,class:"article-content"},O={class:"news-header"},F={class:"breadcrumb"},G={class:"news-category"},K={class:"title"},N={class:"news-meta"},Q={class:"author-info"},S={class:"author-details"},q={class:"name"},J={class:"time"},R={class:"news-stats"},W={class:"stat-item"},X={class:"stat-item"},Z={class:"stat-item"},aa={key:0,class:"news-tags"},ea={class:"news-body"},la=["innerHTML"],ta={class:"news-footer"},sa={class:"actions"},ia={class:"news-comments-section"},na={key:0,class:"comment-form"},oa={class:"form-actions"},ua={key:1,class:"login-prompt"},ra={class:"comments-list"},ca={class:"comment-avatar"},da={class:"comment-content"},va={class:"comment-header"},ma={class:"username"},ga={class:"time"},fa={class:"comment-text"},pa={class:"comment-actions"},ka={key:0},_a={class:"related"},wa={class:"related-list"},ya=["onClick"],ha=["src","alt"],Ca={class:"related-title"},ja={key:2,class:"not-found"},La=B({__name:"NewsInfoDetail",setup(B){const La=m(),ba=p(),xa=a(!0),Aa=a(null),Ia=a([]),za=a([]),Ha=a(!1),Ma=a(""),Ta=a(!1),$a=a=>h(a).format("YYYY-MM-DD HH:mm"),Da=async()=>{var a;if(Aa.value)try{const e=Aa.value.slug||Aa.value.id,l=await Y.getArticleComments(e),t=(null==(a=l.data)?void 0:a.content)||l.data||[];Ia.value=t.map(a=>({...a,isLiked:!1,likeCount:a.likeCount||0}))}catch(e){}},Ya=async()=>{var a,e,l,t;try{let i=[];if(null==(e=null==(a=Aa.value)?void 0:a.tags)?void 0:e.length)try{const a=Aa.value.tags[0].slug,e=await D.getArticlesByTag(a,{page:0,size:5});i=(null==(l=e.data)?void 0:l.content)||e.data||[]}catch(s){}if(!i.length){const a=await D.getArticlesByCategory("news",{page:0,size:5});i=(null==(t=a.data)?void 0:t.content)||a.data||[]}za.value=i.filter(a=>{var e;return a.id!==(null==(e=Aa.value)?void 0:e.id)}).slice(0,3)}catch(i){}},Ba=async()=>{if(ba.isLoggedIn)try{Ha.value?(await D.unlikeArticle(Aa.value.id),Aa.value.likeCount--):(await D.likeArticle(Aa.value.id),Aa.value.likeCount++),Ha.value=!Ha.value}catch(a){I.error("操作失败")}else I.warning("请先登录")},Pa=()=>{navigator.share?navigator.share({title:Aa.value.title,text:Aa.value.excerpt,url:window.location.href}):(navigator.clipboard.writeText(window.location.href),I.success("链接已复制到剪贴板"))},Ua=async()=>{if(Ma.value.trim()){Ta.value=!0;try{await Y.createComment({articleId:Aa.value.id,content:Ma.value}),Ma.value="",I.success("评论发表成功"),await Da()}catch(a){I.error("评论失败")}finally{Ta.value=!1}}else I.warning("请输入评论内容")},Va=a=>{a.target.src="/vite.svg"};return e(async()=>{var a;xa.value=!0;try{const l=La.params.slug,t=await D.getArticleBySlug(l);if(Aa.value=t.data,ba.isLoggedIn&&(null==(a=Aa.value)?void 0:a.id))try{const a=await D.isArticleLiked(Aa.value.id);Ha.value=!!a.data}catch(e){Ha.value=!1}await Promise.all([Da(),Ya()])}catch(l){Aa.value=null,I.error("加载文章失败，请稍后重试")}finally{xa.value=!1}}),(a,e)=>{var m,p;const h=k,D=z,B=_,La=C,Da=w,Ya=y,Ea=L,Oa=x,Fa=v("router-link"),Ga=A;return g(),l("div",P,[t("div",U,[xa.value?(g(),l("div",V,[s(h,{rows:10,animated:""})])):Aa.value?(g(),l("div",E,[t("header",O,[t("div",F,[s(B,{separator:"/"},{default:n(()=>[s(D,{to:"/"},{default:n(()=>e[2]||(e[2]=[u("首页",-1)])),_:1,__:[2]}),s(D,{to:"/news-info"},{default:n(()=>e[3]||(e[3]=[u("新闻资讯",-1)])),_:1,__:[3]}),s(D,null,{default:n(()=>[u(o(Aa.value.title),1)]),_:1})]),_:1})]),t("div",G,[s(Da,{type:"danger",size:"large",effect:"dark"},{default:n(()=>[s(La,null,{default:n(()=>[s(d(H))]),_:1}),e[4]||(e[4]=u(" 新闻资讯 ",-1))]),_:1,__:[4]})]),t("h1",K,o(Aa.value.title),1),t("div",N,[t("div",Q,[s(Ya,{src:null==(m=Aa.value.author)?void 0:m.avatar,size:44},{default:n(()=>{var a,e;return[u(o(null==(e=null==(a=Aa.value.author)?void 0:a.nickname)?void 0:e.charAt(0)),1)]}),_:1},8,["src"]),t("div",S,[t("div",q,o(null==(p=Aa.value.author)?void 0:p.nickname),1),t("div",J,o($a(Aa.value.publishedAt)),1)])]),t("div",R,[t("span",W,[s(La,null,{default:n(()=>[s(d(M))]),_:1}),u(o(Aa.value.viewCount)+" 阅读",1)]),t("span",X,[s(La,null,{default:n(()=>[s(d(j))]),_:1}),u(o(Aa.value.likeCount)+" 点赞",1)]),t("span",Z,[s(La,null,{default:n(()=>[s(d(T))]),_:1}),u(o(Aa.value.commentCount||0)+" 评论",1)])])]),Aa.value.tags&&Aa.value.tags.length?(g(),l("div",aa,[(g(!0),l(r,null,c(Aa.value.tags,e=>(g(),f(Da,{key:e.id,type:"danger",effect:"plain",size:"large",onClick:l=>a.$router.push(`/tag/${e.slug}`)},{default:n(()=>[s(La,null,{default:n(()=>[s(d($))]),_:1}),u(" "+o(e.name),1)]),_:2},1032,["onClick"]))),128))])):i("",!0)]),t("main",ea,[t("div",{class:"content",innerHTML:Aa.value.content},null,8,la)]),t("footer",ta,[t("div",sa,[s(Ea,{type:Ha.value?"danger":"default",icon:d(j),onClick:Ba},{default:n(()=>[u(o(Ha.value?"已点赞":"点赞")+" ("+o(Aa.value.likeCount)+") ",1)]),_:1},8,["type","icon"]),s(Ea,{icon:d(b),onClick:Pa},{default:n(()=>e[5]||(e[5]=[u("分享",-1)])),_:1,__:[5]},8,["icon"])])]),t("section",ia,[t("h3",null,"评论 ("+o(Aa.value.commentCount||0)+")",1),d(ba).isLoggedIn?(g(),l("div",na,[s(Oa,{modelValue:Ma.value,"onUpdate:modelValue":e[0]||(e[0]=a=>Ma.value=a),type:"textarea",rows:4,placeholder:"发表你的观点...",maxlength:"500","show-word-limit":""},null,8,["modelValue"]),t("div",oa,[s(Ea,{type:"danger",loading:Ta.value,onClick:Ua},{default:n(()=>e[6]||(e[6]=[u("发表评论",-1)])),_:1,__:[6]},8,["loading"])])])):(g(),l("div",ua,[t("p",null,[s(Fa,{to:"/auth/login"},{default:n(()=>e[7]||(e[7]=[u("登录",-1)])),_:1,__:[7]}),e[8]||(e[8]=u(" 后参与评论 ",-1))])])),t("div",ra,[(g(!0),l(r,null,c(Ia.value,a=>{var e,r;return g(),l("div",{key:a.id,class:"comment-item"},[t("div",ca,[s(Ya,{src:null==(e=a.user)?void 0:e.avatar,size:36},{default:n(()=>{var e,l;return[u(o(null==(l=null==(e=a.user)?void 0:e.nickname)?void 0:l.charAt(0)),1)]}),_:2},1032,["src"])]),t("div",da,[t("div",va,[t("span",ma,o(null==(r=a.user)?void 0:r.nickname),1),t("span",ga,o($a(a.createdAt)),1)]),t("div",fa,o(a.content),1),t("div",pa,[s(Ea,{size:"small",text:"",type:a.isLiked?"danger":"default",icon:d(j),onClick:e=>(async a=>{if(ba.isLoggedIn)try{a.isLiked?(await Y.unlikeComment(a.id),a.likeCount--):(await Y.likeComment(a.id),a.likeCount++),a.isLiked=!a.isLiked}catch(e){I.error("操作失败")}else I.warning("请先登录")})(a)},{default:n(()=>[u(o(a.isLiked?"已赞":"点赞")+" ",1),a.likeCount>0?(g(),l("span",ka,"("+o(a.likeCount)+")",1)):i("",!0)]),_:2},1032,["type","icon","onClick"])])])])}),128))])]),t("aside",_a,[e[9]||(e[9]=t("h3",null,"相关文章推荐",-1)),t("div",wa,[(g(!0),l(r,null,c(za.value,e=>(g(),l("div",{class:"related-item",key:e.id,onClick:l=>a.$router.push(`/news-info/${e.slug}`)},[t("img",{src:e.coverImage||"/default-news.jpg",alt:e.title,onError:Va},null,40,ha),t("div",Ca,o(e.title),1)],8,ya))),128))])])])):(g(),l("div",ja,[s(Ga,{icon:"warning",title:"新闻不存在","sub-title":"抱歉，您访问的新闻不存在或已被删除"},{extra:n(()=>[s(Ea,{type:"danger",onClick:e[1]||(e[1]=e=>a.$router.push("/news-info"))},{default:n(()=>e[10]||(e[10]=[u("返回新闻资讯",-1)])),_:1,__:[10]})]),_:1})]))])])}}},[["__scopeId","data-v-100dd96e"]]);export{La as default};
