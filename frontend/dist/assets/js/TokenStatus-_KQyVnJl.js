/* empty css             *//* empty css                *//* empty css               *//* empty css                  */import{u as e,g as a,b as l,s}from"./index-di9GIa25.js";import{g as t}from"./security-GM4R7VwQ.js";import{_ as r}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{a3 as u,b5 as n,b6 as o,e as i,b7 as c,j as d,E as p}from"./element-plus-CXASJE3V.js";import{r as v,b as _,p as m,S as f,c as y,Q as g,I as k,o as b,a as j,M as I,O as T,H as h,K as w}from"./vue-B9wWIsxR.js";import"./utils-C28rWPR3.js";const x={class:"token-status"},M={class:"card-header"},O={class:"mt-20"},E={class:"mt-20"},J=r({__name:"TokenStatus",setup(r){const J=e(),$=v(!1),C=v(!1),N=v(!1),z=v(0),A=_(()=>J.isLoggedIn),P=_(()=>J.user),S=_(()=>{if(z.value<=0)return"已过期";const e=Math.floor(z.value/36e5),a=Math.floor(z.value%36e5/6e4),l=Math.floor(z.value%6e4/1e3);return e>0?`${e}小时${a}分钟`:a>0?`${a}分钟${l}秒`:`${l}秒`});let U=null;const D=async()=>{const e=a();$.value=!!e;try{const e=await t(),a=(null==e?void 0:e.data)||e,l=void 0!==(null==a?void 0:a.data)?a.data:a;l?(C.value=!!(l.isTokenExpired??l.tokenExpired),N.value=!!(l.isTokenExpiringSoon??l.tokenExpiringSoon),z.value=Number(l.remainingTimeMillis??l.remainingMillis??0)):(C.value=!0,N.value=!0,z.value=0)}catch(l){C.value=!0,N.value=!0,z.value=0}},H=async()=>{try{await l.getCurrentUser();p.success("API调用成功")}catch(e){p.error("API调用失败: "+e.message)}},L=()=>{s("eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyIiwiaWF0IjoxNzU0ODIxOTgzLCJleHAiOjE3NTQ4MjE5ODN9.expired"),D(),p.warning("已设置过期Token，请测试系统行为")};return m(()=>{D(),U=setInterval(D,3e4)}),f(()=>{U&&clearInterval(U)}),(e,a)=>{const l=d,s=i,t=o,r=n,p=c,v=u;return b(),y("div",x,[g(v,null,{header:k(()=>[j("div",M,[a[1]||(a[1]=j("span",null,"Token状态监控",-1)),g(l,{type:"primary",onClick:D},{default:k(()=>a[0]||(a[0]=[I("刷新状态",-1)])),_:1,__:[0]})])]),default:k(()=>[g(r,{column:2,border:""},{default:k(()=>[g(t,{label:"登录状态"},{default:k(()=>[g(s,{type:A.value?"success":"danger"},{default:k(()=>[I(T(A.value?"已登录":"未登录"),1)]),_:1},8,["type"])]),_:1}),g(t,{label:"Token存在"},{default:k(()=>[g(s,{type:$.value?"success":"danger"},{default:k(()=>[I(T($.value?"是":"否"),1)]),_:1},8,["type"])]),_:1}),g(t,{label:"Token是否过期"},{default:k(()=>[g(s,{type:C.value?"danger":"success"},{default:k(()=>[I(T(C.value?"已过期":"有效"),1)]),_:1},8,["type"])]),_:1}),g(t,{label:"即将过期"},{default:k(()=>[g(s,{type:N.value?"warning":"success"},{default:k(()=>[I(T(N.value?"是":"否"),1)]),_:1},8,["type"])]),_:1}),g(t,{label:"剩余时间"},{default:k(()=>[j("span",null,T(S.value),1)]),_:1}),g(t,{label:"用户信息"},{default:k(()=>{var e;return[j("span",null,T((null==(e=P.value)?void 0:e.username)||"未获取"),1)]}),_:1})]),_:1}),j("div",O,[C.value?(b(),h(p,{key:0,title:"Token已过期",type:"error",description:"您的登录已过期，请重新登录","show-icon":""})):N.value?(b(),h(p,{key:1,title:"Token即将过期",type:"warning",description:`您的登录将在${Math.floor(z.value/6e4)}分钟后过期`,"show-icon":""},null,8,["description"])):$.value?(b(),h(p,{key:2,title:"Token状态正常",type:"success",description:"您的登录状态正常","show-icon":""})):w("",!0)]),j("div",E,[g(l,{onClick:H,type:"primary"},{default:k(()=>a[2]||(a[2]=[I("测试API调用",-1)])),_:1,__:[2]}),g(l,{onClick:L,type:"danger"},{default:k(()=>a[3]||(a[3]=[I("模拟过期Token",-1)])),_:1,__:[3]})])]),_:1})])}}},[["__scopeId","data-v-9fa43b90"]]);export{J as default};
