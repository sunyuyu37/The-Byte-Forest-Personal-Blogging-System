import{_ as q,u as K,r as g,o as W,a4 as Z,b as v,d as s,e as n,a8 as ee,J as Y,w as c,a9 as te,H as i,F as se,G as u,n as ae,N as z,O as j,h as p,D as M,j as oe,aa as le,E as ne,f as ie,ab as re,a as ce,Q as b,L as d,ac as ue,ad as w,l as _,ae as de,a7 as _e,af as ve,I as me,X as fe}from"./index-Da7ZqcH5.js";const pe={class:"article-detail"},ke={class:"container"},he={key:0,class:"loading"},ge={key:1,class:"article-content"},ye={class:"article-header"},Ce={class:"breadcrumb"},we={class:"title"},Le={class:"meta"},be={class:"author-info"},Ae={class:"author-details"},xe={class:"name"},Ee={class:"time"},Ie={class:"stats"},Be={class:"stat-item"},Me={class:"stat-item"},Ve={class:"stat-item"},De={key:0,class:"tags"},Te={class:"article-body"},$e=["innerHTML"],He={class:"article-footer"},Ne={class:"actions"},Se={class:"comments-section"},Re={key:0,class:"comment-form"},Ye={class:"form-actions"},ze={key:1,class:"login-prompt"},je={class:"comments-list"},Fe={class:"comment-avatar"},Ue={class:"comment-content"},Ge={class:"comment-header"},Je={class:"username"},Oe={class:"time"},Pe={class:"comment-text"},Qe={class:"comment-actions"},Xe={key:0},qe={key:2,class:"not-found"},Ke={__name:"ArticleDetail",setup(We){const V=ce(),k=K(),A=g(!0),e=g(null),x=g([]),f=g(!1),y=g(""),E=g(!1),D=a=>ue(a).format("YYYY-MM-DD HH:mm"),T=async()=>{var a,t;A.value=!0;try{const o=V.params.slug,r=await b.getArticleBySlug(o);if(e.value=r.data,k.isLoggedIn&&((a=e.value)!=null&&a.id))try{const m=await b.isArticleLiked(e.value.id);f.value=!!m.data}catch{f.value=!1}else f.value=!1;await $()}catch(o){console.error("加载文章失败:",o),e.value=null,((t=o.response)==null?void 0:t.status)===404?d.error("文章不存在"):d.error("加载文章失败，请稍后重试")}finally{A.value=!1}},$=async()=>{var a;if(e.value)try{const t=e.value.slug||e.value.id,o=await w.getArticleComments(t),r=((a=o.data)==null?void 0:a.content)||o.data||[];x.value=r.map(m=>({...m,isLiked:!1,likeCount:m.likeCount||0})),k.isLoggedIn&&await Promise.all(x.value.map(async m=>{try{const L=await w.isCommentLiked(m.id);m.isLiked=!!L.data}catch{}}))}catch(t){console.error("加载评论失败:",t)}},F=async a=>{var t,o;if(!k.isLoggedIn){d.warning("请先登录");return}try{a.isLiked?(await w.unlikeComment(a.id),a.isLiked=!1,a.likeCount=Math.max(0,(a.likeCount||0)-1),d.success("已取消点赞评论")):(await w.likeComment(a.id),a.isLiked=!0,a.likeCount=(a.likeCount||0)+1,d.success("已点赞评论"))}catch(r){console.error("评论点赞失败:",r),d.error(((o=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:o.message)||"操作失败，请重试")}},U=async()=>{var a,t,o;if(!k.isLoggedIn){d.warning("请先登录");return}if((a=e.value)!=null&&a.id)try{f.value?(await b.unlikeArticle(e.value.id),f.value=!1,e.value.likeCount=Math.max(0,(e.value.likeCount||0)-1),d.success("取消点赞")):(await b.likeArticle(e.value.id),f.value=!0,e.value.likeCount=(e.value.likeCount||0)+1,d.success("点赞成功"))}catch(r){console.error("点赞失败:",r),d.error(((o=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:o.message)||"操作失败，请重试")}},G=()=>{navigator.share?navigator.share({title:e.value.title,text:e.value.summary,url:window.location.href}):(navigator.clipboard.writeText(window.location.href),d.success("链接已复制到剪贴板"))},J=async()=>{var a,t;if(!k.isLoggedIn){d.warning("请先登录");return}if(!y.value.trim()){d.warning("请输入评论内容");return}E.value=!0;try{const o=await w.createComment({articleId:e.value.id,content:y.value.trim()});await $(),e.value.commentCount=(e.value.commentCount||0)+1,y.value="",d.success("评论成功")}catch(o){console.error("发表评论失败:",o),d.error(((t=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:t.message)||"发表评论失败，请稍后重试")}finally{E.value=!1}};return W(()=>{T()}),Z(()=>V.params.slug,()=>{T()}),(a,t)=>{var H,N;const o=ee,r=de,m=te,L=se,I=ae,O=fe,C=oe,P=ne,Q=ie("router-link"),X=re;return _(),v("div",pe,[s("div",ke,[A.value?(_(),v("div",he,[n(o,{rows:10,animated:""})])):e.value?(_(),v("div",ge,[s("header",ye,[s("div",Ce,[n(m,{separator:"/"},{default:c(()=>[n(r,{to:"/"},{default:c(()=>t[2]||(t[2]=[u("首页",-1)])),_:1,__:[2]}),n(r,{to:"/articles"},{default:c(()=>t[3]||(t[3]=[u("文章",-1)])),_:1,__:[3]}),n(r,null,{default:c(()=>[u(i(e.value.title),1)]),_:1})]),_:1})]),s("h1",we,i(e.value.title),1),s("div",Le,[s("div",be,[n(L,{src:(H=e.value.author)==null?void 0:H.avatar,size:40},{default:c(()=>{var l,h;return[u(i((h=(l=e.value.author)==null?void 0:l.nickname)==null?void 0:h.charAt(0)),1)]}),_:1},8,["src"]),s("div",Ae,[s("div",xe,i((N=e.value.author)==null?void 0:N.nickname),1),s("div",Ee,i(D(e.value.publishedAt)),1)])]),s("div",Ie,[s("span",Be,[n(I,null,{default:c(()=>[n(p(_e))]),_:1}),u(" "+i(e.value.viewCount)+" 阅读 ",1)]),s("span",Me,[n(I,null,{default:c(()=>[n(p(M))]),_:1}),u(" "+i(e.value.likeCount)+" 点赞 ",1)]),s("span",Ve,[n(I,null,{default:c(()=>[n(p(ve))]),_:1}),u(" "+i(e.value.commentCount||0)+" 评论 ",1)])])]),e.value.tags&&e.value.tags.length?(_(),v("div",De,[(_(!0),v(z,null,j(e.value.tags,l=>(_(),me(O,{key:l.id,type:"primary",effect:"plain",onClick:h=>a.$router.push(`/tag/${l.slug}`)},{default:c(()=>[u(i(l.name),1)]),_:2},1032,["onClick"]))),128))])):Y("",!0)]),s("main",Te,[s("div",{class:"content",innerHTML:e.value.content},null,8,$e)]),s("footer",He,[s("div",Ne,[n(C,{type:f.value?"primary":"default",icon:p(M),onClick:U},{default:c(()=>[u(i(f.value?"已点赞":"点赞")+" ("+i(e.value.likeCount)+") ",1)]),_:1},8,["type","icon"]),n(C,{icon:p(le),onClick:G},{default:c(()=>t[4]||(t[4]=[u(" 分享 ",-1)])),_:1,__:[4]},8,["icon"])])]),s("section",Se,[s("h3",null,"评论 ("+i(e.value.commentCount||0)+")",1),p(k).isLoggedIn?(_(),v("div",Re,[n(P,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=l=>y.value=l),type:"textarea",rows:4,placeholder:"写下你的评论...",maxlength:"500","show-word-limit":""},null,8,["modelValue"]),s("div",Ye,[n(C,{type:"primary",loading:E.value,onClick:J},{default:c(()=>t[5]||(t[5]=[u(" 发表评论 ",-1)])),_:1,__:[5]},8,["loading"])])])):(_(),v("div",ze,[s("p",null,[n(Q,{to:"/auth/login"},{default:c(()=>t[6]||(t[6]=[u("登录",-1)])),_:1,__:[6]}),t[7]||(t[7]=u(" 后参与评论 ",-1))])])),s("div",je,[(_(!0),v(z,null,j(x.value,l=>{var h,S;return _(),v("div",{key:l.id,class:"comment-item"},[s("div",Fe,[n(L,{src:(h=l.user)==null?void 0:h.avatar,size:36},{default:c(()=>{var B,R;return[u(i((R=(B=l.user)==null?void 0:B.nickname)==null?void 0:R.charAt(0)),1)]}),_:2},1032,["src"])]),s("div",Ue,[s("div",Ge,[s("span",Je,i((S=l.user)==null?void 0:S.nickname),1),s("span",Oe,i(D(l.createdAt)),1)]),s("div",Pe,i(l.content),1),s("div",Qe,[n(C,{size:"small",text:"",type:l.isLiked?"primary":"default",icon:p(M),onClick:B=>F(l)},{default:c(()=>[u(i(l.isLiked?"已赞":"点赞")+" ",1),l.likeCount>0?(_(),v("span",Xe,"("+i(l.likeCount)+")",1)):Y("",!0)]),_:2},1032,["type","icon","onClick"])])])])}),128))])])])):(_(),v("div",qe,[n(X,{icon:"warning",title:"文章不存在","sub-title":"抱歉，您访问的文章不存在或已被删除"},{extra:c(()=>[n(C,{type:"primary",onClick:t[1]||(t[1]=l=>a.$router.push("/articles"))},{default:c(()=>t[8]||(t[8]=[u(" 返回文章列表 ",-1)])),_:1,__:[8]})]),_:1})]))])])}}},et=q(Ke,[["__scopeId","data-v-bf399390"]]);export{et as default};
