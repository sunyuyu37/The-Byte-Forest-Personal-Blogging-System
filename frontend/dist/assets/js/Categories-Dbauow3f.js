import{_ as O,r as f,av as P,c as T,o as J,b as K,d as _,e as l,w as a,j as Q,P as W,I as E,L as u,l as b,G as d,n as X,h as ee,b3 as te,J as le,K as oe,H as x,E as ae,ac as ne}from"./index-Da7ZqcH5.js";/* empty css                *//* empty css                *//* empty css                  *//* empty css              *//* empty css                     *//* empty css               */import"./scrollbar-PN-ehNXN.js";/* empty css                     */import"./tooltip-l0sNRNKZ.js";/* empty css               */import{h as se,d as re,g as ie,n as de,o as ue,i as pe,j as me,f as ce}from"./positionedConfirm-C6ixQw3s.js";import{v as _e}from"./directive-iqmOBkSf.js";import{a as fe}from"./index-CZyikzse.js";import{E as ge,a as be}from"./index-BJ8ssZSI.js";import"./vnode-DsZHVpXe.js";import"./index-mDFjMy5P.js";import"./castArray-DVWVVBpp.js";import"./isEqual-HUGtL056.js";import"./_Uint8Array-CNK7Frb1.js";import"./index-k6BulDX8.js";import"./index-lPpvXrw4.js";import"./index-Chbwi6h6.js";import"./index-BwTCsBpr.js";import"./index-Ddj3Fd5B.js";import"./index-R92uOlC6.js";import"./index-DuvIoQvO.js";import"./index-DSEo_ZHY.js";import"./index-ViZWhRvA.js";import"./index-BLAWzDFp.js";const ve={class:"admin-categories"},Ce={class:"page-header"},Ve={class:"table-section"},ye={class:"category-name"},he={class:"dialog-footer"},Ie={__name:"Categories",setup(Ee){const v=f(!1),C=f([]),p=f(!1),V=f(!1),y=f(),n=P({id:null,name:"",slug:"",parentId:null,icon:"",description:"",sort:0,status:1}),U={name:[{required:!0,message:"请输入分类名称",trigger:"blur"},{min:1,max:50,message:"分类名称长度在 1 到 50 个字符",trigger:"blur"}],slug:[{required:!0,message:"请输入分类别名",trigger:"blur"},{pattern:/^[a-zA-Z0-9-_]+$/,message:"别名只能包含字母、数字、横线和下划线",trigger:"blur"}]},A=T(()=>n.id?"编辑分类":"新建分类"),D=T(()=>{const t=(e,i=null)=>e.filter(s=>s.parentId===i&&s.id!==n.id).map(s=>({...s,children:t(e,s.id)}));return t(C.value)}),w=t=>t?ne(t).format("YYYY-MM-DD HH:mm"):"-",N=async t=>{try{console.log("更新分类状态:",t.id,t.status),u.success("状态更新成功")}catch(e){console.error("更新状态失败:",e),u.error("状态更新失败"),t.status=t.status===1?0:1}},Z=()=>{h(),p.value=!0},j=t=>{Object.assign(n,{id:t.id,name:t.name,slug:t.slug,parentId:t.parentId,icon:t.icon,description:t.description,sort:t.sort,status:t.status}),p.value=!0},z=t=>{h(),n.parentId=t.id,p.value=!0},B=async(t,e)=>{if(t.articleCount>0){u.warning("该分类下还有文章，无法删除");return}try{await ce(t.name,e),console.log("删除分类:",t.id),u.success("删除成功"),I()}catch(i){i!=="cancel"&&u.error("删除失败")}},F=async()=>{try{await y.value.validate(),V.value=!0,n.id?(console.log("更新分类:",n),u.success("更新成功")):(console.log("创建分类:",n),u.success("创建成功")),p.value=!1,I()}catch(t){console.error("提交失败:",t)}finally{V.value=!1}},M=()=>{var t;(t=y.value)==null||t.resetFields(),h()},h=()=>{Object.assign(n,{id:null,name:"",slug:"",parentId:null,icon:"",description:"",sort:0,status:1})},I=async()=>{v.value=!0;try{await new Promise(i=>setTimeout(i,500));const t=[{id:1,name:"技术分享",slug:"tech-sharing",parentId:null,icon:"Monitor",description:"技术分享和经验交流",articleCount:15,sort:1,status:1,createdAt:"2025-08-10T10:00:00Z"},{id:2,name:"生活随笔",slug:"life-notes",parentId:null,icon:"Edit",description:"生活感悟和随笔记录",articleCount:8,sort:2,status:1,createdAt:"2025-08-10T10:00:00Z"},{id:3,name:"学习笔记",slug:"study-notes",parentId:null,icon:"Notebook",description:"学习过程中的笔记整理",articleCount:12,sort:3,status:1,createdAt:"2025-08-10T10:00:00Z"},{id:4,name:"项目实战",slug:"project-practice",parentId:null,icon:"Folder",description:"项目开发实战经验",articleCount:9,sort:4,status:1,createdAt:"2025-08-10T10:00:00Z"},{id:5,name:"新闻资讯",slug:"news",parentId:null,icon:"Newspaper",description:"行业新闻和技术资讯",articleCount:6,sort:5,status:1,createdAt:"2025-08-10T10:00:00Z"},{id:6,name:"竞赛活动",slug:"competitions",parentId:null,icon:"Trophy",description:"编程竞赛和技术活动",articleCount:4,sort:6,status:1,createdAt:"2025-08-10T10:00:00Z"}],e=(i,s=null)=>i.filter(r=>r.parentId===s).map(r=>({...r,children:e(i,r.id)}));C.value=e(t)}catch(t){console.error("加载分类列表失败:",t),u.error("加载分类列表失败")}finally{v.value=!1}};return J(()=>{I()}),(t,e)=>{const i=X,s=Q,r=ie,R=fe,S=re,g=ae,m=be,$=de,Y=ue,k=me,H=pe,L=ge,q=se,G=_e;return b(),K("div",ve,[_("div",Ce,[e[10]||(e[10]=_("h1",null,"分类管理",-1)),l(s,{type:"primary",onClick:Z},{default:a(()=>[l(i,null,{default:a(()=>[l(ee(te))]),_:1}),e[9]||(e[9]=d(" 新建分类 ",-1))]),_:1,__:[9]})]),_("div",Ve,[W((b(),E(S,{data:C.value,style:{width:"100%"},"row-key":"id","default-expand-all":"","tree-props":{children:"children",hasChildren:"hasChildren"}},{default:a(()=>[l(r,{prop:"name",label:"分类名称","min-width":"200"},{default:a(({row:o})=>[_("div",ye,[o.icon?(b(),E(i,{key:0,size:16,style:{"margin-right":"8px"}},{default:a(()=>[(b(),E(oe(o.icon)))]),_:2},1024)):le("",!0),_("span",null,x(o.name),1)])]),_:1}),l(r,{prop:"slug",label:"别名",width:"150"}),l(r,{prop:"description",label:"描述","min-width":"200"}),l(r,{prop:"articleCount",label:"文章数",width:"100"}),l(r,{prop:"sort",label:"排序",width:"100"}),l(r,{prop:"status",label:"状态",width:"100"},{default:a(({row:o})=>[l(R,{modelValue:o.status,"onUpdate:modelValue":c=>o.status=c,"active-value":1,"inactive-value":0,onChange:c=>N(o)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(r,{prop:"createdAt",label:"创建时间",width:"180"},{default:a(({row:o})=>[d(x(w(o.createdAt)),1)]),_:1}),l(r,{label:"操作",width:"200",fixed:"right"},{default:a(({row:o})=>[l(s,{type:"primary",size:"small",onClick:c=>j(o)},{default:a(()=>e[11]||(e[11]=[d(" 编辑 ",-1)])),_:2,__:[11]},1032,["onClick"]),l(s,{type:"success",size:"small",onClick:c=>z(o)},{default:a(()=>e[12]||(e[12]=[d(" 添加子分类 ",-1)])),_:2,__:[12]},1032,["onClick"]),l(s,{type:"danger",size:"small",onClick:c=>B(o,c),disabled:o.articleCount>0},{default:a(()=>e[13]||(e[13]=[d(" 删除 ",-1)])),_:2,__:[13]},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[G,v.value]])]),l(q,{modelValue:p.value,"onUpdate:modelValue":e[8]||(e[8]=o=>p.value=o),title:A.value,width:"600px",onClose:M},{footer:a(()=>[_("div",he,[l(s,{onClick:e[7]||(e[7]=o=>p.value=!1)},{default:a(()=>e[16]||(e[16]=[d("取消",-1)])),_:1,__:[16]}),l(s,{type:"primary",onClick:F,loading:V.value},{default:a(()=>e[17]||(e[17]=[d(" 确定 ",-1)])),_:1,__:[17]},8,["loading"])])]),default:a(()=>[l(L,{ref_key:"formRef",ref:y,model:n,rules:U,"label-width":"100px"},{default:a(()=>[l(m,{label:"分类名称",prop:"name"},{default:a(()=>[l(g,{modelValue:n.name,"onUpdate:modelValue":e[0]||(e[0]=o=>n.name=o),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),l(m,{label:"分类别名",prop:"slug"},{default:a(()=>[l(g,{modelValue:n.slug,"onUpdate:modelValue":e[1]||(e[1]=o=>n.slug=o),placeholder:"请输入分类别名（用于URL）"},null,8,["modelValue"])]),_:1}),l(m,{label:"父分类",prop:"parentId"},{default:a(()=>[l($,{modelValue:n.parentId,"onUpdate:modelValue":e[2]||(e[2]=o=>n.parentId=o),data:D.value,props:{label:"name",value:"id"},placeholder:"请选择父分类（可选）",clearable:"","check-strictly":""},null,8,["modelValue","data"])]),_:1}),l(m,{label:"分类图标",prop:"icon"},{default:a(()=>[l(g,{modelValue:n.icon,"onUpdate:modelValue":e[3]||(e[3]=o=>n.icon=o),placeholder:"请输入图标名称"},null,8,["modelValue"])]),_:1}),l(m,{label:"分类描述",prop:"description"},{default:a(()=>[l(g,{modelValue:n.description,"onUpdate:modelValue":e[4]||(e[4]=o=>n.description=o),type:"textarea",rows:3,placeholder:"请输入分类描述"},null,8,["modelValue"])]),_:1}),l(m,{label:"排序",prop:"sort"},{default:a(()=>[l(Y,{modelValue:n.sort,"onUpdate:modelValue":e[5]||(e[5]=o=>n.sort=o),min:0,max:999,placeholder:"数字越小越靠前"},null,8,["modelValue"])]),_:1}),l(m,{label:"状态",prop:"status"},{default:a(()=>[l(H,{modelValue:n.status,"onUpdate:modelValue":e[6]||(e[6]=o=>n.status=o)},{default:a(()=>[l(k,{label:1},{default:a(()=>e[14]||(e[14]=[d("启用",-1)])),_:1,__:[14]}),l(k,{label:0},{default:a(()=>e[15]||(e[15]=[d("禁用",-1)])),_:1,__:[15]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},tt=O(Ie,[["__scopeId","data-v-44f5c7fa"]]);export{tt as default};
