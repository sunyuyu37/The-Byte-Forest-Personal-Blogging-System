/* empty css             *//* empty css                   *//* empty css                   *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                     *//* empty css                  */import{r as e,X as a,p as t,c as l,a as s,Q as r,I as o,J as n,K as i,H as c,O as u,ay as d,o as p,M as m}from"./vue-B9wWIsxR.js";import{K as v,J as g,j as f,a1 as _,k as h,E as y,aS as w,T as b,m as k,a0 as C,a2 as j,aU as z,G as x,b4 as V,e as T,aa as U}from"./element-plus-CXASJE3V.js";import{c as E}from"./comment-DttPZ_iH.js";import{s as B,b as I}from"./positionedConfirm-DdmNknNt.js";import{_ as $}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-di9GIa25.js";import"./utils-C28rWPR3.js";const A={class:"admin-comments"},S={class:"search-section"},N={class:"table-section"},Y={class:"user-info"},D={class:"comment-content"},H={key:0,class:"reply-to"},M={key:1,class:"text-gray-400"},O={key:0,class:"batch-actions"},P={class:"pagination"},R={key:0,class:"original-comment"},F={class:"comment-info"},J={class:"user-info"},K={class:"time"},L={class:"content"},X={class:"dialog-footer"},q=$({__name:"Comments",setup($){const q=d(),G=e(!1),Q=e([]),W=e([]),Z=e(!1),ee=e(!1),ae=e(null),te=e(),le=a({content:"",userNickname:"",articleTitle:"",status:""}),se=a({page:1,size:20,total:0}),re=a({content:""}),oe={content:[{required:!0,message:"请输入回复内容",trigger:"blur"},{min:1,max:500,message:"回复内容长度在 1 到 500 个字符",trigger:"blur"}]},ne=e=>({pending:"待审核",approved:"已通过",rejected:"已拒绝",spam:"垃圾评论"}[e?e.toLowerCase():""]||"未知"),ie=e=>e?U(e).format("YYYY-MM-DD HH:mm"):"-",ce=e=>{W.value=e},ue=()=>{se.page=1,_e()},de=()=>{Object.assign(le,{content:"",userNickname:"",articleTitle:"",status:""}),se.page=1,_e()},pe=async()=>{try{const e=await E.batchApprove(W.value.map(e=>e.id));if(200!==e.code)throw new Error(e.message||"批量通过失败");y.success("批量通过成功"),W.value=[],_e()}catch(e){y.error("批量通过失败")}},me=async()=>{try{await te.value.validate(),ee.value=!0;const e=await E.createComment({articleId:ae.value.article.id,content:re.content,parentId:ae.value.id});if(200!==e.code)throw new Error(e.message||"回复失败");y.success("回复成功"),Z.value=!1,_e()}catch(e){y.error("回复失败")}finally{ee.value=!1}},ve=()=>{var e;null==(e=te.value)||e.resetFields(),re.content="",ae.value=null},ge=e=>{se.size=e,se.page=1,_e()},fe=e=>{se.page=e,_e()},_e=async()=>{try{G.value=!0;const e={page:se.page,size:se.size,...le},a=await E.getComments(e);if(200!==a.code)throw new Error(a.message||"加载评论列表失败");Q.value=a.data.records||[],se.total=a.data.total||0}catch(e){y.error("加载失败"),Q.value=[],se.total=0}finally{G.value=!1}};return t(()=>{_e()}),(e,a)=>{const t=k,d=b,U=j,$=C,he=f,ye=v,we=z,be=x,ke=V,Ce=T,je=w,ze=_,xe=h,Ve=g;return p(),l("div",A,[a[23]||(a[23]=s("div",{class:"page-header"},[s("h1",null,"评论管理")],-1)),s("div",S,[r(ye,{model:le,inline:""},{default:o(()=>[r(d,{label:"评论内容"},{default:o(()=>[r(t,{modelValue:le.content,"onUpdate:modelValue":a[0]||(a[0]=e=>le.content=e),placeholder:"请输入评论内容",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),r(d,{label:"用户昵称"},{default:o(()=>[r(t,{modelValue:le.userNickname,"onUpdate:modelValue":a[1]||(a[1]=e=>le.userNickname=e),placeholder:"请输入用户昵称",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),r(d,{label:"文章标题"},{default:o(()=>[r(t,{modelValue:le.articleTitle,"onUpdate:modelValue":a[2]||(a[2]=e=>le.articleTitle=e),placeholder:"请输入文章标题",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),r(d,{label:"状态"},{default:o(()=>[r($,{modelValue:le.status,"onUpdate:modelValue":a[3]||(a[3]=e=>le.status=e),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:o(()=>[r(U,{label:"待审核",value:"pending"}),r(U,{label:"已通过",value:"approved"}),r(U,{label:"已拒绝",value:"rejected"})]),_:1},8,["modelValue"])]),_:1}),r(d,null,{default:o(()=>[r(he,{type:"primary",onClick:ue},{default:o(()=>a[11]||(a[11]=[m("搜索",-1)])),_:1,__:[11]}),r(he,{onClick:de},{default:o(()=>a[12]||(a[12]=[m("重置",-1)])),_:1,__:[12]})]),_:1})]),_:1},8,["model"])]),s("div",N,[n((p(),c(je,{data:Q.value,style:{width:"100%"},onSelectionChange:ce},{default:o(()=>[r(we,{type:"selection",width:"55"}),r(we,{prop:"user",label:"用户",width:"120"},{default:o(({row:e})=>{var a,t;return[s("div",Y,[r(be,{size:30,src:null==(a=e.user)?void 0:a.avatar},null,8,["src"]),s("span",null,u(null==(t=e.user)?void 0:t.nickname),1)])]}),_:1}),r(we,{prop:"content",label:"评论内容","min-width":"300"},{default:o(({row:e})=>[s("div",D,[s("p",null,u(e.content),1),e.parentComment?(p(),l("div",H," 回复："+u(e.parentComment.content),1)):i("",!0)])]),_:1}),r(we,{prop:"article",label:"文章",width:"200"},{default:o(({row:e})=>[e.articleTitle?(p(),c(ke,{key:0,type:"primary",onClick:a=>(async e=>{var a;if(e)if(/^\d+$/.test(String(e)))try{const t=null==(a=(await articleApi.getArticleById(e)).data)?void 0:a.slug;t?q.push(`/article/${t}`):q.push(`/article/${e}`)}catch(t){q.push(`/article/${e}`)}else q.push(`/article/${e}`)})(e.articleId)},{default:o(()=>[m(u(e.articleTitle),1)]),_:2},1032,["onClick"])):(p(),l("span",M,"文章已删除"))]),_:1}),r(we,{prop:"status",label:"状态",width:"100"},{default:o(({row:e})=>{return[r(Ce,{type:(a=e.status,{pending:"warning",approved:"success",rejected:"danger",spam:"danger"}[a?a.toLowerCase():""]||"info"),size:"small"},{default:o(()=>[m(u(ne(e.status)),1)]),_:2},1032,["type"])];var a}),_:1}),r(we,{prop:"ip",label:"IP地址",width:"120"}),r(we,{prop:"createdAt",label:"评论时间",width:"180"},{default:o(({row:e})=>[m(u(ie(e.createdAt)),1)]),_:1}),r(we,{label:"操作",width:"200",fixed:"right"},{default:o(({row:e})=>["pending"===e.status?(p(),c(he,{key:0,type:"success",size:"small",onClick:a=>(async e=>{try{const a=await E.approveComment(e.id);if(200!==a.code)throw new Error(a.message||"通过评论失败");y.success("评论已通过"),_e()}catch(a){y.error("操作失败")}})(e)},{default:o(()=>a[13]||(a[13]=[m(" 通过 ",-1)])),_:2,__:[13]},1032,["onClick"])):i("",!0),"pending"===e.status?(p(),c(he,{key:1,type:"warning",size:"small",onClick:a=>(async(e,a)=>{try{await B("确定要拒绝这条评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"},a);const t=await E.rejectComment(e.id);if(200!==t.code)throw new Error(t.message||"拒绝评论失败");y.success("评论已拒绝"),_e()}catch(t){"cancel"!==t&&y.error("操作失败")}})(e,a)},{default:o(()=>a[14]||(a[14]=[m(" 拒绝 ",-1)])),_:2,__:[14]},1032,["onClick"])):i("",!0),r(he,{type:"primary",size:"small",onClick:a=>(e=>{ae.value=e,re.content="",Z.value=!0})(e)},{default:o(()=>a[15]||(a[15]=[m(" 回复 ",-1)])),_:2,__:[15]},1032,["onClick"]),r(he,{type:"danger",size:"small",onClick:a=>(async(e,a)=>{try{await I("这条评论",a);const t=await E.deleteComment(e.id);if(200!==t.code)throw new Error(t.message||"删除评论失败");y.success("删除成功"),_e()}catch(t){"cancel"!==t&&y.error("删除失败")}})(e,a)},{default:o(()=>a[16]||(a[16]=[m(" 删除 ",-1)])),_:2,__:[16]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ve,G.value]]),W.value.length>0?(p(),l("div",O,[s("span",null,"已选择 "+u(W.value.length)+" 项",1),r(he,{type:"success",size:"small",onClick:pe},{default:o(()=>a[17]||(a[17]=[m(" 批量通过 ",-1)])),_:1,__:[17]}),r(he,{type:"warning",size:"small",onClick:a[4]||(a[4]=e=>(async e=>{try{await B(`确定要拒绝选中的 ${W.value.length} 条评论吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消"},e);const a=await E.batchReject(W.value.map(e=>e.id));if(200!==a.code)throw new Error(a.message||"批量拒绝失败");y.success("批量拒绝成功"),W.value=[],_e()}catch(a){"cancel"!==a&&y.error("批量拒绝失败")}})(e))},{default:o(()=>a[18]||(a[18]=[m(" 批量拒绝 ",-1)])),_:1,__:[18]}),r(he,{type:"danger",size:"small",onClick:a[5]||(a[5]=e=>(async e=>{try{await I(`确定要删除选中的 ${W.value.length} 条评论吗？删除后无法恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消"},e);const a=await E.batchDelete(W.value.map(e=>e.id));if(200!==a.code)throw new Error(a.message||"批量删除失败");y.success("批量删除成功"),W.value=[],_e()}catch(a){"cancel"!==a&&y.error("批量删除失败")}})(e))},{default:o(()=>a[19]||(a[19]=[m(" 批量删除 ",-1)])),_:1,__:[19]})])):i("",!0),s("div",P,[r(ze,{"current-page":se.page,"onUpdate:currentPage":a[6]||(a[6]=e=>se.page=e),"page-size":se.size,"onUpdate:pageSize":a[7]||(a[7]=e=>se.size=e),"page-sizes":[10,20,50,100],total:se.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ge,onCurrentChange:fe},null,8,["current-page","page-size","total"])])]),r(xe,{modelValue:Z.value,"onUpdate:modelValue":a[10]||(a[10]=e=>Z.value=e),title:"回复评论",width:"600px",onClose:ve},{footer:o(()=>[s("div",X,[r(he,{onClick:a[9]||(a[9]=e=>Z.value=!1)},{default:o(()=>a[21]||(a[21]=[m("取消",-1)])),_:1,__:[21]}),r(he,{type:"primary",onClick:me,loading:ee.value},{default:o(()=>a[22]||(a[22]=[m(" 发送回复 ",-1)])),_:1,__:[22]},8,["loading"])])]),default:o(()=>{var e,n;return[ae.value?(p(),l("div",R,[a[20]||(a[20]=s("h4",null,"原评论：",-1)),s("div",F,[s("div",J,[r(be,{size:30,src:null==(e=ae.value.user)?void 0:e.avatar},null,8,["src"]),s("span",null,u(null==(n=ae.value.user)?void 0:n.nickname),1),s("span",K,u(ie(ae.value.createdAt)),1)]),s("p",L,u(ae.value.content),1)])])):i("",!0),r(ye,{ref_key:"replyFormRef",ref:te,model:re,rules:oe,"label-width":"80px"},{default:o(()=>[r(d,{label:"回复内容",prop:"content"},{default:o(()=>[r(t,{modelValue:re.content,"onUpdate:modelValue":a[8]||(a[8]=e=>re.content=e),type:"textarea",rows:4,placeholder:"请输入回复内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]}),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-481d3506"]]);export{q as default};
