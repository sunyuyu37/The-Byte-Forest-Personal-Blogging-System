/* empty css             *//* empty css                   *//* empty css                   *//* empty css                       *//* empty css                 *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import{j as e,K as a,J as l,a1 as t,k as s,E as r,aS as o,r as i,aT as n,T as u,m as d,a0 as m,a2 as c,aU as p,G as g,e as b,a_ as _,aV as v,aW as w,aa as f}from"./element-plus-CXASJE3V.js";import{s as h,b as y}from"./positionedConfirm-DdmNknNt.js";import{a as V}from"./placeholder-Cbo4Yzwr.js";import{b as k}from"./index-di9GIa25.js";import{_ as C}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{r as U,X as j,b as x,p as z,c as T,a as A,Q as E,I as B,J as L,K as $,H as O,O as S,o as q,M as D,u as Y}from"./vue-B9wWIsxR.js";import"./utils-C28rWPR3.js";const H={class:"admin-users"},M={class:"page-header"},P={class:"search-section"},R={class:"table-section"},Z={class:"user-info"},I={class:"user-details"},J={class:"username"},K={class:"nickname"},W={key:0,class:"batch-actions"},X={class:"pagination"},F={class:"dialog-footer"},G=C({__name:"Users",setup(C){const G=U(!1),Q=U([]),N=U([]),ee=U(!1),ae=U(!1),le=U(),te=j({username:"",nickname:"",email:"",role:"",status:""}),se=j({id:null,username:"",nickname:"",email:"",password:"",role:"user",avatar:"",bio:"",status:"active"}),re=j({page:1,size:20,total:0}),oe={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线",trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:1,max:50,message:"昵称长度在 1 到 50 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]},ie=x(()=>se.id?"编辑用户":"新建用户"),ne=e=>({admin:"管理员",user:"普通用户"}[e]||"未知"),ue=e=>e?f(e).format("YYYY-MM-DD HH:mm"):"-",de=e=>{N.value=e},me=()=>{re.page=1,fe()},ce=()=>{Object.assign(te,{username:"",nickname:"",email:"",role:"",status:""}),re.page=1,fe()},pe=()=>{_e(),ee.value=!0},ge=async()=>{try{await le.value.validate(),ae.value=!0;const e={username:se.username,nickname:se.nickname,email:se.email,role:se.role.toUpperCase(),avatar:se.avatar,bio:se.bio,status:"active"===se.status};let a;if(!se.id&&se.password&&(e.password=se.password),a=se.id?await k.updateUserByAdmin(se.id,e):await k.createUser(e),200!==a.code)throw new Error(a.message||(se.id?"更新用户失败":"创建用户失败"));r.success(se.id?"更新成功":"创建成功"),ee.value=!1,fe()}catch(e){r.error(e.message||"操作失败")}finally{ae.value=!1}},be=()=>{var e;null==(e=le.value)||e.resetFields(),_e()},_e=()=>{Object.assign(se,{id:null,username:"",nickname:"",email:"",password:"",role:"user",avatar:"",bio:"",status:"active"})},ve=e=>{re.size=e,re.page=1,fe()},we=e=>{re.page=e,fe()},fe=async()=>{G.value=!0;try{const e={page:re.page-1,size:re.size},a=[];te.username&&a.push(te.username),te.nickname&&a.push(te.nickname),te.email&&a.push(te.email),a.length>0&&(e.keyword=a.join(" ")),te.role&&(e.role=te.role);const l=await k.getUsers(e);if(200!==l.code)throw new Error(l.message||"获取用户列表失败");Q.value=l.data.content.map(e=>{var a;return{id:e.id,username:e.username,nickname:e.nickname||e.username,email:e.email,role:(null==(a=e.role)?void 0:a.toLowerCase())||"user",avatar:e.avatar||V(e.nickname||e.username,40),bio:e.bio||"",articleCount:e.articleCount||0,commentCount:0,status:e.status?"active":"disabled",lastLoginAt:e.lastLoginTime,createdAt:e.createdAt}}),re.total=l.data.totalElements}catch(e){r.error(`加载用户列表失败: ${e.message}`),Q.value=[{id:1,username:"admin",nickname:"管理员",email:"admin@example.com",role:"admin",avatar:V("管理员",40),bio:"系统管理员",articleCount:15,commentCount:25,status:"active",lastLoginAt:"2025-08-10T10:00:00Z",createdAt:"2025-08-10T10:00:00Z"}],re.total=1}finally{G.value=!1}};return z(()=>{fe()}),(f,V)=>{const C=i,U=e,j=d,x=u,z=c,_e=m,he=a,ye=p,Ve=g,ke=b,Ce=_,Ue=o,je=t,xe=w,ze=v,Te=s,Ae=l;return q(),T("div",H,[A("div",M,[V[21]||(V[21]=A("h1",null,"用户管理",-1)),E(U,{type:"primary",onClick:pe},{default:B(()=>[E(C,null,{default:B(()=>[E(Y(n))]),_:1}),V[20]||(V[20]=D(" 新建用户 ",-1))]),_:1,__:[20]})]),A("div",P,[E(he,{model:te,inline:""},{default:B(()=>[E(x,{label:"用户名"},{default:B(()=>[E(j,{modelValue:te.username,"onUpdate:modelValue":V[0]||(V[0]=e=>te.username=e),placeholder:"请输入用户名",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),E(x,{label:"昵称"},{default:B(()=>[E(j,{modelValue:te.nickname,"onUpdate:modelValue":V[1]||(V[1]=e=>te.nickname=e),placeholder:"请输入昵称",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),E(x,{label:"邮箱"},{default:B(()=>[E(j,{modelValue:te.email,"onUpdate:modelValue":V[2]||(V[2]=e=>te.email=e),placeholder:"请输入邮箱",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),E(x,{label:"角色"},{default:B(()=>[E(_e,{modelValue:te.role,"onUpdate:modelValue":V[3]||(V[3]=e=>te.role=e),placeholder:"请选择角色",clearable:"",style:{width:"120px"}},{default:B(()=>[E(z,{label:"管理员",value:"admin"}),E(z,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1}),E(x,{label:"状态"},{default:B(()=>[E(_e,{modelValue:te.status,"onUpdate:modelValue":V[4]||(V[4]=e=>te.status=e),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:B(()=>[E(z,{label:"正常",value:"active"}),E(z,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),E(x,null,{default:B(()=>[E(U,{type:"primary",onClick:me},{default:B(()=>V[22]||(V[22]=[D("搜索",-1)])),_:1,__:[22]}),E(U,{onClick:ce},{default:B(()=>V[23]||(V[23]=[D("重置",-1)])),_:1,__:[23]})]),_:1})]),_:1},8,["model"])]),A("div",R,[L((q(),O(Ue,{data:Q.value,style:{width:"100%"},onSelectionChange:de},{default:B(()=>[E(ye,{type:"selection",width:"55"}),E(ye,{prop:"user",label:"用户信息","min-width":"200"},{default:B(({row:e})=>[A("div",Z,[E(Ve,{size:40,src:e.avatar},null,8,["src"]),A("div",I,[A("div",J,S(e.username),1),A("div",K,S(e.nickname),1)])])]),_:1}),E(ye,{prop:"email",label:"邮箱",width:"200"}),E(ye,{prop:"role",label:"角色",width:"100"},{default:B(({row:e})=>{return[E(ke,{type:(a=e.role,{admin:"danger",user:"primary"}[a]||"info"),size:"small"},{default:B(()=>[D(S(ne(e.role)),1)]),_:2},1032,["type"])];var a}),_:1}),E(ye,{prop:"articleCount",label:"文章数",width:"100"}),E(ye,{prop:"commentCount",label:"评论数",width:"100"}),E(ye,{prop:"lastLoginAt",label:"最后登录",width:"180"},{default:B(({row:e})=>[D(S(ue(e.lastLoginAt)),1)]),_:1}),E(ye,{prop:"status",label:"状态",width:"100"},{default:B(({row:e})=>[E(Ce,{modelValue:e.status,"onUpdate:modelValue":a=>e.status=a,"active-value":"active","inactive-value":"disabled",onChange:a=>(async e=>{try{const a=await k.toggleUserStatus(e.id);if(200!==a.code)throw new Error(a.message||"状态更新失败");r.success("状态更新成功"),e.status=a.data.status?"active":"disabled"}catch(a){r.error(a.message||"状态更新失败"),e.status="active"===e.status?"disabled":"active"}})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),E(ye,{prop:"createdAt",label:"注册时间",width:"180"},{default:B(({row:e})=>[D(S(ue(e.createdAt)),1)]),_:1}),E(ye,{label:"操作",width:"200",fixed:"right"},{default:B(({row:e})=>[E(U,{type:"primary",size:"small",onClick:a=>(e=>{Object.assign(se,{id:e.id,username:e.username,nickname:e.nickname,email:e.email,password:"",role:e.role,avatar:e.avatar,bio:e.bio,status:e.status}),ee.value=!0})(e)},{default:B(()=>V[24]||(V[24]=[D(" 编辑 ",-1)])),_:2,__:[24]},1032,["onClick"]),E(U,{type:"warning",size:"small",onClick:a=>(async(e,a)=>{try{await h(`确定要重置用户"${e.username}"的密码吗？`,"确认",a);const l=await k.resetPassword(e.id);if(200!==l.code)throw new Error(l.message||"密码重置失败");r.success("密码重置成功")}catch(l){"cancel"!==l&&r.error(l.message||"重置密码失败")}})(e,a)},{default:B(()=>V[25]||(V[25]=[D(" 重置密码 ",-1)])),_:2,__:[25]},1032,["onClick"]),E(U,{type:"danger",size:"small",onClick:a=>(async(e,a)=>{if("admin"!==e.role)try{await y(e.username,a);const l=await k.deleteUser(e.id);if(200!==l.code)throw new Error(l.message||"删除用户失败");r.success("删除成功"),await fe()}catch(l){"cancel"!==l&&r.error(l.message||"删除失败")}else r.warning("管理员用户无法删除")})(e,a),disabled:"admin"===e.role},{default:B(()=>V[26]||(V[26]=[D(" 删除 ",-1)])),_:2,__:[26]},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[Ae,G.value]]),N.value.length>0?(q(),T("div",W,[A("span",null,"已选择 "+S(N.value.length)+" 项",1),E(U,{type:"success",size:"small",onClick:V[5]||(V[5]=e=>(async e=>{if(0!==N.value.length)try{await h(`确定要启用选中的 ${N.value.length} 个用户吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消"},e);const a=N.value.map(e=>e.id),l=await k.batchEnableUsers(a);if(200!==l.code)throw new Error(l.message||"批量启用失败");r.success("批量启用成功"),N.value=[],await fe()}catch(a){"cancel"!==a&&r.error(a.message||"批量启用失败")}else r.warning("请选择要启用的用户")})(e))},{default:B(()=>V[27]||(V[27]=[D(" 批量启用 ",-1)])),_:1,__:[27]}),E(U,{type:"warning",size:"small",onClick:V[6]||(V[6]=e=>(async e=>{if(0!==N.value.length)try{await h(`确定要禁用选中的 ${N.value.length} 个用户吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消"},e);const a=N.value.map(e=>e.id),l=await k.batchDisableUsers(a);if(200!==l.code)throw new Error(l.message||"批量禁用失败");r.success("批量禁用成功"),N.value=[],await fe()}catch(a){"cancel"!==a&&r.error(a.message||"批量禁用失败")}else r.warning("请选择要禁用的用户")})(e))},{default:B(()=>V[28]||(V[28]=[D(" 批量禁用 ",-1)])),_:1,__:[28]}),E(U,{type:"danger",size:"small",onClick:V[7]||(V[7]=e=>(async e=>{const a=N.value.filter(e=>"admin"!==e.role);if(0!==a.length)try{await y(`确定要删除选中的 ${a.length} 个用户吗？删除后无法恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消"},e);const l=a.map(e=>e.id),t=await k.batchDeleteUsers(l);if(200!==t.code)throw new Error(t.message||"批量删除失败");r.success("批量删除成功"),N.value=[],await fe()}catch(l){"cancel"!==l&&r.error(l.message||"批量删除失败")}else r.warning("选中的用户中包含管理员，无法删除")})(e))},{default:B(()=>V[29]||(V[29]=[D(" 批量删除 ",-1)])),_:1,__:[29]})])):$("",!0),A("div",X,[E(je,{"current-page":re.page,"onUpdate:currentPage":V[8]||(V[8]=e=>re.page=e),"page-size":re.size,"onUpdate:pageSize":V[9]||(V[9]=e=>re.size=e),"page-sizes":[10,20,50,100],total:re.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ve,onCurrentChange:we},null,8,["current-page","page-size","total"])])]),E(Te,{modelValue:ee.value,"onUpdate:modelValue":V[19]||(V[19]=e=>ee.value=e),title:ie.value,width:"600px",onClose:be},{footer:B(()=>[A("div",F,[E(U,{onClick:V[18]||(V[18]=e=>ee.value=!1)},{default:B(()=>V[34]||(V[34]=[D("取消",-1)])),_:1,__:[34]}),E(U,{type:"primary",onClick:ge,loading:ae.value},{default:B(()=>V[35]||(V[35]=[D(" 确定 ",-1)])),_:1,__:[35]},8,["loading"])])]),default:B(()=>[E(he,{ref_key:"formRef",ref:le,model:se,rules:oe,"label-width":"100px"},{default:B(()=>[E(x,{label:"用户名",prop:"username"},{default:B(()=>[E(j,{modelValue:se.username,"onUpdate:modelValue":V[10]||(V[10]=e=>se.username=e),placeholder:"请输入用户名",disabled:!!se.id},null,8,["modelValue","disabled"])]),_:1}),E(x,{label:"昵称",prop:"nickname"},{default:B(()=>[E(j,{modelValue:se.nickname,"onUpdate:modelValue":V[11]||(V[11]=e=>se.nickname=e),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),E(x,{label:"邮箱",prop:"email"},{default:B(()=>[E(j,{modelValue:se.email,"onUpdate:modelValue":V[12]||(V[12]=e=>se.email=e),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),se.id?$("",!0):(q(),O(x,{key:0,label:"密码",prop:"password"},{default:B(()=>[E(j,{modelValue:se.password,"onUpdate:modelValue":V[13]||(V[13]=e=>se.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),E(x,{label:"角色",prop:"role"},{default:B(()=>[E(ze,{modelValue:se.role,"onUpdate:modelValue":V[14]||(V[14]=e=>se.role=e)},{default:B(()=>[E(xe,{label:"user"},{default:B(()=>V[30]||(V[30]=[D("普通用户",-1)])),_:1,__:[30]}),E(xe,{label:"admin"},{default:B(()=>V[31]||(V[31]=[D("管理员",-1)])),_:1,__:[31]})]),_:1},8,["modelValue"])]),_:1}),E(x,{label:"头像",prop:"avatar"},{default:B(()=>[E(j,{modelValue:se.avatar,"onUpdate:modelValue":V[15]||(V[15]=e=>se.avatar=e),placeholder:"请输入头像URL"},null,8,["modelValue"])]),_:1}),E(x,{label:"个人简介",prop:"bio"},{default:B(()=>[E(j,{modelValue:se.bio,"onUpdate:modelValue":V[16]||(V[16]=e=>se.bio=e),type:"textarea",rows:3,placeholder:"请输入个人简介"},null,8,["modelValue"])]),_:1}),E(x,{label:"状态",prop:"status"},{default:B(()=>[E(ze,{modelValue:se.status,"onUpdate:modelValue":V[17]||(V[17]=e=>se.status=e)},{default:B(()=>[E(xe,{label:"active"},{default:B(()=>V[32]||(V[32]=[D("正常",-1)])),_:1,__:[32]}),E(xe,{label:"disabled"},{default:B(()=>V[33]||(V[33]=[D("禁用",-1)])),_:1,__:[33]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-39ae34e4"]]);export{G as default};
