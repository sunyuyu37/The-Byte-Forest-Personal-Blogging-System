import{_ as ue,r as C,av as $,o as pe,b as E,d as n,e as a,w as o,P as me,J as x,I as T,H as f,j as _e,ad as w,L as r,k as fe,l as y,E as ge,G as c,F as ve,X as ye,ac as he}from"./index-Da7ZqcH5.js";/* empty css                *//* empty css                *//* empty css                   *//* empty css               */import"./scrollbar-PN-ehNXN.js";/* empty css                     */import"./tooltip-l0sNRNKZ.js";/* empty css                  */import{h as we,d as Ce,s as L,f as S,g as ke,q as be}from"./positionedConfirm-C6ixQw3s.js";import{E as Ee,a as xe}from"./index-BJ8ssZSI.js";import{v as ze}from"./directive-iqmOBkSf.js";import{E as Ve}from"./index-DSEo_ZHY.js";import{E as Te,a as Be}from"./index-mDFjMy5P.js";import"./vnode-DsZHVpXe.js";import"./index-k6BulDX8.js";import"./index-lPpvXrw4.js";import"./isEqual-HUGtL056.js";import"./_Uint8Array-CNK7Frb1.js";import"./index-CZyikzse.js";import"./index-ViZWhRvA.js";import"./index-Chbwi6h6.js";import"./index-BwTCsBpr.js";import"./castArray-DVWVVBpp.js";import"./index-Ddj3Fd5B.js";import"./index-R92uOlC6.js";import"./index-DuvIoQvO.js";import"./index-BLAWzDFp.js";const je={class:"admin-comments"},Ae={class:"search-section"},De={class:"table-section"},Re={class:"user-info"},$e={class:"comment-content"},Fe={key:0,class:"reply-to"},Ne={key:1,class:"text-gray-400"},Ue={key:0,class:"batch-actions"},Le={class:"pagination"},Se={key:0,class:"original-comment"},Pe={class:"comment-info"},Ie={class:"user-info"},Me={class:"time"},Ye={class:"content"},He={class:"dialog-footer"},qe={__name:"Comments",setup(Ge){const z=fe(),B=C(!1),j=C([]),p=C([]),b=C(!1),A=C(!1),g=C(null),D=C(),m=$({content:"",userNickname:"",articleTitle:"",status:""}),i=$({page:1,size:20,total:0}),k=$({content:""}),P={content:[{required:!0,message:"请输入回复内容",trigger:"blur"},{min:1,max:500,message:"回复内容长度在 1 到 500 个字符",trigger:"blur"}]},I=t=>{const e=t?t.toLowerCase():"";return{pending:"warning",approved:"success",rejected:"danger",spam:"danger"}[e]||"info"},M=t=>{const e=t?t.toLowerCase():"";return{pending:"待审核",approved:"已通过",rejected:"已拒绝",spam:"垃圾评论"}[e]||"未知"},F=t=>t?he(t).format("YYYY-MM-DD HH:mm"):"-",Y=t=>{p.value=t},H=()=>{i.page=1,d()},q=()=>{Object.assign(m,{content:"",userNickname:"",articleTitle:"",status:""}),i.page=1,d()},G=async t=>{var e;if(t)if(/^\d+$/.test(String(t)))try{const v=(e=(await articleApi.getArticleById(t)).data)==null?void 0:e.slug;v?z.push(`/article/${v}`):z.push(`/article/${t}`)}catch{z.push(`/article/${t}`)}else z.push(`/article/${t}`)},J=async t=>{try{const e=await w.approveComment(t.id);if(e.code===200)r.success("评论已通过"),d();else throw new Error(e.message||"通过评论失败")}catch(e){console.error("通过评论失败:",e),r.error("操作失败")}},W=async(t,e)=>{try{await L("确定要拒绝这条评论吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"},e);const s=await w.rejectComment(t.id);if(s.code===200)r.success("评论已拒绝"),d();else throw new Error(s.message||"拒绝评论失败")}catch(s){s!=="cancel"&&(console.error("拒绝评论失败:",s),r.error("操作失败"))}},X=t=>{g.value=t,k.content="",b.value=!0},K=async(t,e)=>{try{await S("这条评论",e);const s=await w.deleteComment(t.id);if(s.code===200)r.success("删除成功"),d();else throw new Error(s.message||"删除评论失败")}catch(s){s!=="cancel"&&(console.error("删除评论失败:",s),r.error("删除失败"))}},Q=async()=>{try{const t=await w.batchApprove(p.value.map(e=>e.id));if(t.code===200)r.success("批量通过成功"),p.value=[],d();else throw new Error(t.message||"批量通过失败")}catch(t){console.error("批量通过失败:",t),r.error("批量通过失败")}},Z=async t=>{try{await L(`确定要拒绝选中的 ${p.value.length} 条评论吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消"},t);const e=await w.batchReject(p.value.map(s=>s.id));if(e.code===200)r.success("批量拒绝成功"),p.value=[],d();else throw new Error(e.message||"批量拒绝失败")}catch(e){e!=="cancel"&&(console.error("批量拒绝失败:",e),r.error("批量拒绝失败"))}},O=async t=>{try{await S(`确定要删除选中的 ${p.value.length} 条评论吗？删除后无法恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消"},t);const e=await w.batchDelete(p.value.map(s=>s.id));if(e.code===200)r.success("批量删除成功"),p.value=[],d();else throw new Error(e.message||"批量删除失败")}catch(e){e!=="cancel"&&(console.error("批量删除失败:",e),r.error("批量删除失败"))}},ee=async()=>{try{await D.value.validate(),A.value=!0;const t=await w.createComment({articleId:g.value.article.id,content:k.content,parentId:g.value.id});if(t.code===200)r.success("回复成功"),b.value=!1,d();else throw new Error(t.message||"回复失败")}catch(t){console.error("回复失败:",t),r.error("回复失败")}finally{A.value=!1}},te=()=>{var t;(t=D.value)==null||t.resetFields(),k.content="",g.value=null},le=t=>{i.size=t,i.page=1,d()},ae=t=>{i.page=t,d()},d=async()=>{try{B.value=!0;const t={page:i.page,size:i.size,...m},e=await w.getComments(t);if(e.code===200)j.value=e.data.records||[],i.total=e.data.total||0;else throw new Error(e.message||"加载评论列表失败")}catch(t){console.error("加载评论列表失败:",t),r.error("加载失败"),j.value=[],i.total=0}finally{B.value=!1}};return pe(()=>{d()}),(t,e)=>{const s=ge,v=xe,R=Be,oe=Te,_=_e,N=Ee,h=ke,U=ve,se=be,ne=ye,re=Ce,ie=Ve,ce=we,de=ze;return y(),E("div",je,[e[23]||(e[23]=n("div",{class:"page-header"},[n("h1",null,"评论管理")],-1)),n("div",Ae,[a(N,{model:m,inline:""},{default:o(()=>[a(v,{label:"评论内容"},{default:o(()=>[a(s,{modelValue:m.content,"onUpdate:modelValue":e[0]||(e[0]=l=>m.content=l),placeholder:"请输入评论内容",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),a(v,{label:"用户昵称"},{default:o(()=>[a(s,{modelValue:m.userNickname,"onUpdate:modelValue":e[1]||(e[1]=l=>m.userNickname=l),placeholder:"请输入用户昵称",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),a(v,{label:"文章标题"},{default:o(()=>[a(s,{modelValue:m.articleTitle,"onUpdate:modelValue":e[2]||(e[2]=l=>m.articleTitle=l),placeholder:"请输入文章标题",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),a(v,{label:"状态"},{default:o(()=>[a(oe,{modelValue:m.status,"onUpdate:modelValue":e[3]||(e[3]=l=>m.status=l),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:o(()=>[a(R,{label:"待审核",value:"pending"}),a(R,{label:"已通过",value:"approved"}),a(R,{label:"已拒绝",value:"rejected"})]),_:1},8,["modelValue"])]),_:1}),a(v,null,{default:o(()=>[a(_,{type:"primary",onClick:H},{default:o(()=>e[11]||(e[11]=[c("搜索",-1)])),_:1,__:[11]}),a(_,{onClick:q},{default:o(()=>e[12]||(e[12]=[c("重置",-1)])),_:1,__:[12]})]),_:1})]),_:1},8,["model"])]),n("div",De,[me((y(),T(re,{data:j.value,style:{width:"100%"},onSelectionChange:Y},{default:o(()=>[a(h,{type:"selection",width:"55"}),a(h,{prop:"user",label:"用户",width:"120"},{default:o(({row:l})=>{var u,V;return[n("div",Re,[a(U,{size:30,src:(u=l.user)==null?void 0:u.avatar},null,8,["src"]),n("span",null,f((V=l.user)==null?void 0:V.nickname),1)])]}),_:1}),a(h,{prop:"content",label:"评论内容","min-width":"300"},{default:o(({row:l})=>[n("div",$e,[n("p",null,f(l.content),1),l.parentComment?(y(),E("div",Fe," 回复："+f(l.parentComment.content),1)):x("",!0)])]),_:1}),a(h,{prop:"article",label:"文章",width:"200"},{default:o(({row:l})=>[l.articleTitle?(y(),T(se,{key:0,type:"primary",onClick:u=>G(l.articleId)},{default:o(()=>[c(f(l.articleTitle),1)]),_:2},1032,["onClick"])):(y(),E("span",Ne,"文章已删除"))]),_:1}),a(h,{prop:"status",label:"状态",width:"100"},{default:o(({row:l})=>[a(ne,{type:I(l.status),size:"small"},{default:o(()=>[c(f(M(l.status)),1)]),_:2},1032,["type"])]),_:1}),a(h,{prop:"ip",label:"IP地址",width:"120"}),a(h,{prop:"createdAt",label:"评论时间",width:"180"},{default:o(({row:l})=>[c(f(F(l.createdAt)),1)]),_:1}),a(h,{label:"操作",width:"200",fixed:"right"},{default:o(({row:l})=>[l.status==="pending"?(y(),T(_,{key:0,type:"success",size:"small",onClick:u=>J(l)},{default:o(()=>e[13]||(e[13]=[c(" 通过 ",-1)])),_:2,__:[13]},1032,["onClick"])):x("",!0),l.status==="pending"?(y(),T(_,{key:1,type:"warning",size:"small",onClick:u=>W(l,u)},{default:o(()=>e[14]||(e[14]=[c(" 拒绝 ",-1)])),_:2,__:[14]},1032,["onClick"])):x("",!0),a(_,{type:"primary",size:"small",onClick:u=>X(l)},{default:o(()=>e[15]||(e[15]=[c(" 回复 ",-1)])),_:2,__:[15]},1032,["onClick"]),a(_,{type:"danger",size:"small",onClick:u=>K(l,u)},{default:o(()=>e[16]||(e[16]=[c(" 删除 ",-1)])),_:2,__:[16]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,B.value]]),p.value.length>0?(y(),E("div",Ue,[n("span",null,"已选择 "+f(p.value.length)+" 项",1),a(_,{type:"success",size:"small",onClick:Q},{default:o(()=>e[17]||(e[17]=[c(" 批量通过 ",-1)])),_:1,__:[17]}),a(_,{type:"warning",size:"small",onClick:e[4]||(e[4]=l=>Z(l))},{default:o(()=>e[18]||(e[18]=[c(" 批量拒绝 ",-1)])),_:1,__:[18]}),a(_,{type:"danger",size:"small",onClick:e[5]||(e[5]=l=>O(l))},{default:o(()=>e[19]||(e[19]=[c(" 批量删除 ",-1)])),_:1,__:[19]})])):x("",!0),n("div",Le,[a(ie,{"current-page":i.page,"onUpdate:currentPage":e[6]||(e[6]=l=>i.page=l),"page-size":i.size,"onUpdate:pageSize":e[7]||(e[7]=l=>i.size=l),"page-sizes":[10,20,50,100],total:i.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:le,onCurrentChange:ae},null,8,["current-page","page-size","total"])])]),a(ce,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=l=>b.value=l),title:"回复评论",width:"600px",onClose:te},{footer:o(()=>[n("div",He,[a(_,{onClick:e[9]||(e[9]=l=>b.value=!1)},{default:o(()=>e[21]||(e[21]=[c("取消",-1)])),_:1,__:[21]}),a(_,{type:"primary",onClick:ee,loading:A.value},{default:o(()=>e[22]||(e[22]=[c(" 发送回复 ",-1)])),_:1,__:[22]},8,["loading"])])]),default:o(()=>{var l,u;return[g.value?(y(),E("div",Se,[e[20]||(e[20]=n("h4",null,"原评论：",-1)),n("div",Pe,[n("div",Ie,[a(U,{size:30,src:(l=g.value.user)==null?void 0:l.avatar},null,8,["src"]),n("span",null,f((u=g.value.user)==null?void 0:u.nickname),1),n("span",Me,f(F(g.value.createdAt)),1)]),n("p",Ye,f(g.value.content),1)])])):x("",!0),a(N,{ref_key:"replyFormRef",ref:D,model:k,rules:P,"label-width":"80px"},{default:o(()=>[a(v,{label:"回复内容",prop:"content"},{default:o(()=>[a(s,{modelValue:k.content,"onUpdate:modelValue":e[8]||(e[8]=V=>k.content=V),type:"textarea",rows:4,placeholder:"请输入回复内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]}),_:1},8,["modelValue"])])}}},Ct=ue(qe,[["__scopeId","data-v-481d3506"]]);export{Ct as default};
