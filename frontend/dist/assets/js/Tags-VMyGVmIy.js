import{_ as re,r as _,av as z,c as ie,o as de,b as D,d as m,e as t,w as l,j as ue,P as pe,J as me,I as ce,H as k,bb as v,L as i,l as x,G as u,n as ge,h as $,bc as fe,b3 as _e,E as he,X as be,R as ve,ac as ye}from"./index-Da7ZqcH5.js";/* empty css                *//* empty css                *//* empty css              *//* empty css                     *//* empty css                   *//* empty css               */import"./scrollbar-PN-ehNXN.js";/* empty css                     */import"./tooltip-l0sNRNKZ.js";/* empty css               *//* empty css                  */import{h as Ce,s as Ve,d as Ee,f as A,g as we,p as Te,o as ze,i as ke,j as xe}from"./positionedConfirm-C6ixQw3s.js";import{E as je,a as Be}from"./index-BJ8ssZSI.js";import{v as Se}from"./directive-iqmOBkSf.js";import{E as Ue}from"./index-DSEo_ZHY.js";import{a as De}from"./index-CZyikzse.js";import"./vnode-DsZHVpXe.js";import"./index-mDFjMy5P.js";import"./castArray-DVWVVBpp.js";import"./isEqual-HUGtL056.js";import"./_Uint8Array-CNK7Frb1.js";import"./index-k6BulDX8.js";import"./index-lPpvXrw4.js";import"./index-Chbwi6h6.js";import"./index-BwTCsBpr.js";import"./index-Ddj3Fd5B.js";import"./index-R92uOlC6.js";import"./index-DuvIoQvO.js";import"./index-ViZWhRvA.js";import"./index-BLAWzDFp.js";const $e={class:"admin-tags"},Ae={class:"page-header"},Pe={class:"header-actions"},Re={class:"search-section"},Ne={class:"table-section"},Oe={key:0,class:"batch-actions"},Ie={class:"pagination"},Le={class:"color-input"},Fe={class:"dialog-footer"},Je={__name:"Tags",setup(Me){const E=_(!1),j=_([]),y=_([]),h=_(!1),w=_(!1),T=_(!1),V=_(),b=z({name:""}),n=z({id:null,name:"",slug:"",color:"#409eff",description:"",sort:0,status:1}),d=z({page:1,size:20,total:0}),P={name:[{required:!0,message:"请输入标签名称",trigger:"blur"},{min:1,max:20,message:"标签名称长度在 1 到 20 个字符",trigger:"blur"}],slug:[{required:!0,message:"请输入标签别名",trigger:"blur"},{pattern:/^[a-zA-Z0-9-_]+$/,message:"别名只能包含字母、数字、横线和下划线",trigger:"blur"}],color:[{required:!0,message:"请选择标签颜色",trigger:"blur"}]},R=ie(()=>n.id?"编辑标签":"新建标签"),N=o=>o?ye(o).format("YYYY-MM-DD HH:mm"):"-",O=o=>{y.value=o},I=async o=>{try{console.log("更新标签状态:",o.id,o.status),i.success("状态更新成功")}catch(e){console.error("更新状态失败:",e),i.error("状态更新失败"),o.status=o.status===1?0:1}},L=()=>{d.page=1,c()},F=()=>{b.name="",d.page=1,c()},J=()=>{B(),h.value=!0},M=o=>{Object.assign(n,{id:o.id,name:o.name,slug:o.slug,color:o.color,description:o.description,sort:o.sort,status:o.status}),h.value=!0},Y=async(o,e)=>{if(o.articleCount>0){i.warning("该标签下还有文章，无法删除");return}try{await A(o.name,e);const r=await(await fetch(`/api/admin/tags/${o.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v()}`}})).json();r.code===200?(i.success(r.message||"删除成功"),c()):i.error(r.message||"删除失败")}catch(s){s!=="cancel"&&(console.error("删除失败:",s),i.error("删除失败"))}},q=async o=>{const e=y.value.filter(s=>s.articleCount===0);if(e.length===0){i.warning("选中的标签都有关联文章，无法删除");return}try{await A(`确定要删除选中的 ${e.length} 个标签吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消"},o);const r=await(await fetch("/api/admin/tags/batch",{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v()}`},body:JSON.stringify({ids:e.map(f=>f.id)})})).json();r.code===200?(i.success(r.message||"批量删除成功"),c(),y.value=[]):i.error(r.message||"批量删除失败")}catch(s){s!=="cancel"&&(console.error("批量删除失败:",s),i.error("批量删除失败"))}},G=async o=>{try{await Ve("此操作将重新计算所有标签的文章数量（只统计已发布的文章），确定要继续吗？","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消"},o),T.value=!0;const s=await(await fetch("/api/admin/tags/recalculate-counts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v()}`}})).json();s.code===200?(i.success(s.message||"重新计算完成"),c()):i.error(s.message||"重新计算失败")}catch(e){e!=="cancel"&&(console.error("重新计算失败:",e),i.error("重新计算失败"))}finally{T.value=!1}},H=async()=>{if(V.value)try{await V.value.validate(),w.value=!0;const o={name:n.name,description:n.description,color:n.color};let e;n.id?e=await fetch(`/api/admin/tags/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v()}`},body:JSON.stringify(o)}):e=await fetch("/api/admin/tags",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v()}`},body:JSON.stringify(o)});const s=await e.json();s.code===200?(i.success(s.message||(n.id?"更新成功":"创建成功")),h.value=!1,c()):i.error(s.message||"操作失败")}catch(o){console.error("提交失败:",o),i.error("操作失败")}finally{w.value=!1}},W=()=>{var o;(o=V.value)==null||o.resetFields(),B()},B=()=>{Object.assign(n,{id:null,name:"",slug:"",color:"#409eff",description:"",sort:0,status:1})},X=o=>{d.size=o,d.page=1,c()},Z=o=>{d.page=o,c()},c=async()=>{E.value=!0;try{const o={page:d.page-1,size:d.size,sortBy:"createdAt",sortDir:"desc"};b.name&&(o.keyword=b.name);const s=await(await fetch("/api/admin/tags?"+new URLSearchParams(o),{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v()}`}})).json();s.code===200?(j.value=s.data.content.map(r=>({...r,status:r.deleted?0:1})),d.total=s.data.totalElements):i.error(s.message||"加载标签列表失败")}catch(o){console.error("加载标签列表失败:",o),i.error("加载标签列表失败")}finally{E.value=!1}};return de(()=>{c()}),(o,e)=>{const s=ge,r=ue,f=he,g=Be,S=je,p=we,K=be,Q=De,ee=Ee,te=Ue,oe=Te,ae=ze,U=xe,le=ke,se=Ce,ne=Se;return x(),D("div",$e,[m("div",Ae,[e[16]||(e[16]=m("h1",null,"标签管理",-1)),m("div",Pe,[t(r,{type:"warning",onClick:e[0]||(e[0]=a=>G(a)),loading:T.value},{default:l(()=>[t(s,null,{default:l(()=>[t($(fe))]),_:1}),e[14]||(e[14]=u(" 重新计算文章数 ",-1))]),_:1,__:[14]},8,["loading"]),t(r,{type:"primary",onClick:J},{default:l(()=>[t(s,null,{default:l(()=>[t($(_e))]),_:1}),e[15]||(e[15]=u(" 新建标签 ",-1))]),_:1,__:[15]})])]),m("div",Re,[t(S,{model:b,inline:""},{default:l(()=>[t(g,{label:"标签名称"},{default:l(()=>[t(f,{modelValue:b.name,"onUpdate:modelValue":e[1]||(e[1]=a=>b.name=a),placeholder:"请输入标签名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(g,null,{default:l(()=>[t(r,{type:"primary",onClick:L},{default:l(()=>e[17]||(e[17]=[u("搜索",-1)])),_:1,__:[17]}),t(r,{onClick:F},{default:l(()=>e[18]||(e[18]=[u("重置",-1)])),_:1,__:[18]})]),_:1})]),_:1},8,["model"])]),m("div",Ne,[pe((x(),ce(ee,{data:j.value,style:{width:"100%"},onSelectionChange:O},{default:l(()=>[t(p,{type:"selection",width:"55"}),t(p,{prop:"name",label:"标签名称","min-width":"150"},{default:l(({row:a})=>[t(K,{color:a.color,style:{color:"white",border:"none"}},{default:l(()=>[u(k(a.name),1)]),_:2},1032,["color"])]),_:1}),t(p,{prop:"slug",label:"别名",width:"150"}),t(p,{prop:"description",label:"描述","min-width":"200"}),t(p,{prop:"color",label:"颜色",width:"100"},{default:l(({row:a})=>[m("div",{class:"color-preview",style:ve({backgroundColor:a.color})},null,4)]),_:1}),t(p,{prop:"articleCount",label:"文章数",width:"100"}),t(p,{prop:"sort",label:"排序",width:"100"}),t(p,{prop:"status",label:"状态",width:"100"},{default:l(({row:a})=>[t(Q,{modelValue:a.status,"onUpdate:modelValue":C=>a.status=C,"active-value":1,"inactive-value":0,onChange:C=>I(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(p,{prop:"createdAt",label:"创建时间",width:"180"},{default:l(({row:a})=>[u(k(N(a.createdAt)),1)]),_:1}),t(p,{label:"操作",width:"150",fixed:"right"},{default:l(({row:a})=>[t(r,{type:"primary",size:"small",onClick:C=>M(a)},{default:l(()=>e[19]||(e[19]=[u(" 编辑 ",-1)])),_:2,__:[19]},1032,["onClick"]),t(r,{type:"danger",size:"small",onClick:C=>Y(a,C),disabled:a.articleCount>0},{default:l(()=>e[20]||(e[20]=[u(" 删除 ",-1)])),_:2,__:[20]},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[ne,E.value]]),y.value.length>0?(x(),D("div",Oe,[m("span",null,"已选择 "+k(y.value.length)+" 项",1),t(r,{type:"danger",size:"small",onClick:e[2]||(e[2]=a=>q(a))},{default:l(()=>e[21]||(e[21]=[u(" 批量删除 ",-1)])),_:1,__:[21]})])):me("",!0),m("div",Ie,[t(te,{"current-page":d.page,"onUpdate:currentPage":e[3]||(e[3]=a=>d.page=a),"page-size":d.size,"onUpdate:pageSize":e[4]||(e[4]=a=>d.size=a),"page-sizes":[10,20,50,100],total:d.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:X,onCurrentChange:Z},null,8,["current-page","page-size","total"])])]),t(se,{modelValue:h.value,"onUpdate:modelValue":e[13]||(e[13]=a=>h.value=a),title:R.value,width:"500px",onClose:W},{footer:l(()=>[m("div",Fe,[t(r,{onClick:e[12]||(e[12]=a=>h.value=!1)},{default:l(()=>e[24]||(e[24]=[u("取消",-1)])),_:1,__:[24]}),t(r,{type:"primary",onClick:H,loading:w.value},{default:l(()=>e[25]||(e[25]=[u(" 确定 ",-1)])),_:1,__:[25]},8,["loading"])])]),default:l(()=>[t(S,{ref_key:"formRef",ref:V,model:n,rules:P,"label-width":"80px"},{default:l(()=>[t(g,{label:"标签名称",prop:"name"},{default:l(()=>[t(f,{modelValue:n.name,"onUpdate:modelValue":e[5]||(e[5]=a=>n.name=a),placeholder:"请输入标签名称"},null,8,["modelValue"])]),_:1}),t(g,{label:"标签别名",prop:"slug"},{default:l(()=>[t(f,{modelValue:n.slug,"onUpdate:modelValue":e[6]||(e[6]=a=>n.slug=a),placeholder:"请输入标签别名（用于URL）"},null,8,["modelValue"])]),_:1}),t(g,{label:"标签颜色",prop:"color"},{default:l(()=>[m("div",Le,[t(oe,{modelValue:n.color,"onUpdate:modelValue":e[7]||(e[7]=a=>n.color=a)},null,8,["modelValue"]),t(f,{modelValue:n.color,"onUpdate:modelValue":e[8]||(e[8]=a=>n.color=a),placeholder:"请选择或输入颜色值",style:{"margin-left":"10px"}},null,8,["modelValue"])])]),_:1}),t(g,{label:"标签描述",prop:"description"},{default:l(()=>[t(f,{modelValue:n.description,"onUpdate:modelValue":e[9]||(e[9]=a=>n.description=a),type:"textarea",rows:3,placeholder:"请输入标签描述"},null,8,["modelValue"])]),_:1}),t(g,{label:"排序",prop:"sort"},{default:l(()=>[t(ae,{modelValue:n.sort,"onUpdate:modelValue":e[10]||(e[10]=a=>n.sort=a),min:0,max:999,placeholder:"数字越小越靠前"},null,8,["modelValue"])]),_:1}),t(g,{label:"状态",prop:"status"},{default:l(()=>[t(le,{modelValue:n.status,"onUpdate:modelValue":e[11]||(e[11]=a=>n.status=a)},{default:l(()=>[t(U,{label:1},{default:l(()=>e[22]||(e[22]=[u("启用",-1)])),_:1,__:[22]}),t(U,{label:0},{default:l(()=>e[23]||(e[23]=[u("禁用",-1)])),_:1,__:[23]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Vt=re(Je,[["__scopeId","data-v-dc610b0e"]]);export{Vt as default};
