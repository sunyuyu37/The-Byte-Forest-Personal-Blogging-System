import{_ as ue,r as E,av as M,c as w,a_ as pe,o as me,b as $,d as C,e as n,w as i,j as ge,P as fe,J as k,I as v,H as b,a$ as he,L as o,b0 as ye,b1 as _e,b2 as ve,k as be,l as p,G as d,n as Ce,h as we,b3 as ke,E as Ae,N as ze,O as Ee,X as Ie,ac as xe,b4 as Te,b5 as $e,b6 as Be}from"./index-Da7ZqcH5.js";/* empty css                *//* empty css                   *//* empty css               */import{E as Pe}from"./scrollbar-PN-ehNXN.js";/* empty css                     */import"./tooltip-l0sNRNKZ.js";/* empty css                  */import{c as Ve}from"./category-BuqsFtfq.js";import{d as De,e as U,s as L,f as N,g as Se}from"./positionedConfirm-C6ixQw3s.js";import{E as Me,a as Ue}from"./index-BJ8ssZSI.js";import{v as Le}from"./directive-iqmOBkSf.js";import{E as Ne}from"./index-DSEo_ZHY.js";import{E as je,a as Fe}from"./index-mDFjMy5P.js";import"./vnode-DsZHVpXe.js";import"./index-k6BulDX8.js";import"./index-lPpvXrw4.js";import"./isEqual-HUGtL056.js";import"./_Uint8Array-CNK7Frb1.js";import"./index-CZyikzse.js";import"./index-ViZWhRvA.js";import"./index-Chbwi6h6.js";import"./index-BwTCsBpr.js";import"./castArray-DVWVVBpp.js";import"./index-Ddj3Fd5B.js";import"./index-R92uOlC6.js";import"./index-DuvIoQvO.js";import"./index-BLAWzDFp.js";const Ye={class:"admin-articles"},He={class:"page-header"},Oe={class:"search-section"},Re={class:"table-section"},Ze={class:"article-title"},Ge={key:0,class:"batch-actions"},Je={class:"pagination"},We={__name:"Articles",setup(Xe){const B=be(),I=E(!1),x=E([]),A=E([]),r=E([]),m=M({title:"",categoryId:"",status:""}),u=M({page:1,size:10,total:0}),P=w(()=>r.value.filter(l=>h(l.status,"draft")).length),V=w(()=>r.value.filter(l=>h(l.status,"published")).length),D=w(()=>r.value.filter(l=>!h(l.status,"deleted")).length),j=w(()=>P.value>0),F=w(()=>V.value>0),Y=w(()=>D.value>0),h=(l,e)=>{const a=l?l.toLowerCase():"",t=e?e.toLowerCase():"";return a===t},H=l=>{const e=l?l.toLowerCase():"";return{published:"success",draft:"warning",deleted:"danger",archived:"info"}[e]||"info"},O=l=>{const e=l?l.toLowerCase():"";return{published:"已发布",draft:"草稿",deleted:"已删除",archived:"已归档"}[e]||"未知"},R=l=>l?xe(l).format("YYYY-MM-DD HH:mm"):"-",Z=l=>{r.value=l},G=()=>{u.page=1,g()},J=()=>{Object.assign(m,{title:"",categoryId:"",status:""}),u.page=1,g()},W=()=>{B.push("/admin/articles/create")},X=l=>{B.push(`/admin/articles/${l.id}/edit`)},q=async(l,e)=>{let a=null;try{if(h(l.status,"published")){o.warning("文章已经是发布状态");return}await U(`确定要发布文章《${l.title}》吗？

发布后文章将在前台显示，用户可以浏览和评论。`,"确认发布",{confirmButtonText:"确定发布",cancelButtonText:"取消"},e),a=o({message:"正在发布文章...",type:"info",duration:0});const t=await Te(l.id);t.code===200?(o.success("文章发布成功"),g()):o.error(t.message||"发布失败")}catch(t){t!=="cancel"&&t!=="close"&&(o.error("发布失败: "+(t.message||t)),console.error("发布文章失败:",t))}finally{if(a)try{a.close()}catch(t){console.warn("关闭loading消息时出错:",t)}}},K=async(l,e)=>{let a=null;try{if(console.log("开始下线文章:",l),h(l.status,"draft")){o.warning("文章已经是草稿状态");return}await L(`确定下线文章《${l.title}》吗？`,"确认下线",{confirmButtonText:"确定",cancelButtonText:"取消"},e),console.log("用户确认下线，准备调用API，文章ID:",l.id),a=o({message:"正在下线文章...",type:"info",duration:0}),console.log("调用unpublishArticle API...");const t=await $e(l.id);console.log("API响应:",t),t.code===200?(o.success("文章下线成功"),console.log("下线成功，刷新文章列表"),g()):(console.error("下线失败，响应:",t),o.error(t.message||"下线失败"))}catch(t){console.error("下线过程中发生错误:",t),t!=="cancel"&&t!=="close"&&(o.error("下线失败: "+(t.message||t)),console.error("下线文章失败:",t))}finally{if(a)try{a.close()}catch(t){console.warn("关闭loading消息时出错:",t)}}},Q=async(l,e)=>{let a=null;try{console.log("开始删除文章:",l),await N(l.title,e),console.log("用户确认删除，准备调用API，文章ID:",l.id),a=o({message:"正在删除文章...",type:"info",duration:0}),console.log("调用deleteArticle API...");const t=await Be(l.id);console.log("API响应:",t),t.code===200?(o.success("文章删除成功"),console.log("删除成功，刷新文章列表"),g()):(console.error("删除失败，响应:",t),o.error(t.message||"删除失败"))}catch(t){console.error("删除过程中发生错误:",t),t!=="cancel"&&t!=="close"&&(o.error("删除失败: "+(t.message||t)),console.error("删除文章失败:",t))}finally{if(a)try{a.close()}catch(t){console.warn("关闭loading消息时出错:",t)}}},ee=async l=>{let e=null;try{if(r.value.length===0){o.warning("请先选择要发布的文章");return}const a=r.value.filter(c=>h(c.status,"published"));if(a.length>0){o.warning(`选中的文章中有 ${a.length} 篇已经是发布状态`);return}await U(`确定要发布选中的 ${r.value.length} 篇文章吗？

发布后这些文章将在前台显示，用户可以浏览和评论。`,"确认批量发布",l),e=o({message:`正在发布 ${r.value.length} 篇文章...`,type:"info",duration:0});const t=r.value.map(c=>c.id),y=await ye(t);y.code===200?(o.success(`成功发布 ${r.value.length} 篇文章`),r.value=[],g()):o.error(y.message||"批量发布失败")}catch(a){a!=="cancel"&&a!=="close"&&(o.error("批量发布失败: "+(a.message||a)),console.error("批量发布失败:",a))}finally{if(e)try{e.close()}catch(a){console.warn("关闭loading消息时出错:",a)}}},te=async l=>{let e=null;try{if(r.value.length===0){o.warning("请先选择要下线的文章");return}const a=r.value.filter(c=>h(c.status,"draft"));if(a.length>0){o.warning(`选中的文章中有 ${a.length} 篇已经是草稿状态`);return}await L(`确定下线选中的 ${r.value.length} 篇文章吗？`,"批量下线",l),e=o({message:`正在下线 ${r.value.length} 篇文章...`,type:"info",duration:0});const t=r.value.map(c=>c.id),y=await _e(t);y.code===200?(o.success(`成功下线 ${r.value.length} 篇文章`),r.value=[],g()):o.error(y.message||"批量下线失败")}catch(a){a!=="cancel"&&a!=="close"&&(o.error("批量下线失败: "+(a.message||a)),console.error("批量下线失败:",a))}finally{if(e)try{e.close()}catch(a){console.warn("关闭loading消息时出错:",a)}}},le=async l=>{let e=null;try{if(r.value.length===0){o.warning("请先选择要删除的文章");return}const a=r.value.filter(c=>h(c.status,"deleted"));if(a.length>0){o.warning(`选中的文章中有 ${a.length} 篇已经是删除状态`);return}await N(`选中的 ${r.value.length} 篇文章`,l),e=o({message:`正在删除 ${r.value.length} 篇文章...`,type:"info",duration:0});const t=r.value.map(c=>c.id),y=await ve(t);y.code===200?(o.success(`成功删除 ${r.value.length} 篇文章`),r.value=[],g()):o.error(y.message||"批量删除失败")}catch(a){a!=="cancel"&&a!=="close"&&(o.error("批量删除失败: "+(a.message||a)),console.error("批量删除失败:",a))}finally{if(e)try{e.close()}catch(a){console.warn("关闭loading消息时出错:",a)}}},ae=l=>{u.size=l,u.page=1,g()},se=l=>{u.page=l,g()},g=async()=>{I.value=!0;try{let l=null;if(m.categoryId){const a=A.value.find(t=>t.id==m.categoryId);l=a?a.name:null}const e=await he({page:u.page-1,size:u.size,keyword:m.title,status:m.status,category:l,sortBy:"createdAt",sortDir:"desc"});e.code===200?(x.value=e.data.content,u.total=e.data.totalElements):o.error(e.message||"加载文章列表失败")}catch(l){console.error("加载文章列表失败:",l),o.error("加载文章列表失败");const e=[{id:1,title:"Vue 3 Composition API 深度解析",category:{id:1,name:"技术分享"},author:{id:1,nickname:"管理员"},status:"published",isTop:!0,viewCount:1234,likeCount:56,commentCount:23,publishedAt:"2024-01-15T10:00:00Z"},{id:2,title:"2024年前端技术发展趋势报告",category:{id:5,name:"新闻资讯"},author:{id:1,nickname:"管理员"},status:"published",isTop:!1,viewCount:987,likeCount:43,commentCount:18,publishedAt:"2024-01-14T15:30:00Z"}];x.value=e,u.total=e.length}finally{I.value=!1}},oe=async()=>{try{const l=await Ve.getAllCategories();l.code===200?A.value=l.data:A.value=[{id:1,name:"技术分享"},{id:2,name:"生活随笔"},{id:3,name:"学习笔记"},{id:4,name:"项目实战"},{id:5,name:"新闻资讯"},{id:6,name:"竞赛活动"}]}catch(l){console.error("加载分类列表失败:",l),A.value=[{id:1,name:"技术分享"},{id:2,name:"生活随笔"},{id:3,name:"学习笔记"},{id:4,name:"项目实战"},{id:5,name:"新闻资讯"},{id:6,name:"竞赛活动"}]}};return pe(()=>{g()}),me(()=>{g(),oe()}),(l,e)=>{const a=Ce,t=ge,y=Ae,c=Ue,z=Fe,S=je,ne=Me,_=Se,T=Ie,ie=Pe,re=De,ce=Ne,de=Le;return p(),$("div",Ye,[C("div",He,[e[9]||(e[9]=C("h1",null,"文章管理",-1)),n(t,{type:"primary",onClick:W},{default:i(()=>[n(a,null,{default:i(()=>[n(we(ke))]),_:1}),e[8]||(e[8]=d(" 新建文章 ",-1))]),_:1,__:[8]})]),C("div",Oe,[n(ne,{model:m,inline:""},{default:i(()=>[n(c,{label:"标题"},{default:i(()=>[n(y,{modelValue:m.title,"onUpdate:modelValue":e[0]||(e[0]=s=>m.title=s),placeholder:"请输入文章标题",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),n(c,{label:"分类"},{default:i(()=>[n(S,{modelValue:m.categoryId,"onUpdate:modelValue":e[1]||(e[1]=s=>m.categoryId=s),placeholder:"请选择分类",clearable:"",style:{width:"150px"}},{default:i(()=>[(p(!0),$(ze,null,Ee(A.value,s=>(p(),v(z,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(c,{label:"状态"},{default:i(()=>[n(S,{modelValue:m.status,"onUpdate:modelValue":e[2]||(e[2]=s=>m.status=s),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:i(()=>[n(z,{label:"已发布",value:"published"}),n(z,{label:"草稿",value:"draft"}),n(z,{label:"已删除",value:"deleted"})]),_:1},8,["modelValue"])]),_:1}),n(c,null,{default:i(()=>[n(t,{type:"primary",onClick:G},{default:i(()=>e[10]||(e[10]=[d("搜索",-1)])),_:1,__:[10]}),n(t,{onClick:J},{default:i(()=>e[11]||(e[11]=[d("重置",-1)])),_:1,__:[11]})]),_:1})]),_:1},8,["model"])]),C("div",Re,[fe((p(),v(re,{data:x.value,style:{width:"100%"},onSelectionChange:Z},{default:i(()=>[n(_,{type:"selection",width:"55"}),n(_,{prop:"title",label:"标题","min-width":"200"},{default:i(({row:s})=>[C("div",Ze,[C("span",null,b(s.title),1),s.isTop?(p(),v(T,{key:0,type:"danger",size:"small",style:{"margin-left":"8px"}},{default:i(()=>e[12]||(e[12]=[d(" 置顶 ",-1)])),_:1,__:[12]})):k("",!0)])]),_:1}),n(_,{prop:"category",label:"分类",width:"120"},{default:i(({row:s})=>[n(T,{type:"info",size:"small"},{default:i(()=>{var f;return[d(b((f=s.category)==null?void 0:f.name),1)]}),_:2},1024)]),_:1}),n(_,{prop:"author",label:"作者",width:"120"},{default:i(({row:s})=>{var f;return[d(b((f=s.author)==null?void 0:f.nickname),1)]}),_:1}),n(_,{prop:"status",label:"状态",width:"100"},{default:i(({row:s})=>[n(T,{type:H(s.status),size:"small"},{default:i(()=>[d(b(O(s.status)),1)]),_:2},1032,["type"])]),_:1}),n(_,{prop:"viewCount",label:"阅读量",width:"100"}),n(_,{prop:"likeCount",label:"点赞数",width:"100"}),n(_,{prop:"commentCount",label:"评论数",width:"100"}),n(_,{prop:"publishedAt",label:"发布时间",width:"180"},{default:i(({row:s})=>[d(b(R(s.publishedAt)),1)]),_:1}),n(_,{label:"操作",width:"240",fixed:"right"},{default:i(({row:s})=>[n(t,{type:"primary",size:"small",onClick:f=>X(s)},{default:i(()=>e[13]||(e[13]=[d(" 编辑 ",-1)])),_:2,__:[13]},1032,["onClick"]),h(s.status,"draft")?(p(),v(t,{key:0,type:"primary",size:"small",onClick:f=>q(s,f)},{default:i(()=>e[14]||(e[14]=[d(" 发布 ",-1)])),_:2,__:[14]},1032,["onClick"])):h(s.status,"published")?(p(),v(t,{key:1,type:"warning",size:"small",onClick:f=>K(s,f)},{default:i(()=>e[15]||(e[15]=[d(" 下线 ",-1)])),_:2,__:[15]},1032,["onClick"])):k("",!0),h(s.status,"deleted")?(p(),v(ie,{key:3,content:"文章已被删除",placement:"top"},{default:i(()=>[n(t,{type:"info",size:"small",disabled:""},{default:i(()=>e[17]||(e[17]=[d(" 已删除 ",-1)])),_:1,__:[17]})]),_:1})):(p(),v(t,{key:2,type:"danger",size:"small",onClick:f=>Q(s,f)},{default:i(()=>e[16]||(e[16]=[d(" 删除 ",-1)])),_:2,__:[16]},1032,["onClick"]))]),_:1})]),_:1},8,["data"])),[[de,I.value]]),r.value.length>0?(p(),$("div",Ge,[C("span",null,"已选择 "+b(r.value.length)+" 项",1),j.value?(p(),v(t,{key:0,type:"primary",size:"small",onClick:e[3]||(e[3]=s=>ee(s))},{default:i(()=>[d(" 批量发布 ("+b(P.value)+") ",1)]),_:1})):k("",!0),F.value?(p(),v(t,{key:1,type:"warning",size:"small",onClick:e[4]||(e[4]=s=>te(s))},{default:i(()=>[d(" 批量下线 ("+b(V.value)+") ",1)]),_:1})):k("",!0),Y.value?(p(),v(t,{key:2,type:"danger",size:"small",onClick:e[5]||(e[5]=s=>le(s))},{default:i(()=>[d(" 批量删除 ("+b(D.value)+") ",1)]),_:1})):k("",!0)])):k("",!0),C("div",Je,[n(ce,{"current-page":u.page,"onUpdate:currentPage":e[6]||(e[6]=s=>u.page=s),"page-size":u.size,"onUpdate:pageSize":e[7]||(e[7]=s=>u.size=s),"page-sizes":[10,20,50,100],total:u.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ae,onCurrentChange:se},null,8,["current-page","page-size","total"])])])])}}},zt=ue(We,[["__scopeId","data-v-fedb58cc"]]);export{zt as default};
